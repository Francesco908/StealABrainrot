-- Load Fluent library
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

-- Create main window optimized for mobile with larger horizontal size
local Window = Fluent:CreateWindow({
    Title = "💧 Water HUB",
    SubTitle = "Ultimate Edition v5.3",
    TabWidth = 180,
    Size = UDim2.fromOffset(480, 360),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local StarterGui = game:GetService("StarterGui")
local VirtualUser = game:GetService("VirtualUser")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Lighting = game:GetService("Lighting")

-- Variables
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local camera = Workspace.CurrentCamera
local isMobile = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled

-- Create persistent image (always visible)
local persistentGui = Instance.new("ScreenGui")
persistentGui.Name = "FluentPersistentButton"
persistentGui.Parent = playerGui
persistentGui.ResetOnSpawn = false
persistentGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
persistentGui.Enabled = true

-- Main button
local imageButton = Instance.new("ImageButton")
imageButton.Name = "PersistentControl"
imageButton.Size = UDim2.fromOffset(70, 70)
imageButton.Position = UDim2.new(0, 20, 0.5, -35)
imageButton.AnchorPoint = Vector2.new(0, 0.5)
imageButton.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
imageButton.BorderSizePixel = 0
imageButton.Image = "rbxassetid://6034684930"
imageButton.ScaleType = Enum.ScaleType.Fit
imageButton.Parent = persistentGui

-- Transparency effect
imageButton.BackgroundTransparency = 0.5
imageButton.ImageTransparency = 0.2

-- Rounded corners
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0.3, 0)
corner.Parent = imageButton

-- Hover effect
local hoverTween = TweenService:Create(imageButton, TweenInfo.new(0.3), {
    BackgroundTransparency = 0.2,
    ImageTransparency = 0,
    Size = UDim2.fromOffset(75, 75)
})
local normalTween = TweenService:Create(imageButton, TweenInfo.new(0.3), {
    BackgroundTransparency = 0.5,
    ImageTransparency = 0.2,
    Size = UDim2.fromOffset(70, 70)
})

imageButton.MouseEnter:Connect(function()
    hoverTween:Play()
end)
imageButton.MouseLeave:Connect(function()
    normalTween:Play()
end)

-- Dragging variables
local dragging = false
local dragStart = nil
local startPos = nil

-- Drag functions
local function onDragStart(input)
    dragging = true
    dragStart = input.Position
    startPos = imageButton.Position
end

local function onDragEnd(input)
    dragging = false
end

local function onDragMove(input)
    if dragging then
        local delta = input.Position - dragStart
        imageButton.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end

-- Connect drag events
imageButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        onDragStart(input)
    end
end)

imageButton.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        onDragEnd(input)
    end
end)

imageButton.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        onDragMove(input)
    end
end)

-- Toggle menu function
local function toggleMenu()
    if Window and Window.Root then
        Window.Root.Visible = not Window.Root.Visible
    end
end

-- Click handler
imageButton.MouseButton1Click:Connect(function()
    if not dragging then
        toggleMenu()
    end
end)

-- Rotation animation for water drop
spawn(function()
    local rotation = 0
    while imageButton and imageButton.Parent do
        rotation = rotation + 2
        imageButton.Rotation = rotation
        RunService.Heartbeat:Wait()
    end
end)

-- Intercept LeftControl
local function onKeyDown(key, gameProcessed)
    if key.KeyCode == Enum.KeyCode.LeftControl then
        if persistentGui.Enabled then
            toggleMenu()
            return
        end
    end
end

UserInputService.InputBegan:Connect(onKeyDown)

-- State management
local connections = {}
local states = {
    speedBoost = false,
    antiTrap = false,
    antiStun = false,
    infiniteJump = false,
    espPlayers = false,
    espBox = false,
    autoCollectMoney = false,
    fastSteal = false,
    godMode = false,
    noclip = false,
    fly = false
}

-- Helper variables
local stealHelperGui = nil
local originalWalkSpeed = 16
local originalJumpPower = 50
local espBoxes = {}
local basePosition = nil
local lastAttacker = nil
local teleportOverlay = nil

-- Utility Functions
local function getCharacter()
    return player.Character
end

local function getHumanoid()
    local char = getCharacter()
    return char and char:FindFirstChildOfClass("Humanoid")
end

local function getRootPart()
    local char = getCharacter()
    return char and char:FindFirstChild("HumanoidRootPart")
end

-- Create teleport overlay function
local function createTeleportOverlay()
    if teleportOverlay then
        teleportOverlay:Destroy()
    end
    
    teleportOverlay = Instance.new("ScreenGui")
    teleportOverlay.Name = "TeleportOverlay"
    teleportOverlay.Parent = playerGui
    teleportOverlay.ResetOnSpawn = false
    teleportOverlay.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    teleportOverlay.DisplayOrder = 999999
    
    -- Gray background
    local background = Instance.new("Frame")
    background.Size = UDim2.new(1, 0, 1, 0)
    background.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    background.BackgroundTransparency = 0.2
    background.BorderSizePixel = 0
    background.Parent = teleportOverlay
    
    -- Center container
    local container = Instance.new("Frame")
    container.Size = UDim2.fromOffset(300, 350)
    container.Position = UDim2.new(0.5, 0, 0.5, 0)
    container.AnchorPoint = Vector2.new(0.5, 0.5)
    container.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    container.BorderSizePixel = 0
    container.Parent = background
    
    local containerCorner = Instance.new("UICorner")
    containerCorner.CornerRadius = UDim.new(0, 20)
    containerCorner.Parent = container
    
    -- Logo
    local logo = Instance.new("ImageLabel")
    logo.Size = UDim2.fromOffset(150, 150)
    logo.Position = UDim2.new(0.5, 0, 0, 30)
    logo.AnchorPoint = Vector2.new(0.5, 0)
    logo.BackgroundTransparency = 1
    logo.Image = "rbxassetid://84130584727260"
    logo.ScaleType = Enum.ScaleType.Fit
    logo.Parent = container
    
    -- Working text
    local workingText = Instance.new("TextLabel")
    workingText.Size = UDim2.new(1, -40, 0, 30)
    workingText.Position = UDim2.new(0, 20, 0, 200)
    workingText.BackgroundTransparency = 1
    workingText.Text = "Working..."
    workingText.TextColor3 = Color3.fromRGB(255, 255, 255)
    workingText.TextSize = 20
    workingText.Font = Enum.Font.SourceSansBold
    workingText.TextXAlignment = Enum.TextXAlignment.Center
    workingText.Parent = container
    
    -- Status text
    local statusText = Instance.new("TextLabel")
    statusText.Size = UDim2.new(1, -40, 0, 20)
    statusText.Position = UDim2.new(0, 20, 0, 235)
    statusText.BackgroundTransparency = 1
    statusText.Text = "Initializing teleport system..."
    statusText.TextColor3 = Color3.fromRGB(180, 180, 180)
    statusText.TextSize = 14
    statusText.Font = Enum.Font.SourceSans
    statusText.TextXAlignment = Enum.TextXAlignment.Center
    statusText.Parent = container
    
    -- Button container (initially hidden)
    local buttonContainer = Instance.new("Frame")
    buttonContainer.Size = UDim2.new(1, -40, 0, 70)
    buttonContainer.Position = UDim2.new(0, 20, 0, 270)
    buttonContainer.BackgroundTransparency = 1
    buttonContainer.Visible = false
    buttonContainer.Parent = container
    
    -- Stop button
    local stopButton = Instance.new("TextButton")
    stopButton.Size = UDim2.new(0.48, 0, 0, 35)
    stopButton.Position = UDim2.new(0, 0, 0, 0)
    stopButton.BackgroundColor3 = Color3.fromRGB(220, 53, 69)
    stopButton.Text = "STOP"
    stopButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    stopButton.TextSize = 14
    stopButton.Font = Enum.Font.SourceSansBold
    stopButton.Parent = buttonContainer
    
    local stopCorner = Instance.new("UICorner")
    stopCorner.CornerRadius = UDim.new(0, 8)
    stopCorner.Parent = stopButton
    
    -- Continue button
    local continueButton = Instance.new("TextButton")
    continueButton.Size = UDim2.new(0.48, 0, 0, 35)
    continueButton.Position = UDim2.new(0.52, 0, 0, 0)
    continueButton.BackgroundColor3 = Color3.fromRGB(40, 167, 69)
    continueButton.Text = "CONTINUE"
    continueButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    continueButton.TextSize = 14
    continueButton.Font = Enum.Font.SourceSansBold
    continueButton.Parent = buttonContainer
    
    local continueCorner = Instance.new("UICorner")
    continueCorner.CornerRadius = UDim.new(0, 8)
    continueCorner.Parent = continueButton
    
    -- Logo rotation animation
    spawn(function()
        local rotation = 0
        while logo and logo.Parent do
            rotation = rotation + 3
            logo.Rotation = rotation
            RunService.Heartbeat:Wait()
        end
    end)
    
    -- Working text animation
    spawn(function()
        local dots = 0
        while workingText and workingText.Parent do
            dots = (dots + 1) % 4
            workingText.Text = "Working" .. string.rep(".", dots)
            wait(0.5)
        end
    end)
    
    return teleportOverlay, statusText, buttonContainer, stopButton, continueButton
end

-- Enhanced Anti-Stun with attacker detection
local function toggleAntiStun(enabled)
    states.antiStun = enabled
    
    if connections.antiStun then
        connections.antiStun:Disconnect()
        connections.antiStun = nil
    end
    
    if connections.damageDetection then
        connections.damageDetection:Disconnect()
        connections.damageDetection = nil
    end
    
    if enabled then
        connections.damageDetection = RunService.Heartbeat:Connect(function()
            local humanoid = getHumanoid()
            if humanoid then
                local currentHealth = humanoid.Health
                if currentHealth < humanoid.MaxHealth * 0.9 then
                    local rootPart = getRootPart()
                    if rootPart then
                        local closestPlayer = nil
                        local closestDistance = math.huge
                        
                        for _, targetPlayer in pairs(Players:GetPlayers()) do
                            if targetPlayer ~= player and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
                                local distance = (targetPlayer.Character.HumanoidRootPart.Position - rootPart.Position).Magnitude
                                if distance < 20 and distance < closestDistance then
                                    closestDistance = distance
                                    closestPlayer = targetPlayer
                                end
                            end
                        end
                        
                        if closestPlayer then
                            lastAttacker = closestPlayer
                        end
                    end
                end
            end
        end)
        
        connections.antiStun = RunService.Heartbeat:Connect(function()
            local humanoid = getHumanoid()
            local rootPart = getRootPart()
            
            if humanoid and rootPart then
                if humanoid:GetState() == Enum.HumanoidStateType.PlatformStanding or
                   humanoid:GetState() == Enum.HumanoidStateType.FallingDown or
                   humanoid:GetState() == Enum.HumanoidStateType.Ragdoll or
                   humanoid:GetState() == Enum.HumanoidStateType.Flying then
                    humanoid:ChangeState(Enum.HumanoidStateType.Running)
                end
                
                if math.abs(rootPart.Velocity.Y) > 50 then
                    rootPart.Velocity = Vector3.new(rootPart.Velocity.X, 0, rootPart.Velocity.Z)
                end
                
                for _, child in pairs(rootPart:GetChildren()) do
                    if child:IsA("BodyPosition") or child:IsA("BodyVelocity") or 
                       child:IsA("BodyAngularVelocity") or child:IsA("BodyThrust") then
                        child:Destroy()
                    end
                end
                
                humanoid.PlatformStand = false
                humanoid.Sit = false
                rootPart.Anchored = false
                
                if lastAttacker and humanoid.Health < humanoid.MaxHealth * 0.8 then
                    humanoid.Health = humanoid.MaxHealth
                end
            end
        end)
    else
        lastAttacker = nil
    end
end

-- Infinite Jump implementation
local function toggleInfiniteJump(enabled)
    states.infiniteJump = enabled
    
    if connections.infiniteJump then
        connections.infiniteJump:Disconnect()
        connections.infiniteJump = nil
    end
    
    if connections.jumpHeight then
        connections.jumpHeight:Disconnect()
        connections.jumpHeight = nil
    end
    
    if enabled then
        connections.infiniteJump = UserInputService.JumpRequest:Connect(function()
            local humanoid = getHumanoid()
            local rootPart = getRootPart()
            
            if humanoid and rootPart and humanoid:GetState() ~= Enum.HumanoidStateType.Dead then
                humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                
                local bodyVelocity = Instance.new("BodyVelocity")
                bodyVelocity.MaxForce = Vector3.new(0, math.huge, 0)
                bodyVelocity.Velocity = Vector3.new(0, 60, 0)
                bodyVelocity.Parent = rootPart
                
                game:GetService("Debris"):AddItem(bodyVelocity, 0.1)
            end
        end)
        
        connections.jumpHeight = RunService.Heartbeat:Connect(function()
            local humanoid = getHumanoid()
            if humanoid then
                humanoid.JumpPower = 50
                humanoid.JumpHeight = 7.2
            end
        end)
    end
end

-- Ultra Bypass Teleportation System
local function ultraBypassTeleport(targetPosition)
    local rootPart = getRootPart()
    if not rootPart or not targetPosition then return false end
    
    local overlay, statusText, buttonContainer, stopButton, continueButton = createTeleportOverlay()
    local teleportCancelled = false
    local continuePressed = false
    local startTime = tick()
    
    -- Bypass preparation
    local function prepareBypass()
        -- Save current camera
        local oldCameraType = camera.CameraType
        camera.CameraType = Enum.CameraType.Scriptable
        
        -- Disable all collisions
        for _, part in pairs(getCharacter():GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
        
        -- Remove velocity constraints
        rootPart.Velocity = Vector3.new(0, 0, 0)
        rootPart.RotVelocity = Vector3.new(0, 0, 0)
        
        -- Disable physics temporarily
        rootPart.Anchored = true
        wait(0.1)
        rootPart.Anchored = false
        
        return oldCameraType
    end
    
    -- Method 1: Quantum Phase Shift
    local function quantumPhaseShift(target)
        statusText.Text = "Executing Quantum Phase Shift..."
        
        -- Phase 1: Dimensional shift
        for i = 1, 5 do
            rootPart.CFrame = rootPart.CFrame * CFrame.new(0, 1000, 0)
            wait()
            rootPart.CFrame = rootPart.CFrame * CFrame.new(0, -1000, 0)
            wait()
        end
        
        -- Phase 2: Coordinate scramble
        local scramblePos = Vector3.new(
            math.random(-10000, 10000),
            math.random(5000, 10000),
            math.random(-10000, 10000)
        )
        rootPart.CFrame = CFrame.new(scramblePos)
        wait(0.1)
        
        -- Phase 3: Direct injection
        rootPart.CFrame = CFrame.new(target)
        rootPart.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
        rootPart.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
    end
    
    -- Method 2: Void Walker Protocol
    local function voidWalkerProtocol(target)
        statusText.Text = "Activating Void Walker Protocol..."
        
        -- Create void anchor
        local voidPart = Instance.new("Part")
        voidPart.Name = "VoidAnchor"
        voidPart.Anchored = true
        voidPart.CanCollide = false
        voidPart.Transparency = 1
        voidPart.Size = Vector3.new(1, 1, 1)
        voidPart.CFrame = CFrame.new(target)
        voidPart.Parent = Workspace
        
        -- Create weld chain
        local weld = Instance.new("WeldConstraint")
        weld.Part0 = rootPart
        weld.Part1 = voidPart
        weld.Parent = rootPart
        
        -- Instant position sync
        wait(0.05)
        rootPart.CFrame = voidPart.CFrame
        
        -- Cleanup
        weld:Destroy()
        voidPart:Destroy()
    end
    
    -- Button handlers
    local stopConnection = stopButton.MouseButton1Click:Connect(function()
        teleportCancelled = true
        if overlay then
            overlay:Destroy()
        end
    end)
    
    local continueConnection = continueButton.MouseButton1Click:Connect(function()
        continuePressed = true
        buttonContainer.Visible = false
    end)
    
    -- Main teleport coroutine
    coroutine.wrap(function()
        local oldCameraType = prepareBypass()
        local attempts = 0
        local success = false
        
        while not success and not teleportCancelled and attempts < 10 do
            attempts = attempts + 1
            
            -- Try Method 1
            if not teleportCancelled then
                quantumPhaseShift(targetPosition)
                wait(0.2)
                
                local distance = (rootPart.Position - targetPosition).Magnitude
                if distance < 5 then
                    success = true
                    break
                end
            end
            
            -- Try Method 2
            if not teleportCancelled and not success then
                voidWalkerProtocol(targetPosition)
                wait(0.2)
                
                local distance = (rootPart.Position - targetPosition).Magnitude
                if distance < 5 then
                    success = true
                    break
                end
            end
            
            -- Show continue/stop after 10 seconds
            if tick() - startTime > 10 and not continuePressed and not buttonContainer.Visible then
                statusText.Text = "Teleport taking longer than expected..."
                buttonContainer.Visible = true
                
                -- Wait for user input
                while not teleportCancelled and not continuePressed do
                    wait(0.1)
                end
                
                if teleportCancelled then
                    break
                end
            end
        end
        
        -- Cleanup
        camera.CameraType = oldCameraType
        stopConnection:Disconnect()
        continueConnection:Disconnect()
        
        if overlay then
            if success then
                statusText.Text = "Teleport successful!"
                wait(1)
            end
            overlay:Destroy()
        end
        
        if success then
            Fluent:Notify({
                Title = "Base TP",
                Content = "Successfully teleported using Ultra Bypass!",
                Duration = 3
            })
        elseif teleportCancelled then
            Fluent:Notify({
                Title = "Base TP",
                Content = "Teleport cancelled by user",
                Duration = 3
            })
        else
            Fluent:Notify({
                Title = "Base TP",
                Content = "Teleport failed - please try again",
                Duration = 3
            })
        end
    end)()
    
    return true
end

-- Create tabs
local Tabs = {
    Main = Window:AddTab({ Title = "🛡️ Main", Icon = "shield" }),
    Visual = Window:AddTab({ Title = "👁️ Visual", Icon = "eye" }),
    Misc = Window:AddTab({ Title = "🔧 Misc", Icon = "settings" }),
    Money = Window:AddTab({ Title = "💰 Money", Icon = "dollar-sign" }),
    Server = Window:AddTab({ Title = "🌐 Server", Icon = "globe" })
}

-- MAIN TAB
Tabs.Main:AddToggle("SpeedBoost", {
    Title = "⚡ Speed Boost 8x (Enhanced)",
    Description = "Increases movement speed significantly",
    Default = false,
    Callback = function(value)
        states.speedBoost = value
        if player.Character and player.Character:FindFirstChild("Humanoid") then
            if value then
                player.Character.Humanoid.WalkSpeed = originalWalkSpeed * 8
                player.Character.Humanoid.JumpPower = originalJumpPower * 4
            else
                player.Character.Humanoid.WalkSpeed = originalWalkSpeed
                player.Character.Humanoid.JumpPower = originalJumpPower
            end
        end
    end
})

Tabs.Main:AddToggle("AntiTrap", {
    Title = "🚫 Anti Trap (Movement Freedom)",
    Description = "Prevents being trapped by other players",
    Default = false,
    Callback = function(value)
        states.antiTrap = value
        
        if connections.antiTrap then
            connections.antiTrap:Disconnect()
            connections.antiTrap = nil
        end
        
        if value then
            connections.antiTrap = RunService.Heartbeat:Connect(function()
                local humanoid = getHumanoid()
                local rootPart = getRootPart()
                
                if humanoid and rootPart then
                    humanoid.PlatformStand = false
                    humanoid.Sit = false
                    rootPart.Anchored = false
                    
                    for _, v in pairs(rootPart:GetChildren()) do
                        if v:IsA("BodyPosition") or v:IsA("BodyVelocity") or v:IsA("BodyAngularVelocity") then
                            v:Destroy()
                        end
                    end
                end
            end)
        end
    end
})

Tabs.Main:AddToggle("AntiStun", {
    Title = "🛡️ Anti Stun (Enhanced with Attacker Detection)",
    Description = "Prevents stunning and detects who attacks you",
    Default = false,
    Callback = function(value)
        toggleAntiStun(value)
    end
})

Tabs.Main:AddToggle("InfiniteJump", {
    Title = "🦘 Infinite Jump (Enhanced)",
    Description = "Jump infinitely without touching ground",
    Default = false,
    Callback = function(value)
        toggleInfiniteJump(value)
    end
})

Tabs.Main:AddToggle("GodMode", {
    Title = "🛡️ God Mode",
    Description = "Complete invincibility",
    Default = false,
    Callback = function(value)
        states.godMode = value
        
        if connections.godMode then
            connections.godMode:Disconnect()
            connections.godMode = nil
        end
        
        if value then
            connections.godMode = RunService.Heartbeat:Connect(function()
                local humanoid = getHumanoid()
                if humanoid then
                    humanoid.Health = humanoid.MaxHealth
                    
                    pcall(function()
                        humanoid:SetStateEnabled(Enum.HumanoidStateType.Dead, false)
                        humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, false)
                        humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, false)
                    end)
                    
                    local char = getCharacter()
                    if char and not char:FindFirstChild("ForceField") then
                        local ff = Instance.new("ForceField")
                        ff.Visible = false
                        ff.Parent = char
                    end
                end
            end)
        end
    end
})

Tabs.Main:AddToggle("Noclip", {
    Title = "👻 Noclip",
    Description = "Walk through walls",
    Default = false,
    Callback = function(value)
        states.noclip = value
        
        if connections.noclip then
            connections.noclip:Disconnect()
            connections.noclip = nil
        end
        
        if value then
            connections.noclip = RunService.Stepped:Connect(function()
                local character = getCharacter()
                if character then
                    for _, part in pairs(character:GetDescendants()) do
                        if part:IsA("BasePart") then
                            part.CanCollide = false
                        end
                    end
                end
            end)
        else
            local character = getCharacter()
            if character then
                for _, part in pairs(character:GetDescendants()) do
                    if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                        part.CanCollide = true
                    end
                end
            end
        end
    end
})

-- VISUAL TAB
Tabs.Visual:AddToggle("ESPPlayers", {
    Title = "👥 ESP Player Highlights",
    Description = "Highlight all players",
    Default = false,
    Callback = function(value)
        states.espPlayers = value
        for _, targetPlayer in pairs(Players:GetPlayers()) do
            if targetPlayer ~= Players.LocalPlayer and targetPlayer.Character then
                local highlight = targetPlayer.Character:FindFirstChild("Highlight")
                if value then
                    if not highlight then
                        highlight = Instance.new("Highlight")
                        highlight.Parent = targetPlayer.Character
                        highlight.FillColor = Color3.fromRGB(255, 0, 0)
                        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                    end
                else
                    if highlight then
                        highlight:Destroy()
                    end
                end
            end
        end
    end
})

local function createESPBox(character)
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end
    
    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Name = "ESPBox"
    billboardGui.Adornee = humanoidRootPart
    billboardGui.Size = UDim2.new(4, 0, 6, 0)
    billboardGui.StudsOffset = Vector3.new(0, 0, 0)
    billboardGui.Parent = character
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.BackgroundTransparency = 1
    frame.Parent = billboardGui
    
    local function createLine(name, size, position)
        local line = Instance.new("Frame")
        line.Name = name
        line.Size = size
        line.Position = position
        line.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        line.BorderSizePixel = 0
        line.Parent = frame
        return line
    end
    
    createLine("Top", UDim2.new(1, 0, 0, 2), UDim2.new(0, 0, 0, 0))
    createLine("Bottom", UDim2.new(1, 0, 0, 2), UDim2.new(0, 0, 1, -2))
    createLine("Left", UDim2.new(0, 2, 1, 0), UDim2.new(0, 0, 0, 0))
    createLine("Right", UDim2.new(0, 2, 1, 0), UDim2.new(1, -2, 0, 0))
    
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1, 0, 0, 20)
    nameLabel.Position = UDim2.new(0, 0, 0, -25)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = character.Name
    nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameLabel.TextSize = 14
    nameLabel.Font = Enum.Font.SourceSansBold
    nameLabel.TextStrokeTransparency = 0
    nameLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    nameLabel.Parent = frame
    
    return billboardGui
end

local function removeESPBox(character)
    local espBox = character:FindFirstChild("ESPBox")
    if espBox then
        espBox:Destroy()
    end
end

Tabs.Visual:AddToggle("ESPBox", {
    Title = "📦 ESP Box",
    Description = "Show boxes around players",
    Default = false,
    Callback = function(value)
        states.espBox = value
        for _, targetPlayer in pairs(Players:GetPlayers()) do
            if targetPlayer ~= Players.LocalPlayer and targetPlayer.Character then
                if value then
                    createESPBox(targetPlayer.Character)
                else
                    removeESPBox(targetPlayer.Character)
                end
            end
        end
    end
})

-- MISC TAB
Tabs.Misc:AddSection("🚀 Stealing Tools")

Tabs.Misc:AddToggle("FastSteal", {
    Title = "⚡ Fast Steal",
    Description = "Instantly steal without hold duration",
    Default = false,
    Callback = function(value)
        states.fastSteal = value
    end
})

Tabs.Misc:AddButton({
    Title = "💰 Steal Helper (Enhanced Bypass)",
    Description = "Ultra bypass stealing assistance tool",
    Callback = function()
        if stealHelperGui then
            stealHelperGui:Destroy()
        end
        
        stealHelperGui = Instance.new("ScreenGui")
        stealHelperGui.Name = "StealHelper"
        stealHelperGui.Parent = playerGui
        stealHelperGui.ResetOnSpawn = false
        
        local frame = Instance.new("Frame")
        frame.Size = UDim2.fromOffset(180, 120)
        frame.Position = UDim2.new(0, 20, 0.3, 0)
        frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        frame.BackgroundTransparency = 0.1
        frame.BorderSizePixel = 0
        frame.Active = true
        frame.Draggable = true
        frame.Parent = stealHelperGui
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 10)
        corner.Parent = frame
        
        local stroke = Instance.new("UIStroke")
        stroke.Color = Color3.fromRGB(0, 170, 255)
        stroke.Transparency = 0.5
        stroke.Thickness = 1
        stroke.Parent = frame
        
        local titleBar = Instance.new("Frame")
        titleBar.Size = UDim2.new(1, 0, 0, 25)
        titleBar.Position = UDim2.new(0, 0, 0, 0)
        titleBar.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
        titleBar.BackgroundTransparency = 0.3
        titleBar.BorderSizePixel = 0
        titleBar.Parent = frame
        
        local titleCorner = Instance.new("UICorner")
        titleCorner.CornerRadius = UDim.new(0, 10)
        titleCorner.Parent = titleBar
        
        local titleFix = Instance.new("Frame")
        titleFix.Size = UDim2.new(1, 0, 0, 10)
        titleFix.Position = UDim2.new(0, 0, 1, -10)
        titleFix.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
        titleFix.BackgroundTransparency = 0.3
        titleFix.BorderSizePixel = 0
        titleFix.Parent = titleBar
        
        local title = Instance.new("TextLabel")
        title.Size = UDim2.new(1, -25, 1, 0)
        title.Position = UDim2.new(0, 5, 0, 0)
        title.BackgroundTransparency = 1
        title.Text = "💰 Steal Helper"
        title.TextColor3 = Color3.fromRGB(255, 255, 255)
        title.TextSize = 12
        title.Font = Enum.Font.SourceSansBold
        title.TextXAlignment = Enum.TextXAlignment.Left
        title.Parent = titleBar
        
        local closeBtn = Instance.new("TextButton")
        closeBtn.Size = UDim2.fromOffset(20, 20)
        closeBtn.Position = UDim2.new(1, -23, 0, 2.5)
        closeBtn.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
        closeBtn.BackgroundTransparency = 0.2
        closeBtn.Text = "×"
        closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        closeBtn.TextSize = 12
        closeBtn.Font = Enum.Font.SourceSansBold
        closeBtn.Parent = titleBar
        
        local closeCorner = Instance.new("UICorner")
        closeCorner.CornerRadius = UDim.new(0, 5)
        closeCorner.Parent = closeBtn
        
        closeBtn.MouseButton1Click:Connect(function()
            stealHelperGui:Destroy()
        end)
        
        local upBtn = Instance.new("TextButton")
        upBtn.Size = UDim2.new(1, -10, 0, 35)
        upBtn.Position = UDim2.new(0, 5, 0, 30)
        upBtn.BackgroundColor3 = Color3.fromRGB(40, 167, 69)
        upBtn.BackgroundTransparency = 0.2
        upBtn.Text = "⬆️ UP (175)"
        upBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        upBtn.TextSize = 12
        upBtn.Font = Enum.Font.SourceSansBold
        upBtn.Parent = frame
        
        local upCorner = Instance.new("UICorner")
        upCorner.CornerRadius = UDim.new(0, 8)
        upCorner.Parent = upBtn
        
        local downBtn = Instance.new("TextButton")
        downBtn.Size = UDim2.new(1, -10, 0, 35)
        downBtn.Position = UDim2.new(0, 5, 0, 75)
        downBtn.BackgroundColor3 = Color3.fromRGB(220, 53, 69)
        downBtn.BackgroundTransparency = 0.2
        downBtn.Text = "⬇️ DOWN (85)"
        downBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        downBtn.TextSize = 12
        downBtn.Font = Enum.Font.SourceSansBold
        downBtn.Parent = frame
        
        local downCorner = Instance.new("UICorner")
        downCorner.CornerRadius = UDim.new(0, 8)
        downCorner.Parent = downBtn
        
        upBtn.MouseButton1Click:Connect(function()
            local rootPart = getRootPart()
            if rootPart then
                -- Ultra bypass UP
                local oldCFrame = rootPart.CFrame
                rootPart.CFrame = CFrame.new(rootPart.Position.X, 175, rootPart.Position.Z)
                rootPart.Velocity = Vector3.new(0, 0, 0)
                rootPart.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
                
                -- Anti-detection pulse
                wait(0.05)
                rootPart.CFrame = oldCFrame + Vector3.new(0, 175 - oldCFrame.Y, 0)
            end
        end)
        
        downBtn.MouseButton1Click:Connect(function()
            local rootPart = getRootPart()
            if rootPart then
                -- Ultra bypass DOWN
                local targetY = rootPart.Position.Y - 85
                
                -- Phase shift down
                for i = 1, 5 do
                    rootPart.CFrame = rootPart.CFrame - Vector3.new(0, 17, 0)
                    rootPart.Velocity = Vector3.new(0, 0, 0)
                    wait(0.01)
                end
            end
        end)
    end
})

-- Enhanced Base System
Tabs.Misc:AddSection("📍 Base System")

local baseSystemGui = nil

-- Auto-set spawn position when character spawns
player.CharacterAdded:Connect(function(character)
    wait(2) -- Wait for character to fully load
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if rootPart then
        if not basePosition then -- Only auto-set if no base is manually configured
            basePosition = rootPart.Position
            Fluent:Notify({
                Title = "Base System",
                Content = "Spawn position automatically set as base!",
                Duration = 3
            })
        end
    end
end)

Tabs.Misc:AddButton({
    Title = "📍 Open Base System (Ultra Bypass)",
    Description = "Advanced ultra-bypass base teleportation",
    Callback = function()
        if baseSystemGui then
            baseSystemGui:Destroy()
        end
        
        baseSystemGui = Instance.new("ScreenGui")
        baseSystemGui.Name = "BaseSystem"
        baseSystemGui.Parent = playerGui
        baseSystemGui.ResetOnSpawn = false
        
        local frame = Instance.new("Frame")
        frame.Size = UDim2.fromOffset(220, 180)
        frame.Position = UDim2.new(0, 200, 0.4, 0)
        frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        frame.BackgroundTransparency = 0.1
        frame.BorderSizePixel = 0
        frame.Active = true
        frame.Draggable = true
        frame.Parent = baseSystemGui
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = frame
        
        local stroke = Instance.new("UIStroke")
        stroke.Color = Color3.fromRGB(0, 170, 255)
        stroke.Transparency = 0.5
        stroke.Thickness = 1
        stroke.Parent = frame
        
        local titleBar = Instance.new("Frame")
        titleBar.Size = UDim2.new(1, 0, 0, 25)
        titleBar.Position = UDim2.new(0, 0, 0, 0)
        titleBar.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
        titleBar.BackgroundTransparency = 0.3
        titleBar.BorderSizePixel = 0
        titleBar.Parent = frame
        
        local titleCorner = Instance.new("UICorner")
        titleCorner.CornerRadius = UDim.new(0, 8)
        titleCorner.Parent = titleBar
        
        local titleFix = Instance.new("Frame")
        titleFix.Size = UDim2.new(1, 0, 0, 8)
        titleFix.Position = UDim2.new(0, 0, 1, -8)
        titleFix.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
        titleFix.BackgroundTransparency = 0.3
        titleFix.BorderSizePixel = 0
        titleFix.Parent = titleBar
        
        local title = Instance.new("TextLabel")
        title.Size = UDim2.new(1, -25, 1, 0)
        title.Position = UDim2.new(0, 5, 0, 0)
        title.BackgroundTransparency = 1
        title.Text = "📍 Ultra Bypass Base"
        title.TextColor3 = Color3.fromRGB(255, 255, 255)
        title.TextSize = 11
        title.Font = Enum.Font.SourceSansBold
        title.TextXAlignment = Enum.TextXAlignment.Left
        title.Parent = titleBar
        
        local closeBtn = Instance.new("TextButton")
        closeBtn.Size = UDim2.fromOffset(20, 20)
        closeBtn.Position = UDim2.new(1, -22, 0, 2.5)
        closeBtn.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
        closeBtn.BackgroundTransparency = 0.2
        closeBtn.Text = "×"
        closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        closeBtn.TextSize = 12
        closeBtn.Font = Enum.Font.SourceSansBold
        closeBtn.Parent = titleBar
        
        local closeCorner = Instance.new("UICorner")
        closeCorner.CornerRadius = UDim.new(0, 4)
        closeCorner.Parent = closeBtn
        
        closeBtn.MouseButton1Click:Connect(function()
            baseSystemGui:Destroy()
        end)
        
        -- Base status section
        local statusSection = Instance.new("Frame")
        statusSection.Size = UDim2.new(1, -10, 0, 25)
        statusSection.Position = UDim2.new(0, 5, 0, 30)
        statusSection.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        statusSection.BackgroundTransparency = 0.3
        statusSection.BorderSizePixel = 0
        statusSection.Parent = frame
        
        local statusCorner = Instance.new("UICorner")
        statusCorner.CornerRadius = UDim.new(0, 6)
        statusCorner.Parent = statusSection
        
        local statusLabel = Instance.new("TextLabel")
        statusLabel.Size = UDim2.new(1, -10, 1, 0)
        statusLabel.Position = UDim2.new(0, 5, 0, 0)
        statusLabel.BackgroundTransparency = 1
        statusLabel.Text = basePosition and "✅ Base Position Set" or "❌ Base Position Not Set"
        statusLabel.TextColor3 = basePosition and Color3.fromRGB(100, 255, 100) or Color3.fromRGB(255, 100, 100)
        statusLabel.TextSize = 10
        statusLabel.Font = Enum.Font.SourceSans
        statusLabel.TextXAlignment = Enum.TextXAlignment.Left
        statusLabel.Parent = statusSection
        
        -- Coordinates display
        local coordsSection = Instance.new("Frame")
        coordsSection.Size = UDim2.new(1, -10, 0, 30)
        coordsSection.Position = UDim2.new(0, 5, 0, 60)
        coordsSection.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
        coordsSection.BackgroundTransparency = 0.3
        coordsSection.BorderSizePixel = 0
        coordsSection.Parent = frame
        
        local coordsCorner = Instance.new("UICorner")
        coordsCorner.CornerRadius = UDim.new(0, 6)
        coordsCorner.Parent = coordsSection
        
        local coordsLabel = Instance.new("TextLabel")
        coordsLabel.Size = UDim2.new(1, -10, 1, 0)
        coordsLabel.Position = UDim2.new(0, 5, 0, 0)
        coordsLabel.BackgroundTransparency = 1
        coordsLabel.Text = basePosition and string.format("📍 X:%.1f Y:%.1f Z:%.1f", basePosition.X, basePosition.Y, basePosition.Z) or "📍 No coordinates set"
        coordsLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        coordsLabel.TextSize = 9
        coordsLabel.Font = Enum.Font.SourceSans
        coordsLabel.TextXAlignment = Enum.TextXAlignment.Left
        coordsLabel.Parent = coordsSection
        
        -- Set Base button
        local setBtn = Instance.new("TextButton")
        setBtn.Size = UDim2.new(1, -10, 0, 30)
        setBtn.Position = UDim2.new(0, 5, 0, 95)
        setBtn.BackgroundColor3 = Color3.fromRGB(40, 167, 69)
        setBtn.BackgroundTransparency = 0.2
        setBtn.Text = "SET BASE POSITION"
        setBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        setBtn.TextSize = 10
        setBtn.Font = Enum.Font.SourceSansBold
        setBtn.Parent = frame
        
        local setCorner = Instance.new("UICorner")
        setCorner.CornerRadius = UDim.new(0, 6)
        setCorner.Parent = setBtn
        
        -- Ultra Bypass TP button
        local ultraTPBtn = Instance.new("TextButton")
        ultraTPBtn.Size = UDim2.new(1, -10, 0, 35)
        ultraTPBtn.Position = UDim2.new(0, 5, 0, 130)
        ultraTPBtn.BackgroundColor3 = Color3.fromRGB(148, 0, 211)
        ultraTPBtn.BackgroundTransparency = 0.2
        ultraTPBtn.Text = "🚀 ULTRA BYPASS TP"
        ultraTPBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        ultraTPBtn.TextSize = 12
        ultraTPBtn.Font = Enum.Font.SourceSansBold
        ultraTPBtn.Parent = frame
        
        local ultraTPCorner = Instance.new("UICorner")
        ultraTPCorner.CornerRadius = UDim.new(0, 6)
        ultraTPCorner.Parent = ultraTPBtn
        
        -- Glow effect for Ultra Bypass button
        local ultraTPStroke = Instance.new("UIStroke")
        ultraTPStroke.Color = Color3.fromRGB(255, 0, 255)
        ultraTPStroke.Transparency = 0.5
        ultraTPStroke.Thickness = 2
        ultraTPStroke.Parent = ultraTPBtn
        
        -- Function to update display elements
        local function updateDisplay()
            if basePosition then
                statusLabel.Text = "✅ Base Position Set"
                statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
                coordsLabel.Text = string.format("📍 X:%.1f Y:%.1f Z:%.1f", basePosition.X, basePosition.Y, basePosition.Z)
                coordsLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
            else
                statusLabel.Text = "❌ Base Position Not Set"
                statusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
                coordsLabel.Text = "📍 No coordinates set"
                coordsLabel.TextColor3 = Color3.fromRGB(120, 120, 120)
            end
        end
        
        -- Event handlers
        setBtn.MouseButton1Click:Connect(function()
            local character = player.Character
            local rootPart = character and character:FindFirstChild("HumanoidRootPart")
            
            if rootPart then
                basePosition = rootPart.Position
                updateDisplay()
                
                -- Visual feedback on button
                local originalColor = setBtn.BackgroundColor3
                local originalText = setBtn.Text
                setBtn.BackgroundColor3 = Color3.fromRGB(100, 255, 100)
                setBtn.Text = "✅ BASE SET!"
                
                task.spawn(function()
                    task.wait(1.5)
                    if setBtn and setBtn.Parent then
                        setBtn.BackgroundColor3 = originalColor
                        setBtn.Text = originalText
                    end
                end)
                
                Fluent:Notify({
                    Title = "Base System",
                    Content = string.format("Base set at X:%.1f Y:%.1f Z:%.1f", basePosition.X, basePosition.Y, basePosition.Z),
                    Duration = 4
                })
            else
                Fluent:Notify({
                    Title = "Base System",
                    Content = "Error: Cannot detect player position.",
                    Duration = 4
                })
            end
        end)
        
        ultraTPBtn.MouseButton1Click:Connect(function()
            if not basePosition then
                Fluent:Notify({
                    Title = "Ultra Bypass TP",
                    Content = "Please set a base position first!",
                    Duration = 4
                })
                
                -- Highlight set button
                local originalColor = setBtn.BackgroundColor3
                setBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
                task.spawn(function()
                    task.wait(1.5)
                    if setBtn and setBtn.Parent then
                        setBtn.BackgroundColor3 = originalColor
                    end
                end)
                return
            end
            
            Fluent:Notify({
                Title = "Ultra Bypass TP",
                Content = "Initiating quantum phase shift...",
                Duration = 2
            })
            
            ultraBypassTeleport(basePosition)
        end)
        
        -- Pulse animation for Ultra Bypass button
        spawn(function()
            while ultraTPBtn and ultraTPBtn.Parent do
                TweenService:Create(ultraTPStroke, TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
                    Transparency = 0.8
                }):Play()
                wait(1)
                TweenService:Create(ultraTPStroke, TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
                    Transparency = 0.3
                }):Play()
                wait(1)
            end
        end)
        
        -- Initial display update
        updateDisplay()
    end
})

-- MONEY TAB
local moneyLabel = Tabs.Money:AddParagraph({
    Title = "💰 Current Money",
    Content = "Loading..."
})

Tabs.Money:AddToggle("AutoCollectMoney", {
    Title = "🔄 Auto Collect Money",
    Description = "Automatically collect money items",
    Default = false,
    Callback = function(value)
        states.autoCollectMoney = value
    end
})

Tabs.Money:AddButton({
    Title = "📦 Give All Items",
    Description = "Collect all available items in the game",
    Callback = function()
        local collected = 0
        local character = getCharacter()
        if not character then return end
        
        local backpack = player:FindFirstChild("Backpack")
        if not backpack then return end
        
        local rootPart = getRootPart()
        if not rootPart then return end
        
        for _, obj in ipairs(Workspace:GetDescendants()) do
            if obj:IsA("Tool") and not obj.Parent:IsA("Model") then
                pcall(function()
                    obj.Parent = backpack
                    collected = collected + 1
                end)
            elseif obj:IsA("BasePart") then
                local name = obj.Name:lower()
                if name:match("item") or name:match("coin") or name:match("collectible") or 
                   name:match("pickup") or name:match("drop") or name:match("loot") then
                    pcall(function()
                        obj.CFrame = rootPart.CFrame
                        collected = collected + 1
                    end)
                end
            elseif obj:IsA("ProximityPrompt") then
                pcall(function()
                    fireproximityprompt(obj)
                    collected = collected + 1
                end)
            end
        end
        
        for _, obj in ipairs(ReplicatedStorage:GetDescendants()) do
            if obj:IsA("Tool") then
                pcall(function()
                    local clone = obj:Clone()
                    clone.Parent = backpack
                    collected = collected + 1
                end)
            end
        end
        
        Fluent:Notify({
            Title = "Item Collector",
            Content = "Collected " .. collected .. " items!",
            Duration = 3
        })
    end
})

-- SERVER TAB
Tabs.Server:AddSection("🔄 Server Controls")

Tabs.Server:AddButton({
    Title = "🔄 Rejoin Server",
    Description = "Rejoin the current server",
    Callback = function()
        TeleportService:Teleport(game.PlaceId, player)
    end
})

Tabs.Server:AddButton({
    Title = "🚪 Leave Game",
    Description = "Leave the current game",
    Callback = function()
        player:Kick("Left the game via Water Hub")
    end
})

Tabs.Server:AddButton({
    Title = "🌐 Server Hop",
    Description = "Find and join a different server",
    Callback = function()
        local servers = {}
        local req = syn and syn.request or http_request or request
        
        if req then
            local success, result = pcall(function()
                return req({
                    Url = "https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100",
                    Method = "GET"
                })
            end)
            
            if success and result.Success then
                local data = HttpService:JSONDecode(result.Body)
                for _, server in pairs(data.data) do
                    if server.playing < server.maxPlayers and server.id ~= game.JobId then
                        table.insert(servers, server.id)
                    end
                end
                
                if #servers > 0 then
                    TeleportService:TeleportToPlaceInstance(game.PlaceId, servers[math.random(1, #servers)])
                else
                    Fluent:Notify({
                        Title = "Server Hop",
                        Content = "No available servers found!",
                        Duration = 3
                    })
                end
            end
        end
    end
})

local playerCountLabel = Tabs.Server:AddParagraph({
    Title = "👥 Players",
    Content = #Players:GetPlayers() .. "/" .. Players.MaxPlayers
})

local serverIdLabel = Tabs.Server:AddParagraph({
    Title = "🆔 Server ID",
    Content = game.JobId:sub(1, 12) .. "..."
})

local pingLabel = Tabs.Server:AddParagraph({
    Title = "📡 Ping",
    Content = "Calculating..."
})

-- Update functions
local function updateMoneyLabel()
    local leaderstats = player:FindFirstChild("leaderstats")
    if leaderstats then
        local money = leaderstats:FindFirstChild("Money") or leaderstats:FindFirstChild("Cash") or leaderstats:FindFirstChild("Coins")
        if money then
            moneyLabel:SetDesc("💰 " .. tostring(money.Value))
        end
    else
        moneyLabel:SetDesc("💰 0 (No leaderstats found)")
    end
end

local function autoCollectMoneyFunc()
    if not states.autoCollectMoney then return end
    
    local rootPart = getRootPart()
    if not rootPart then return end
    
    for _, v in pairs(Workspace:GetDescendants()) do
        if v.Name:lower():find("money") or v.Name:lower():find("cash") or v.Name:lower():find("coin") then
            if v:IsA("Part") then
                local distance = (v.Position - rootPart.Position).Magnitude
                if distance <= 50 then
                    pcall(function()
                        firetouchinterest(rootPart, v, 0)
                        firetouchinterest(rootPart, v, 1)
                    end)
                end
            end
        end
    end
end

local function fastStealFunc()
    if not states.fastSteal then return end
    
    for _, v in pairs(Workspace:GetDescendants()) do
        if v:IsA("ProximityPrompt") then
            v.HoldDuration = 0
            v.KeyboardKeyCode = Enum.KeyCode.E
            v.ActionText = "Instant Steal"
        end
    end
end

local function updateESP()
    if states.espPlayers then
        for _, targetPlayer in pairs(Players:GetPlayers()) do
            if targetPlayer ~= Players.LocalPlayer and targetPlayer.Character then
                local highlight = targetPlayer.Character:FindFirstChild("Highlight")
                if not highlight then
                    highlight = Instance.new("Highlight")
                    highlight.Parent = targetPlayer.Character
                    highlight.FillColor = Color3.fromRGB(255, 0, 0)
                    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                    highlight.FillTransparency = 0.5
                    highlight.OutlineTransparency = 0
                end
            end
        end
    end
    
    if states.espBox then
        for _, targetPlayer in pairs(Players:GetPlayers()) do
            if targetPlayer ~= Players.LocalPlayer and targetPlayer.Character then
                if not targetPlayer.Character:FindFirstChild("ESPBox") then
                    createESPBox(targetPlayer.Character)
                end
            end
        end
    end
end

-- Event handlers
Players.PlayerAdded:Connect(function(newPlayer)
    newPlayer.CharacterAdded:Connect(function(character)
        wait(1)
        if states.espPlayers and newPlayer ~= Players.LocalPlayer then
            local highlight = Instance.new("Highlight")
            highlight.Parent = character
            highlight.FillColor = Color3.fromRGB(255, 0, 0)
            highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
            highlight.FillTransparency = 0.5
        end
        if states.espBox and newPlayer ~= Players.LocalPlayer then
            createESPBox(character)
        end
    end)
end)

Players.PlayerRemoving:Connect(function(leavingPlayer)
    if leavingPlayer.Character then
        local highlight = leavingPlayer.Character:FindFirstChild("Highlight")
        if highlight then
            highlight:Destroy()
        end
        removeESPBox(leavingPlayer.Character)
    end
end)

player.CharacterAdded:Connect(function(character)
    wait(1)
    
    local restoredFeatures = {}
    
    if states.speedBoost then
        local humanoid = character:FindFirstChild("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = originalWalkSpeed * 8
            humanoid.JumpPower = originalJumpPower * 4
            table.insert(restoredFeatures, "Speed Boost")
        end
    end
    
    if states.godMode then
        if connections.godMode then
            connections.godMode:Disconnect()
        end
        connections.godMode = RunService.Heartbeat:Connect(function()
            local humanoid = character:FindFirstChild("Humanoid")
            if humanoid then
                humanoid.Health = humanoid.MaxHealth
            end
        end)
        table.insert(restoredFeatures, "God Mode")
    end
    
    if states.antiStun then
        toggleAntiStun(true)
        table.insert(restoredFeatures, "Anti Stun")
    end
    
    if states.infiniteJump then
        toggleInfiniteJump(true)
        table.insert(restoredFeatures, "Infinite Jump")
    end
    
    if #restoredFeatures > 0 then
        Fluent:Notify({
            Title = "Features Restored",
            Content = "Restored: " .. table.concat(restoredFeatures, ", "),
            Duration = 3
        })
    end
end)

-- Main update loop
RunService.Heartbeat:Connect(function()
    updateMoneyLabel()
    autoCollectMoneyFunc()
    fastStealFunc()
    updateESP()
    
    if tick() % 2 < 0.016 then
        playerCountLabel:SetDesc("👥 " .. #Players:GetPlayers() .. "/" .. Players.MaxPlayers)
        
        local ping = player:GetNetworkPing()
        if ping then
            pingLabel:SetDesc("📡 " .. math.floor(ping * 1000) .. "ms")
        end
    end
end)

-- Configure managers
SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
SaveManager:IgnoreThemeSettings()
InterfaceManager:SetFolder("FluentMobile")
SaveManager:SetFolder("FluentMobile/config")

Window:SelectTab(1)

Fluent:Notify({
    Title = "💧 Water HUB Loaded",
    Content = "Ultra Bypass System Activated! Enjoy your enhanced experience!",
    Duration = 5,
    Image = "rbxassetid://84130584727260"
})

-- Anti-AFK
game:GetService("Players").LocalPlayer.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

SaveManager:LoadAutoloadConfig()
