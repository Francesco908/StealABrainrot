-- Water Hub - Advanced Admin Script
-- Modern Fluent UI Design with Full Functionality

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Variables
local waterHub = {}
local connections = {}
local isFlying = false
local flySpeed = 50
local isInvisible = false
local hasAirJump = false
local espEnabled = false
local espConnections = {}
local lockTarget = nil
local lockPosition = nil
local autoLockEnabled = false
local speedBoostEnabled = false
local originalWalkSpeed = 16

-- Create Main GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "WaterHub"
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false

-- Main Frame (Fluent UI Style)
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 450, 0, 350)
mainFrame.Position = UDim2.new(0.5, -225, 0.5, -175)
mainFrame.BackgroundColor3 = Color3.fromRGB(32, 32, 32)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

-- Add corner rounding
local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 12)
mainCorner.Parent = mainFrame

-- Title Bar
local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 40)
titleBar.Position = UDim2.new(0, 0, 0, 0)
titleBar.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 12)
titleCorner.Parent = titleBar

-- Title Text
local titleText = Instance.new("TextLabel")
titleText.Name = "TitleText"
titleText.Size = UDim2.new(1, -80, 1, 0)
titleText.Position = UDim2.new(0, 15, 0, 0)
titleText.BackgroundTransparency = 1
titleText.Text = "Water Hub"
titleText.TextColor3 = Color3.fromRGB(255, 255, 255)
titleText.TextScaled = true
titleText.Font = Enum.Font.GothamBold
titleText.Parent = titleBar

-- Minimize Button
local minimizeButton = Instance.new("TextButton")
minimizeButton.Name = "MinimizeButton"
minimizeButton.Size = UDim2.new(0, 30, 0, 30)
minimizeButton.Position = UDim2.new(1, -70, 0, 5)
minimizeButton.BackgroundColor3 = Color3.fromRGB(255, 193, 7)
minimizeButton.BorderSizePixel = 0
minimizeButton.Text = "-"
minimizeButton.TextColor3 = Color3.fromRGB(0, 0, 0)
minimizeButton.TextScaled = true
minimizeButton.Font = Enum.Font.GothamBold
minimizeButton.Parent = titleBar

local minimizeCorner = Instance.new("UICorner")
minimizeCorner.CornerRadius = UDim.new(0, 6)
minimizeCorner.Parent = minimizeButton

-- Close Button
local closeButton = Instance.new("TextButton")
closeButton.Name = "CloseButton"
closeButton.Size = UDim2.new(0, 30, 0, 30)
closeButton.Position = UDim2.new(1, -35, 0, 5)
closeButton.BackgroundColor3 = Color3.fromRGB(220, 53, 69)
closeButton.BorderSizePixel = 0
closeButton.Text = "X"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.TextScaled = true
closeButton.Font = Enum.Font.GothamBold
closeButton.Parent = titleBar

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 6)
closeCorner.Parent = closeButton

-- Tab Container
local tabContainer = Instance.new("Frame")
tabContainer.Name = "TabContainer"
tabContainer.Size = UDim2.new(1, 0, 0, 40)
tabContainer.Position = UDim2.new(0, 0, 0, 40)
tabContainer.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
tabContainer.BorderSizePixel = 0
tabContainer.Parent = mainFrame

-- Content Frame
local contentFrame = Instance.new("Frame")
contentFrame.Name = "ContentFrame"
contentFrame.Size = UDim2.new(1, 0, 1, -80)
contentFrame.Position = UDim2.new(0, 0, 0, 80)
contentFrame.BackgroundColor3 = Color3.fromRGB(32, 32, 32)
contentFrame.BorderSizePixel = 0
contentFrame.Parent = mainFrame

-- Tab System
local tabs = {"Main", "ESP", "Misc", "Server"}
local tabButtons = {}
local tabContents = {}
local activeTab = "Main"

-- Create Tab Buttons
for i, tabName in ipairs(tabs) do
    local tabButton = Instance.new("TextButton")
    tabButton.Name = tabName .. "Tab"
    tabButton.Size = UDim2.new(0.25, 0, 1, 0)
    tabButton.Position = UDim2.new((i-1) * 0.25, 0, 0, 0)
    tabButton.BackgroundColor3 = tabName == activeTab and Color3.fromRGB(0, 123, 255) or Color3.fromRGB(50, 50, 50)
    tabButton.BorderSizePixel = 0
    tabButton.Text = tabName
    tabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    tabButton.TextScaled = true
    tabButton.Font = Enum.Font.Gotham
    tabButton.Parent = tabContainer
    
    tabButtons[tabName] = tabButton
    
    -- Create content frame for each tab
    local content = Instance.new("ScrollingFrame")
    content.Name = tabName .. "Content"
    content.Size = UDim2.new(1, 0, 1, 0)
    content.Position = UDim2.new(0, 0, 0, 0)
    content.BackgroundTransparency = 1
    content.BorderSizePixel = 0
    content.ScrollBarThickness = 5
    content.CanvasSize = UDim2.new(0, 0, 0, 0)
    content.AutomaticCanvasSize = Enum.AutomaticSize.Y
    content.Visible = tabName == activeTab
    content.Parent = contentFrame
    
    tabContents[tabName] = content
end

-- Helper Function to Create Buttons
local function createButton(parent, text, position, callback)
    local button = Instance.new("TextButton")
    button.Name = text .. "Button"
    button.Size = UDim2.new(0, 200, 0, 35)
    button.Position = position
    button.BackgroundColor3 = Color3.fromRGB(0, 123, 255)
    button.BorderSizePixel = 0
    button.Text = text
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextScaled = true
    button.Font = Enum.Font.Gotham
    button.Parent = parent
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = button
    
    button.MouseButton1Click:Connect(callback)
    
    return button
end

-- Helper Function to Create Toggle Buttons
local function createToggle(parent, text, position, callback)
    local frame = Instance.new("Frame")
    frame.Name = text .. "Frame"
    frame.Size = UDim2.new(0, 200, 0, 35)
    frame.Position = position
    frame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    frame.BorderSizePixel = 0
    frame.Parent = parent
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = frame
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.Position = UDim2.new(0, 10, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextScaled = true
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame
    
    local toggle = Instance.new("TextButton")
    toggle.Name = "Toggle"
    toggle.Size = UDim2.new(0, 50, 0, 25)
    toggle.Position = UDim2.new(1, -60, 0.5, -12.5)
    toggle.BackgroundColor3 = Color3.fromRGB(220, 53, 69)
    toggle.BorderSizePixel = 0
    toggle.Text = "OFF"
    toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggle.TextScaled = true
    toggle.Font = Enum.Font.GothamBold
    toggle.Parent = frame
    
    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(0, 12)
    toggleCorner.Parent = toggle
    
    local isOn = false
    toggle.MouseButton1Click:Connect(function()
        isOn = not isOn
        toggle.BackgroundColor3 = isOn and Color3.fromRGB(40, 167, 69) or Color3.fromRGB(220, 53, 69)
        toggle.Text = isOn and "ON" or "OFF"
        callback(isOn)
    end)
    
    return toggle
end

-- ESP Functions
local function createESP(target)
    if not target or not target.Character then return end
    
    local character = target.Character
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end
    
    local box = Instance.new("BoxHandleAdornment")
    box.Name = "ESP_Box"
    box.Size = character:GetExtentsSize()
    box.Color3 = Color3.fromRGB(255, 0, 0)
    box.Transparency = 0.5
    box.AlwaysOnTop = true
    box.ZIndex = 10
    box.Adornee = humanoidRootPart
    box.Parent = humanoidRootPart
    
    local nameLabel = Instance.new("BillboardGui")
    nameLabel.Name = "ESP_Name"
    nameLabel.Size = UDim2.new(0, 200, 0, 50)
    nameLabel.Adornee = humanoidRootPart
    nameLabel.Parent = humanoidRootPart
    
    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = target.Name
    textLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
    textLabel.TextScaled = true
    textLabel.Font = Enum.Font.GothamBold
    textLabel.Parent = nameLabel
end

local function removeESP(target)
    if not target or not target.Character then return end
    
    local character = target.Character
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end
    
    local box = humanoidRootPart:FindFirstChild("ESP_Box")
    local nameLabel = humanoidRootPart:FindFirstChild("ESP_Name")
    
    if box then box:Destroy() end
    if nameLabel then nameLabel:Destroy() end
end

-- Flight System
local function startFlying()
    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end
    
    local humanoidRootPart = player.Character.HumanoidRootPart
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.Parent = humanoidRootPart
    
    local camera = workspace.CurrentCamera
    
    connections.flying = RunService.Heartbeat:Connect(function()
        if not isFlying then
            bodyVelocity:Destroy()
            connections.flying:Disconnect()
            return
        end
        
        local moveVector = Vector3.new(0, 0, 0)
        
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then
            moveVector = moveVector + camera.CFrame.LookVector
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then
            moveVector = moveVector - camera.CFrame.LookVector
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then
            moveVector = moveVector - camera.CFrame.RightVector
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then
            moveVector = moveVector + camera.CFrame.RightVector
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
            moveVector = moveVector + Vector3.new(0, 1, 0)
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
            moveVector = moveVector - Vector3.new(0, 1, 0)
        end
        
        bodyVelocity.Velocity = moveVector.Unit * flySpeed
    end)
end

-- Helper GUI System
local function createHelperGUI()
    local helperGui = Instance.new("ScreenGui")
    helperGui.Name = "HelperGui"
    helperGui.Parent = playerGui
    
    local helperFrame = Instance.new("Frame")
    helperFrame.Name = "HelperFrame"
    helperFrame.Size = UDim2.new(0, 200, 0, 100)
    helperFrame.Position = UDim2.new(0.5, -100, 0.5, -50)
    helperFrame.BackgroundColor3 = Color3.fromRGB(32, 32, 32)
    helperFrame.BorderSizePixel = 0
    helperFrame.Active = true
    helperFrame.Draggable = true
    helperFrame.Parent = helperGui
    
    local helperCorner = Instance.new("UICorner")
    helperCorner.CornerRadius = UDim.new(0, 12)
    helperCorner.Parent = helperFrame
    
    local upButton = createButton(helperFrame, "GO UP (165)", UDim2.new(0, 10, 0, 10), function()
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            player.Character.HumanoidRootPart.CFrame = player.Character.HumanoidRootPart.CFrame + Vector3.new(0, 165, 0)
        end
    end)
    upButton.Size = UDim2.new(0, 180, 0, 25)
    
    local downButton = createButton(helperFrame, "GO DOWN (50)", UDim2.new(0, 10, 0, 45), function()
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            player.Character.HumanoidRootPart.CFrame = player.Character.HumanoidRootPart.CFrame - Vector3.new(0, 50, 0)
        end
    end)
    downButton.Size = UDim2.new(0, 180, 0, 25)
    
    local closeHelper = createButton(helperFrame, "X", UDim2.new(1, -25, 0, 5), function()
        helperGui:Destroy()
    end)
    closeHelper.Size = UDim2.new(0, 20, 0, 20)
    closeHelper.BackgroundColor3 = Color3.fromRGB(220, 53, 69)
    
    return helperGui
end

-- Auto Lock GUI
local function createAutoLockGUI()
    local lockGui = Instance.new("ScreenGui")
    lockGui.Name = "AutoLockGui"
    lockGui.Parent = playerGui
    
    local lockFrame = Instance.new("Frame")
    lockFrame.Name = "LockFrame"
    lockFrame.Size = UDim2.new(0, 250, 0, 120)
    lockFrame.Position = UDim2.new(0.5, -125, 0.5, -60)
    lockFrame.BackgroundColor3 = Color3.fromRGB(32, 32, 32)
    lockFrame.BorderSizePixel = 0
    lockFrame.Active = true
    lockFrame.Draggable = true
    lockFrame.Parent = lockGui
    
    local lockCorner = Instance.new("UICorner")
    lockCorner.CornerRadius = UDim.new(0, 12)
    lockCorner.Parent = lockFrame
    
    local setLockButton = createButton(lockFrame, "Set Lock", UDim2.new(0, 25, 0, 20), function()
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            lockPosition = player.Character.HumanoidRootPart.Position
            lockTarget = player.Character.HumanoidRootPart.CFrame
            print("Lock position set!")
        end
    end)
    setLockButton.Size = UDim2.new(0, 200, 0, 30)
    
    local tpLockButton = createButton(lockFrame, "TP to Lock", UDim2.new(0, 25, 0, 60), function()
        if lockPosition and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            -- Respawn player
            player.Character.Humanoid.Health = 0
            wait(5)
            
            -- Teleport with speed boost
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local humanoid = player.Character:FindFirstChild("Humanoid")
                if humanoid then
                    humanoid.WalkSpeed = 50
                    player.Character.HumanoidRootPart.CFrame = CFrame.new(lockPosition)
                    wait(2)
                    humanoid.WalkSpeed = 16
                end
            end
        end
    end)
    tpLockButton.Size = UDim2.new(0, 200, 0, 30)
    
    local closeLock = createButton(lockFrame, "X", UDim2.new(1, -25, 0, 5), function()
        lockGui:Destroy()
    end)
    closeLock.Size = UDim2.new(0, 20, 0, 20)
    closeLock.BackgroundColor3 = Color3.fromRGB(220, 53, 69)
    
    return lockGui
end

-- Populate Main Tab
local mainContent = tabContents["Main"]
local yPos = 0

-- Helper Button
createButton(mainContent, "Helper", UDim2.new(0, 25, 0, yPos), function()
    createHelperGUI()
end)
yPos = yPos + 50

-- Float Toggle
createToggle(mainContent, "Float", UDim2.new(0, 25, 0, yPos), function(enabled)
    isFlying = enabled
    if enabled then
        startFlying()
    end
end)
yPos = yPos + 50

-- Air Jump Toggle
createToggle(mainContent, "Air Jump", UDim2.new(0, 25, 0, yPos), function(enabled)
    hasAirJump = enabled
    if enabled then
        connections.airJump = UserInputService.JumpRequest:Connect(function()
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                player.Character.HumanoidRootPart.AssemblyLinearVelocity = Vector3.new(0, 50, 0)
            end
        end)
    else
        if connections.airJump then
            connections.airJump:Disconnect()
        end
    end
end)
yPos = yPos + 50

-- Invisible Player Toggle
createToggle(mainContent, "Invisible Player", UDim2.new(0, 25, 0, yPos), function(enabled)
    isInvisible = enabled
    if player.Character then
        for _, part in pairs(player.Character:GetChildren()) do
            if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                part.Transparency = enabled and 1 or 0
            elseif part:IsA("Accessory") then
                part.Handle.Transparency = enabled and 1 or 0
            end
        end
    end
end)
yPos = yPos + 50

-- Speed Boost Toggle
createToggle(mainContent, "Speed Boost (50%)", UDim2.new(0, 25, 0, yPos), function(enabled)
    speedBoostEnabled = enabled
    if player.Character and player.Character:FindFirstChild("Humanoid") then
        local humanoid = player.Character.Humanoid
        if enabled then
            originalWalkSpeed = humanoid.WalkSpeed
            humanoid.WalkSpeed = originalWalkSpeed * 1.5
        else
            humanoid.WalkSpeed = originalWalkSpeed
        end
    end
end)
yPos = yPos + 50

-- Auto Lock Button
createButton(mainContent, "Auto Lock", UDim2.new(0, 25, 0, yPos), function()
    createAutoLockGUI()
end)

-- Populate ESP Tab
local espContent = tabContents["ESP"]
yPos = 0

-- ESP Players Toggle
createToggle(espContent, "ESP Players", UDim2.new(0, 25, 0, yPos), function(enabled)
    espEnabled = enabled
    if enabled then
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= player then
                createESP(p)
            end
        end
        
        espConnections.playerAdded = Players.PlayerAdded:Connect(function(p)
            if espEnabled then
                createESP(p)
            end
        end)
        
        espConnections.playerRemoving = Players.PlayerRemoving:Connect(function(p)
            removeESP(p)
        end)
    else
        for _, p in pairs(Players:GetPlayers()) do
            removeESP(p)
        end
        
        for _, connection in pairs(espConnections) do
            connection:Disconnect()
        end
        espConnections = {}
    end
end)
yPos = yPos + 50

-- ESP Names Toggle
createToggle(espContent, "ESP Names", UDim2.new(0, 25, 0, yPos), function(enabled)
    -- This is handled within the ESP creation function
end)

-- Populate Misc Tab
local miscContent = tabContents["Misc"]
local soonLabel = Instance.new("TextLabel")
soonLabel.Size = UDim2.new(0, 200, 0, 50)
soonLabel.Position = UDim2.new(0, 25, 0, 25)
soonLabel.BackgroundTransparency = 1
soonLabel.Text = "Soon..."
soonLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
soonLabel.TextScaled = true
soonLabel.Font = Enum.Font.Gotham
soonLabel.Parent = miscContent

-- Populate Server Tab
local serverContent = tabContents["Server"]
yPos = 0

-- Leave Server Button
createButton(serverContent, "Leave Server", UDim2.new(0, 25, 0, yPos), function()
    game:Shutdown()
end)
yPos = yPos + 50

-- Rejoin Server Button
createButton(serverContent, "Rejoin Server", UDim2.new(0, 25, 0, yPos), function()
    TeleportService:Teleport(game.PlaceId, player)
end)
yPos = yPos + 50

-- Server Hop Button
createButton(serverContent, "Server Hop", UDim2.new(0, 25, 0, yPos), function()
    local servers = HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"))
    if servers and servers.data then
        for _, server in pairs(servers.data) do
            if server.playing < server.maxPlayers and server.id ~= game.JobId then
                TeleportService:TeleportToPlaceInstance(game.PlaceId, server.id, player)
                break
            end
        end
    end
end)

-- Tab System Logic
for tabName, button in pairs(tabButtons) do
    button.MouseButton1Click:Connect(function()
        -- Update active tab
        activeTab = tabName
        
        -- Update button colors
        for name, btn in pairs(tabButtons) do
            btn.BackgroundColor3 = name == activeTab and Color3.fromRGB(0, 123, 255) or Color3.fromRGB(50, 50, 50)
        end
        
        -- Update content visibility
        for name, content in pairs(tabContents) do
            content.Visible = name == activeTab
        end
    end)
end

-- Minimize/Close functionality
local isMinimized = false
minimizeButton.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    local targetSize = isMinimized and UDim2.new(0, 450, 0, 40) or UDim2.new(0, 450, 0, 350)
    
    TweenService:Create(mainFrame, TweenInfo.new(0.3), {Size = targetSize}):Play()
    
    tabContainer.Visible = not isMinimized
    contentFrame.Visible = not isMinimized
    minimizeButton.Text = isMinimized and "+" or "-"
end)

closeButton.MouseButton1Click:Connect(function()
    -- Clean up connections
    for _, connection in pairs(connections) do
        connection:Disconnect()
    end
    for _, connection in pairs(espConnections) do
        connection:Disconnect()
    end
    
    screenGui:Destroy()
end)

-- Character respawn handling
player.CharacterAdded:Connect(function(character)
    wait(1)
    
    -- Reapply speed boost if enabled
    if speedBoostEnabled and character:FindFirstChild("Humanoid") then
        character.Humanoid.WalkSpeed = originalWalkSpeed * 1.5
    end
    
    -- Reapply invisible if enabled
    if isInvisible then
        for _, part in pairs(character:GetChildren()) do
            if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                part.Transparency = 1
            elseif part:IsA("Accessory") then
                part.Handle.Transparency = 1
            end
        end
    end
    
    -- Reapply ESP if enabled
    if espEnabled then
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= player then
                createESP(p)
            end
        end
    end
end)

print("Water Hub loaded successfully!")
