 -- Carica la libreria Fluent
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

-- Crea la finestra principale
local Window = Fluent:CreateWindow({
    Title = "Script Semplice",
    SubTitle = "Test UI",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl -- Tasto per minimizzare/ripristinare
})

-- Crea l'immagine persistente (sempre visibile)
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local persistentGui = Instance.new("ScreenGui")
persistentGui.Name = "FluentPersistentButton"
persistentGui.Parent = playerGui
persistentGui.ResetOnSpawn = false
persistentGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
persistentGui.Enabled = true

-- Immagine "fighissima" (personalizza con il tuo asset ID)
local imageButton = Instance.new("ImageButton")
imageButton.Name = "PersistentControl"
imageButton.Size = UDim2.fromOffset(70, 70)
imageButton.Position = UDim2.new(0, 20, 0.5, -35) -- Centro sinistra
imageButton.AnchorPoint = Vector2.new(0, 0.5)
imageButton.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
imageButton.BorderSizePixel = 0
imageButton.Image = "rbxassetid://7072717836" -- Icona razzo (sostituisci con il tuo ID)
imageButton.ScaleType = Enum.ScaleType.Fit
imageButton.Parent = persistentGui

-- Effetto trasparenza
imageButton.BackgroundTransparency = 0.5
imageButton.ImageTransparency = 0.2

-- Arrotonda gli angoli
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0.3, 0)
corner.Parent = imageButton

-- Effetto hover
local TweenService = game:GetService("TweenService")
local hoverTween = TweenService:Create(imageButton, TweenInfo.new(0.3), {
    BackgroundTransparency = 0.2,
    ImageTransparency = 0,
    Size = UDim2.fromOffset(75, 75)
})
local normalTween = TweenService:Create(imageButton, TweenInfo.new(0.3), {
    BackgroundTransparency = 0.5,
    ImageTransparency = 0.2,
    Size = UDim2.fromOffset(70, 70)
})

imageButton.MouseEnter:Connect(function()
    hoverTween:Play()
end)
imageButton.MouseLeave:Connect(function()
    normalTween:Play()
end)

-- Funzione per gestire il menu senza interferire con il gioco
local function toggleFluentMenu()
    local FluentGui = playerGui:FindFirstChild("Fluent")
    
    if FluentGui then
        local isMinimized = not FluentGui.Enabled
        
        -- Attiva/disattiva direttamente la GUI di Fluent
        FluentGui.Enabled = isMinimized
        
        -- Aggiorna lo stato minimizzato
        Window.Minimized = isMinimized
        
        -- Animazione di feedback
        local feedbackTween = TweenService:Create(imageButton, TweenInfo.new(0.2), {
            BackgroundColor3 = isMinimized and Color3.fromRGB(60, 40, 40) or Color3.fromRGB(25, 25, 25)
        })
        feedbackTween:Play()
    end
end

-- Click handler
imageButton.MouseButton1Click:Connect(toggleFluentMenu)
imageButton.TouchTap:Connect(toggleFluentMenu)

-- Disabilita l'interazione di LeftControl con il gioco
local UIS = game:GetService("UserInputService")

UIS.InputBegan:Connect(function(input, gameProcessed)
    if input.KeyCode == Enum.KeyCode.LeftControl and not gameProcessed then
        -- Blocca l'input al gioco quando viene premuto LeftControl
        toggleFluentMenu()
        return Enum.ContextActionResult.Sink
    end
end)

-- Crea le tab
local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "home" }),
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

-- TAB MAIN
Tabs.Main:AddButton({
    Title = "Pulsante Test",
    Description = "Clicca per testare",
    Callback = function()
        Fluent:Notify({
            Title = "Test",
            Content = "Pulsante premuto!",
            Duration = 3
        })
    end
})

-- TAB SETTINGS
Tabs.Settings:AddButton({
    Title = "Pulsante Settings",
    Description = "Pulsante nelle impostazioni",
    Callback = function()
        Fluent:Notify({
            Title = "Settings",
            Content = "Pulsante settings premuto!",
            Duration = 3
        })
    end
})

-- Configura i manager
SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
SaveManager:IgnoreThemeSettings()
InterfaceManager:SetFolder("FluentTest")
SaveManager:SetFolder("FluentTest/config")
InterfaceManager:BuildInterfaceSection(Tabs.Settings)
SaveManager:BuildConfigSection(Tabs.Settings)

-- Seleziona la prima tab
Window:SelectTab(1)

-- Notifica di caricamento
Fluent:Notify({
    Title = "Caricato",
    Content = "Script caricato con successo!",
    Duration = 5,
    Image = "rbxassetid://7072717836" -- Stessa icona dell'immagine persistente
})

-- Carica configurazione automatica
SaveManager:LoadAutoloadConfig()

-- Distruggi la GUI quando lo script viene chiuso
Fluent.Unloaded:Connect(function()
    persistentGui:Destroy()
end)
