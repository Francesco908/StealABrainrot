-- Load Fluent library
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

-- Create main window optimized for mobile
local Window = Fluent:CreateWindow({
    Title = "Water HUB",
    SubTitle = "Premium Script",
    TabWidth = 120,
    Size = UDim2.fromOffset(320, 350),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

-- Create persistent image (always visible)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local persistentGui = Instance.new("ScreenGui")
persistentGui.Name = "FluentPersistentButton"
persistentGui.Parent = playerGui
persistentGui.ResetOnSpawn = false
persistentGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
persistentGui.Enabled = true

-- Main button
local imageButton = Instance.new("ImageButton")
imageButton.Name = "PersistentControl"
imageButton.Size = UDim2.fromOffset(70, 70)
imageButton.Position = UDim2.new(0, 20, 0.5, -35)
imageButton.AnchorPoint = Vector2.new(0, 0.5)
imageButton.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
imageButton.BorderSizePixel = 0
imageButton.Image = "rbxassetid://7072717836"
imageButton.ScaleType = Enum.ScaleType.Fit
imageButton.Parent = persistentGui

-- Transparency effect
imageButton.BackgroundTransparency = 0.5
imageButton.ImageTransparency = 0.2

-- Rounded corners
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0.3, 0)
corner.Parent = imageButton

-- Hover effect
local TweenService = game:GetService("TweenService")
local hoverTween = TweenService:Create(imageButton, TweenInfo.new(0.3), {
    BackgroundTransparency = 0.2,
    ImageTransparency = 0,
    Size = UDim2.fromOffset(75, 75)
})
local normalTween = TweenService:Create(imageButton, TweenInfo.new(0.3), {
    BackgroundTransparency = 0.5,
    ImageTransparency = 0.2,
    Size = UDim2.fromOffset(70, 70)
})

imageButton.MouseEnter:Connect(function()
    hoverTween:Play()
end)
imageButton.MouseLeave:Connect(function()
    normalTween:Play()
end)

-- Dragging variables
local dragging = false
local dragStart = nil
local startPos = nil

-- Drag functions
local function onDragStart(input)
    dragging = true
    dragStart = input.Position
    startPos = imageButton.Position
end

local function onDragEnd(input)
    dragging = false
end

local function onDragMove(input)
    if dragging then
        local delta = input.Position - dragStart
        imageButton.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end

-- Connect drag events
imageButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        onDragStart(input)
    end
end)

imageButton.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        onDragEnd(input)
    end
end)

imageButton.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        onDragMove(input)
    end
end)

-- Toggle menu function
local function toggleMenu()
    if Window and Window.Root then
        Window.Root.Visible = not Window.Root.Visible
    end
end

-- Click handler
imageButton.MouseButton1Click:Connect(function()
    if not dragging then
        toggleMenu()
    end
end)

-- Intercept LeftControl
local UserInputService = game:GetService("UserInputService")
local function onKeyDown(key, gameProcessed)
    if key.KeyCode == Enum.KeyCode.LeftControl then
        if persistentGui.Enabled then
            toggleMenu()
            return
        end
    end
end

UserInputService.InputBegan:Connect(onKeyDown)

-- Variables for features
local speedBoostEnabled = false
local autoCollectMoney = false
local fastStealEnabled = false
local antiTrapEnabled = false
local antiStunEnabled = false
local espPlayersEnabled = false
local espBoxEnabled = false

-- Helper variables
local stealHelperGui = nil
local originalWalkSpeed = 16
local originalJumpPower = 50

-- Create tabs
local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "home" }),
    Visual = Window:AddTab({ Title = "Visual", Icon = "eye" }),
    Misc = Window:AddTab({ Title = "Misc", Icon = "settings" })
}

-- MAIN TAB
-- Speed Boost
Tabs.Main:AddToggle("SpeedBoost", {
    Title = "Speed Boost 8x (50% Bypass)",
    Default = false,
    Callback = function(value)
        speedBoostEnabled = value
        if player.Character and player.Character:FindFirstChild("Humanoid") then
            if value then
                player.Character.Humanoid.WalkSpeed = originalWalkSpeed * 8
                player.Character.Humanoid.JumpPower = originalJumpPower * 4
            else
                player.Character.Humanoid.WalkSpeed = originalWalkSpeed
                player.Character.Humanoid.JumpPower = originalJumpPower
            end
        end
    end
})

-- Steal Helper
Tabs.Main:AddButton({
    Title = "Steal Helper",
    Description = "Open steal helper GUI",
    Callback = function()
        if stealHelperGui then
            stealHelperGui:Destroy()
        end
        
        -- Create steal helper GUI with sick design
        stealHelperGui = Instance.new("ScreenGui")
        stealHelperGui.Name = "StealHelper"
        stealHelperGui.Parent = playerGui
        stealHelperGui.ResetOnSpawn = false
        
        local frame = Instance.new("Frame")
        frame.Size = UDim2.fromOffset(240, 180)
        frame.Position = UDim2.new(0.5, -120, 0.5, -90)
        frame.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
        frame.BorderSizePixel = 0
        frame.Parent = stealHelperGui
        
        -- Add gradient background
        local gradient = Instance.new("UIGradient")
        gradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(25, 25, 35)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(10, 10, 15))
        }
        gradient.Rotation = 45
        gradient.Parent = frame
        
        -- Add glow effect
        local glow = Instance.new("ImageLabel")
        glow.Name = "Glow"
        glow.Size = UDim2.fromOffset(260, 200)
        glow.Position = UDim2.new(0.5, -130, 0.5, -100)
        glow.AnchorPoint = Vector2.new(0.5, 0.5)
        glow.BackgroundTransparency = 1
        glow.Image = "rbxassetid://5554237731"
        glow.ImageColor3 = Color3.fromRGB(0, 150, 255)
        glow.ImageTransparency = 0.7
        glow.Parent = frame
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 15)
        corner.Parent = frame
        
        -- Title bar with Water HUB branding
        local titleBar = Instance.new("Frame")
        titleBar.Size = UDim2.new(1, 0, 0, 40)
        titleBar.Position = UDim2.new(0, 0, 0, 0)
        titleBar.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
        titleBar.BorderSizePixel = 0
        titleBar.Parent = frame
        
        local titleCorner = Instance.new("UICorner")
        titleCorner.CornerRadius = UDim.new(0, 15)
        titleCorner.Parent = titleBar
        
        -- Fix title bar corners
        local titleFix = Instance.new("Frame")
        titleFix.Size = UDim2.new(1, 0, 0, 15)
        titleFix.Position = UDim2.new(0, 0, 1, -15)
        titleFix.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
        titleFix.BorderSizePixel = 0
        titleFix.Parent = titleBar
        
        -- Title text
        local title = Instance.new("TextLabel")
        title.Size = UDim2.new(1, -50, 1, 0)
        title.Position = UDim2.new(0, 10, 0, 0)
        title.BackgroundTransparency = 1
        title.Text = "üíß Water HUB - Steal Helper"
        title.TextColor3 = Color3.fromRGB(255, 255, 255)
        title.TextSize = 16
        title.Font = Enum.Font.SourceSansBold
        title.TextXAlignment = Enum.TextXAlignment.Left
        title.Parent = titleBar
        
        -- Close button with sick design
        local closeBtn = Instance.new("TextButton")
        closeBtn.Size = UDim2.fromOffset(30, 30)
        closeBtn.Position = UDim2.new(1, -35, 0, 5)
        closeBtn.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
        closeBtn.Text = "‚úï"
        closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        closeBtn.TextSize = 16
        closeBtn.Font = Enum.Font.SourceSansBold
        closeBtn.Parent = titleBar
        
        local closeCorner = Instance.new("UICorner")
        closeCorner.CornerRadius = UDim.new(0, 8)
        closeCorner.Parent = closeBtn
        
        -- Close button hover effect
        local closeHover = TweenService:Create(closeBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(255, 0, 0)})
        local closeNormal = TweenService:Create(closeBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(255, 50, 50)})
        
        closeBtn.MouseEnter:Connect(function() closeHover:Play() end)
        closeBtn.MouseLeave:Connect(function() closeNormal:Play() end)
        
        closeBtn.MouseButton1Click:Connect(function()
            stealHelperGui:Destroy()
        end)
        
        -- Up button with premium design
        local upBtn = Instance.new("TextButton")
        upBtn.Size = UDim2.new(1, -20, 0, 50)
        upBtn.Position = UDim2.new(0, 10, 0, 55)
        upBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
        upBtn.Text = "‚¨ÜÔ∏è UP (165)"
        upBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        upBtn.TextSize = 18
        upBtn.Font = Enum.Font.SourceSansBold
        upBtn.Parent = frame
        
        local upCorner = Instance.new("UICorner")
        upCorner.CornerRadius = UDim.new(0, 12)
        upCorner.Parent = upBtn
        
        -- Up button gradient
        local upGradient = Instance.new("UIGradient")
        upGradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 255, 120)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 150, 80))
        }
        upGradient.Rotation = 45
        upGradient.Parent = upBtn
        
        -- Down button with premium design
        local downBtn = Instance.new("TextButton")
        downBtn.Size = UDim2.new(1, -20, 0, 50)
        downBtn.Position = UDim2.new(0, 10, 0, 115)
        downBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 100)
        downBtn.Text = "‚¨áÔ∏è DOWN (70)"
        downBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        downBtn.TextSize = 18
        downBtn.Font = Enum.Font.SourceSansBold
        downBtn.Parent = frame
        
        local downCorner = Instance.new("UICorner")
        downCorner.CornerRadius = UDim.new(0, 12)
        downCorner.Parent = downBtn
        
        -- Down button gradient
        local downGradient = Instance.new("UIGradient")
        downGradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 120)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(150, 0, 80))
        }
        downGradient.Rotation = 45
        downGradient.Parent = downBtn
        
        -- Button hover effects
        local upHover = TweenService:Create(upBtn, TweenInfo.new(0.2), {Size = UDim2.new(1, -15, 0, 55)})
        local upNormal = TweenService:Create(upBtn, TweenInfo.new(0.2), {Size = UDim2.new(1, -20, 0, 50)})
        local downHover = TweenService:Create(downBtn, TweenInfo.new(0.2), {Size = UDim2.new(1, -15, 0, 55)})
        local downNormal = TweenService:Create(downBtn, TweenInfo.new(0.2), {Size = UDim2.new(1, -20, 0, 50)})
        
        upBtn.MouseEnter:Connect(function() upHover:Play() end)
        upBtn.MouseLeave:Connect(function() upNormal:Play() end)
        downBtn.MouseEnter:Connect(function() downHover:Play() end)
        downBtn.MouseLeave:Connect(function() downNormal:Play() end)
        
        -- Button functions
        upBtn.MouseButton1Click:Connect(function()
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                player.Character.HumanoidRootPart.CFrame = player.Character.HumanoidRootPart.CFrame + Vector3.new(0, 165, 0)
            end
        end)
        
        downBtn.MouseButton1Click:Connect(function()
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                player.Character.HumanoidRootPart.CFrame = player.Character.HumanoidRootPart.CFrame - Vector3.new(0, 70, 0)
            end
        end)
        
        -- Make entire GUI draggable
        local dragStart = nil
        local startPos = nil
        local isDragging = false
        
        titleBar.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                isDragging = true
                dragStart = input.Position
                startPos = frame.Position
            end
        end)
        
        titleBar.InputChanged:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseMovement and isDragging then
                local delta = input.Position - dragStart
                frame.Position = UDim2.new(
                    startPos.X.Scale,
                    startPos.X.Offset + delta.X,
                    startPos.Y.Scale,
                    startPos.Y.Offset + delta.Y
                )
            end
        end)
        
        titleBar.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                isDragging = false
            end
        end)
    end
})

-- Money label
local moneyLabel = Tabs.Main:AddParagraph({
    Title = "Money",
    Content = "0"
})

-- Auto collect money
Tabs.Main:AddToggle("AutoCollectMoney", {
    Title = "Auto Collect Money",
    Default = false,
    Callback = function(value)
        autoCollectMoney = value
    end
})

-- Fast steal
Tabs.Main:AddToggle("FastSteal", {
    Title = "Fast Steal",
    Default = false,
    Callback = function(value)
        fastStealEnabled = value
    end
})

-- VISUAL TAB
-- ESP Players
Tabs.Visual:AddToggle("ESPPlayers", {
    Title = "ESP Player Highlights",
    Default = false,
    Callback = function(value)
        espPlayersEnabled = value
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= Players.LocalPlayer and player.Character then
                local highlight = player.Character:FindFirstChild("Highlight")
                if value then
                    if not highlight then
                        highlight = Instance.new("Highlight")
                        highlight.Parent = player.Character
                        highlight.FillColor = Color3.fromRGB(255, 0, 0)
                        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                    end
                else
                    if highlight then
                        highlight:Destroy()
                    end
                end
            end
        end
    end
})

-- ESP Box
Tabs.Visual:AddToggle("ESPBox", {
    Title = "ESP Box",
    Default = false,
    Callback = function(value)
        espBoxEnabled = value
    end
})

-- MISC TAB
-- Anti trap
Tabs.Misc:AddToggle("AntiTrap", {
    Title = "Anti Trap",
    Default = false,
    Callback = function(value)
        antiTrapEnabled = value
    end
})

-- Anti stun (god mode)
Tabs.Misc:AddToggle("AntiStun", {
    Title = "Anti Stun (God Mode)",
    Default = false,
    Callback = function(value)
        antiStunEnabled = value
        if player.Character and player.Character:FindFirstChild("Humanoid") then
            if value then
                player.Character.Humanoid.PlatformStand = true
            else
                player.Character.Humanoid.PlatformStand = false
            end
        end
    end
})

-- Update money label
local function updateMoneyLabel()
    local leaderstats = player:FindFirstChild("leaderstats")
    if leaderstats then
        local money = leaderstats:FindFirstChild("Money") or leaderstats:FindFirstChild("Cash") or leaderstats:FindFirstChild("Coins")
        if money then
            moneyLabel:SetDesc(tostring(money.Value))
        end
    end
end

-- Auto collect money function
local function autoCollectMoneyFunc()
    if not autoCollectMoney then return end
    
    for _, v in pairs(workspace:GetDescendants()) do
        if v.Name:lower():find("money") or v.Name:lower():find("cash") or v.Name:lower():find("coin") then
            if v:IsA("Part") and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local distance = (v.Position - player.Character.HumanoidRootPart.Position).Magnitude
                if distance <= 50 then
                    firetouchinterest(player.Character.HumanoidRootPart, v, 0)
                    firetouchinterest(player.Character.HumanoidRootPart, v, 1)
                end
            end
        end
    end
end

-- Fast steal function
local function fastStealFunc()
    if not fastStealEnabled then return end
    
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("ProximityPrompt") then
            v.HoldDuration = 0
            v.Duration = 0
        end
    end
end

-- ESP functions
local function updateESP()
    if espPlayersEnabled then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= Players.LocalPlayer and player.Character then
                local highlight = player.Character:FindFirstChild("Highlight")
                if not highlight then
                    highlight = Instance.new("Highlight")
                    highlight.Parent = player.Character
                    highlight.FillColor = Color3.fromRGB(255, 0, 0)
                    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                end
            end
        end
    end
end

-- Main loop
RunService.Heartbeat:Connect(function()
    updateMoneyLabel()
    autoCollectMoneyFunc()
    fastStealFunc()
    updateESP()
end)

-- Configure managers
SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
SaveManager:IgnoreThemeSettings()
InterfaceManager:SetFolder("FluentMobile")
SaveManager:SetFolder("FluentMobile/config")

-- Select first tab
Window:SelectTab(1)

-- Loading notification
Fluent:Notify({
    Title = "Loaded",
    Content = "Mobile script loaded successfully!",
    Duration = 5,
    Image = "rbxassetid://7072717836"
})

-- Load auto config
SaveManager:LoadAutoloadConfig()

-- Keep persistent image when menu is closed
