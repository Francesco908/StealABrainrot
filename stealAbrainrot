local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")

local hasTeleportedOnce = false

-- Crea GUI
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
screenGui.Name = "FastStealGUI"

local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Name = "Main"
mainFrame.Size = UDim2.new(0, 260, 0, 100)
mainFrame.Position = UDim2.new(0.5, -130, 0.5, -50)
mainFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
mainFrame.Active = true
mainFrame.Draggable = true

local titleBar = Instance.new("Frame", mainFrame)
titleBar.Size = UDim2.new(1, 0, 0, 24)
titleBar.BackgroundColor3 = Color3.fromRGB(20,20,20)

local btnMin = Instance.new("TextButton", titleBar)
btnMin.Size = UDim2.new(0, 24, 0, 24)
btnMin.Position = UDim2.new(1, -48, 0, 0)
btnMin.Text = "–"
btnMin.BackgroundTransparency = 1
btnMin.TextColor3 = Color3.new(1,1,1)

local btnClose = Instance.new("TextButton", titleBar)
btnClose.Size = UDim2.new(0, 24, 0, 24)
btnClose.Position = UDim2.new(1, -24, 0, 0)
btnClose.Text = "✕"
btnClose.BackgroundTransparency = 1
btnClose.TextColor3 = Color3.new(1,1,1)

local content = Instance.new("Frame", mainFrame)
content.Name = "Content"
content.Size = UDim2.new(1, 0, 1, -24)
content.Position = UDim2.new(0, 0, 0, 24)
content.BackgroundTransparency = 1

local btnTP = Instance.new("TextButton", content)
btnTP.Name = "TeleportButton"
btnTP.Size = UDim2.new(1, -20, 0, 32)
btnTP.Position = UDim2.new(0, 10, 0, 10)
btnTP.Text = "Fast Delivery"
btnTP.BackgroundColor3 = Color3.fromRGB(50,50,50)
btnTP.BorderSizePixel = 0
btnTP.TextColor3 = Color3.new(1,1,1)

local lblStatus = Instance.new("TextLabel", content)
lblStatus.Name = "StatusLabel"
lblStatus.Size = UDim2.new(1, -20, 0, 24)
lblStatus.Position = UDim2.new(0, 10, 0, 52)
lblStatus.Text = ""
lblStatus.BackgroundTransparency = 1
lblStatus.TextColor3 = Color3.new(1,1,1)
lblStatus.TextXAlignment = Enum.TextXAlignment.Left

-- Minimize/Close
local minimized = false
btnMin.MouseButton1Click:Connect(function()
    minimized = not minimized
    content.Visible = not minimized
    mainFrame.Size = minimized and UDim2.new(0,260,0,24) or UDim2.new(0,260,0,100)
end)
btnClose.MouseButton1Click:Connect(function()
    screenGui:Destroy()
end)

-- 9 metodi di teleport (esempi di offset globali)
local methods = {
    CFrame.new(0,50,0), CFrame.new(50,50,0), CFrame.new(-50,50,0),
    CFrame.new(0,50,50), CFrame.new(0,50,-50), CFrame.new(50,50,50),
    CFrame.new(-50,50,-50), CFrame.new(50,50,-50), CFrame.new(-50,50,50),
}

-- Trova il DeliveryHitbox più vicino
local function getNearestHitbox()
    local nearest, minDist = nil, math.huge
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj.Name == "DeliveryHitbox" and obj:IsA("BasePart") then
            local d = (hrp.Position - obj.Position).Magnitude
            if d < minDist then
                minDist = d
                nearest = obj
            end
        end
    end
    return nearest
end

-- Tentativo di teleport con i 9 metodi
local function tryTeleportMethods()
    for _, cf in ipairs(methods) do
        local ok = pcall(function() hrp.CFrame = cf end)
        if ok then
            return true
        end
        RunService.Heartbeat:Wait()
    end
    return false
end

-- Click “Fast Delivery”
btnTP.MouseButton1Click:Connect(function()
    if hasTeleportedOnce then
        lblStatus.Text = "⛔ Già teletrasportato!"
        return
    end

    btnTP.Active = false
    lblStatus.Text = "⏳ Teleport in corso..."

    -- Prova i 9 metodi finché uno non funziona
    while not tryTeleportMethods() do end

    -- Teleporta infine al DeliveryHitbox più vicino
    local hitbox = getNearestHitbox()
    if hitbox then
        hrp.CFrame = hitbox.CFrame + Vector3.new(0,5,0)
        lblStatus.Text = "✅ Teleport → DeliveryHitbox"
    else
        lblStatus.Text = "⚠ Hitbox non trovata!"
    end

    hasTeleportedOnce = true
    btnTP.Text = "Effettuato"
    btnTP.AutoButtonColor = false
    btnTP.BackgroundTransparency = 0.5
end)
