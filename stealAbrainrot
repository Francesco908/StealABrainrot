-- Steal a brainrot Script - ULTRA RELIABLE EDITION
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local mouse = player:GetMouse()

-- Variabili potenziate
local infiniteJumpEnabled = false
local speedHackEnabled = false
local floatEnabled = false
local espEnabled = false
local originalWalkSpeed = 16
local basePosition = nil
local connections = {}
local espObjects = {}
local teleporting = false
local antiStuckCounter = 0
local lastSafePosition = nil

-- HIGH RELIABILITY TELEPORT SYSTEM
local function ultraTeleport(position)
    if teleporting then return end
    teleporting = true
    
    local startTime = tick()
    local character = player.Character
    if not character then 
        teleporting = false
        return 
    end
    
    local humanoid = character:FindFirstChild("Humanoid")
    local root = character:FindFirstChild("HumanoidRootPart")
    if not root then 
        teleporting = false
        return 
    end
    
    -- Salva ultima posizione sicura
    lastSafePosition = root.Position
    
    -- 1. Prepara il personaggio per il teletrasporto
    humanoid:ChangeState(Enum.HumanoidStateType.Physics)
    humanoid.PlatformStand = true
    if root:CanSetNetworkOwnership() then
        root:SetNetworkOwner(player)
    end
    
    -- 2. Overlay di inizio teletrasporto
    local overlay = Instance.new("Frame")
    overlay.Name = "TeleportOverlay"
    overlay.Size = UDim2.new(1, 0, 1, 0)
    overlay.Position = UDim2.new(0, 0, 0, 0)
    overlay.BackgroundColor3 = Color3.new(0, 0, 0)
    overlay.BackgroundTransparency = 0.7
    overlay.ZIndex = 100
    overlay.Parent = player.PlayerGui:WaitForChild("StealBrainrotScript")
    
    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(0, 400, 0, 100)
    textLabel.Position = UDim2.new(0.5, -200, 0.5, -50)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = "ULTRA TELEPORT ACTIVATED"
    textLabel.TextColor3 = Color3.new(1, 1, 1)
    textLabel.TextScaled = true
    textLabel.Font = Enum.Font.GothamBold
    textLabel.ZIndex = 101
    textLabel.Parent = overlay
    
    -- 3. Fase 1: Ascensione a 165 studs
    local highPos = Vector3.new(root.Position.X, 165, root.Position.Z)
    root.CFrame = CFrame.new(highPos)
    task.wait(0.1)
    
    -- 4. Fase 2: Volo orizzontale verso la base
    local targetHighPos = Vector3.new(position.X, 165, position.Z)
    local tweenInfo = TweenInfo.new(
        (root.Position - targetHighPos).Magnitude / 100, -- Velocità dinamica
        Enum.EasingStyle.Linear,
        Enum.EasingDirection.Out,
        0,
        false,
        0
    )
    
    local tween = TweenService:Create(root, tweenInfo, {CFrame = CFrame.new(targetHighPos)})
    tween:Play()
    
    -- 5. Fase 3: Discesa controllata
    tween.Completed:Connect(function()
        local descentTween = TweenService:Create(root, TweenInfo.new(1.5), {CFrame = CFrame.new(position)})
        descentTween:Play()
        
        descentTween.Completed:Connect(function()
            -- 6. Verifica finale della posizione
            if (root.Position - position).Magnitude > 5 then
                root.CFrame = CFrame.new(position)
            end
            
            -- 7. Ripristino dello stato
            humanoid.PlatformStand = false
            humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
            
            -- 8. Pulizia
            overlay:Destroy()
            teleporting = false
            antiStuckCounter = 0
        end)
    end)
    
    -- 9. Sistema anti-bloccaggio
    local safetyCheck = RunService.Heartbeat:Connect(function()
        antiStuckCounter = antiStuckCounter + 1
        
        -- Se il teletrasporto dura più di 10 secondi
        if tick() - startTime > 10 then
            safetyCheck:Disconnect()
            overlay:Destroy()
            
            -- Ripristino di emergenza
            if character and root then
                root.CFrame = CFrame.new(lastSafePosition or position)
                humanoid.PlatformStand = false
                humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
            end
            
            teleporting = false
            createNotification("Teleport completed with safety override", 3)
        end
        
        -- Controllo ogni secondo
        if antiStuckCounter % 60 == 0 then
            -- Forza aggiornamento della posizione
            root.CFrame = CFrame.new(root.Position)
        end
    end)
end

-- GUI Creation
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "StealBrainrotScript"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

-- Main Frame (solo elementi essenziali per velocità)
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 400, 0, 300)
mainFrame.Position = UDim2.new(0.5, -200, 0.5, -150)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

-- UI Elements (semplificati per performance)
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 40)
titleBar.Position = UDim2.new(0, 0, 0, 0)
titleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
titleBar.Parent = mainFrame

local titleText = Instance.new("TextLabel")
titleText.Size = UDim2.new(1, -80, 1, 0)
titleText.Position = UDim2.new(0, 10, 0, 0)
titleText.BackgroundTransparency = 1
titleText.Text = "ULTRA RELIABLE SCRIPT"
titleText.TextColor3 = Color3.fromRGB(255, 255, 255)
titleText.TextScaled = true
titleText.Font = Enum.Font.GothamBold
titleText.Parent = titleBar

-- Tab Buttons
local tabButtons = {}
local tabs = {"Main", "Teleport", "Server"}

for i, tabName in ipairs(tabs) do
    local tabButton = Instance.new("TextButton")
    tabButton.Name = tabName .. "Tab"
    tabButton.Size = UDim2.new(1/3, -2, 0, 40)
    tabButton.Position = UDim2.new((i-1)/3, 2, 0, 40)
    tabButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    tabButton.Text = tabName
    tabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    tabButton.TextScaled = true
    tabButton.Font = Enum.Font.Gotham
    tabButton.Parent = mainFrame
    tabButtons[tabName] = tabButton
end

-- Content Frame
local contentFrame = Instance.new("Frame")
contentFrame.Name = "ContentFrame"
contentFrame.Size = UDim2.new(1, 0, 1, -80)
contentFrame.Position = UDim2.new(0, 0, 0, 80)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainFrame

-- Tab Contents
local tabContents = {}
for _, tabName in ipairs(tabs) do
    local tabContent = Instance.new("Frame")
    tabContent.Name = tabName .. "Content"
    tabContent.Size = UDim2.new(1, 0, 1, 0)
    tabContent.BackgroundTransparency = 1
    tabContent.Visible = (tabName == "Main")
    tabContent.Parent = contentFrame
    tabContents[tabName] = tabContent
end

-- Funzione per creare bottoni ultra-affidabili
local function createUltraButton(name, position, parent, callback)
    local button = Instance.new("TextButton")
    button.Name = name
    button.Size = UDim2.new(1, -20, 0, 40)
    button.Position = position
    button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    button.Text = name
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextScaled = true
    button.Font = Enum.Font.Gotham
    button.Parent = parent

    button.MouseButton1Click:Connect(function()
        if callback then
            local success, err = pcall(callback)
            if not success then
                warn("Button error: " .. err)
            end
        end
    end)

    return button
end

-- Main Tab
createUltraButton("Infinite Jump", UDim2.new(0, 10, 0, 10), tabContents["Main"], function()
    infiniteJumpEnabled = not infiniteJumpEnabled
end)

createUltraButton("Speed Hack", UDim2.new(0, 10, 0, 60), tabContents["Main"], function()
    speedHackEnabled = not speedHackEnabled
    if player.Character and player.Character:FindFirstChild("Humanoid") then
        if speedHackEnabled then
            originalWalkSpeed = player.Character.Humanoid.WalkSpeed
            player.Character.Humanoid.WalkSpeed = 50
        else
            player.Character.Humanoid.WalkSpeed = originalWalkSpeed
        end
    end
end)

-- Teleport Tab
createUltraButton("Set Base Position", UDim2.new(0, 10, 0, 10), tabContents["Teleport"], function()
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        basePosition = player.Character.HumanoidRootPart.Position
        createNotification("BASE POSITION SECURED!", 3)
    end
end)

createUltraButton("TELEPORT TO BASE", UDim2.new(0, 10, 0, 60), tabContents["Teleport"], function()
    if basePosition then
        ultraTeleport(basePosition)
    else
        createNotification("Set base position first!", 2)
    end
end)

createUltraButton("AUTO ESCAPE", UDim2.new(0, 10, 0, 110), tabContents["Teleport"], function()
    if basePosition then
        ultraTeleport(basePosition)
    else
        createNotification("Set base position first!", 2)
    end
end)

-- Server Tab
createUltraButton("Rejoin Server", UDim2.new(0, 10, 0, 10), tabContents["Server"], function()
    TeleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId, player)
end)

createUltraButton("Server Hop", UDim2.new(0, 10, 0, 60), tabContents["Server"], function()
    local servers = {}
    local success, result = pcall(function()
        return HttpService:JSONDecode(game:HttpGet(
            "https://games.roblox.com/v1/games/"..game.PlaceId.."/servers/Public?sortOrder=Desc&limit=100"
        ))
    end)
    
    if success and result and result.data then
        for _, server in ipairs(result.data) do
            if server.playing < server.maxPlayers and server.id ~= game.JobId then
                table.insert(servers, server)
            end
        end
        
        if #servers > 0 then
            TeleportService:TeleportToPlaceInstance(game.PlaceId, servers[math.random(#servers)].id, player)
        end
    end
end)

-- Notification System potenziato
function createNotification(text, duration)
    local notifGui = Instance.new("Frame")
    notifGui.Size = UDim2.new(0, 300, 0, 50)
    notifGui.Position = UDim2.new(0.5, -150, 0.1, 0)
    notifGui.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    notifGui.BorderSizePixel = 0
    notifGui.ZIndex = 100
    notifGui.Parent = screenGui
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextScaled = true
    label.Font = Enum.Font.GothamBold
    label.Parent = notifGui
    
    task.delay(duration, function()
        notifGui:Destroy()
    end)
end

-- Infinite Jump Logic ultra-affidabile
local function handleInfiniteJump()
    if infiniteJumpEnabled and player.Character then
        local humanoid = player.Character:FindFirstChild("Humanoid")
        if humanoid and humanoid.FloorMaterial == Enum.Material.Air then
            humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end
end

-- Tab Switching
for name, btn in pairs(tabButtons) do
    btn.MouseButton1Click:Connect(function()
        for _, c in pairs(tabContents) do c.Visible = false end
        tabContents[name].Visible = true
    end)
end

-- Setup iniziale
connections.heartbeat = RunService.Heartbeat:Connect(handleInfiniteJump)

player.CharacterAdded:Connect(function(char)
    char:WaitForChild("Humanoid")
    if speedHackEnabled then
        char.Humanoid.WalkSpeed = 50
    end
end)

createNotification("ULTRA RELIABLE SCRIPT LOADED!", 5)
