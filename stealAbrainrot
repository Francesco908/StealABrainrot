-- Sistema Fast Steal avanzato con targeting intelligente
local fastStealEnabled = false
local fastStealConnection = nil
local maxStealDistance = 25  -- Distanza massima per il furto
local stealCooldown = 0.5    -- Cooldown tra un furto e l'altro

local function getClosestStealable()
    local character = LocalPlayer.Character
    if not character then return nil end
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return nil end

    local closestObject = nil
    local closestDistance = math.huge

    -- Cerca nella workspace
    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("ProximityPrompt") and obj.Enabled then
            local distance = (humanoidRootPart.Position - obj.Parent.Position).Magnitude
            if distance <= maxStealDistance and distance < closestDistance then
                closestObject = obj
                closestDistance = distance
            end
        end
    end

    -- Cerca nei personaggi dei giocatori
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            for _, obj in ipairs(player.Character:GetDescendants()) do
                if obj:IsA("ProximityPrompt") and obj.Enabled then
                    local distance = (humanoidRootPart.Position - obj.Parent.Position).Magnitude
                    if distance <= maxStealDistance and distance < closestDistance then
                        closestObject = obj
                        closestDistance = distance
                    end
                end
            end
        end
    end

    return closestObject
end

local function setupFastSteal()
    if fastStealConnection then
        fastStealConnection:Disconnect()
        fastStealConnection = nil
    end
    
    fastStealConnection = RunService.Heartbeat:Connect(function()
        pcall(function()
            local closestPrompt = getClosestStealable()
            if closestPrompt then
                -- Imposta il tempo di hold a 0.5 secondi
                local originalHoldDuration = closestPrompt.HoldDuration
                closestPrompt.HoldDuration = 0.5
                
                -- Attiva il prompt
                fireproximityprompt(closestPrompt)
                
                -- Ripristina il valore originale
                closestPrompt.HoldDuration = originalHoldDuration
                
                -- Breve pausa per evitare spam
                task.wait(stealCooldown)
            end
        end)
    end)
end

-- Nel tab Main:
MainTab:CreateToggle({
    Name = "Fast Steal (0.5s)",
    Default = false,
    Callback = function(value)
        fastStealEnabled = value
        if value then
            setupFastSteal()
            Rayfield:Notify({
                Title = "Fast Steal Attivato",
                Content = "Furto istantaneo (0.5s) attivo!",
                Duration = 2,
                Image = 4483362458
            })
        else
            if fastStealConnection then
                fastStealConnection:Disconnect()
                fastStealConnection = nil
            end
            Rayfield:Notify({
                Title = "Fast Steal Disattivato",
                Content = "Furto istantaneo disattivato",
                Duration = 1.5,
                Image = 4483362458
            })
        end
    end
})
