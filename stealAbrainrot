local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Configurazione API Google Gemini
local GeminiAPI = {
    Key = "AIzaSyCs7MOursJk-vCG9ycl_vDBtbDUJUz_0KE",
    BaseURL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent"
}

local function queryGemini(prompt)
    local success, response = pcall(function()
        return game:HttpGet(GeminiAPI.BaseURL .. "?key=" .. GeminiAPI.Key, {
            headers = {
                ["Content-Type"] = "application/json"
            },
            body = game:GetService("HttpService"):JSONEncode({
                contents = {{
                    parts = {{
                        text = prompt
                    }}
                }}
            })
        })
    end)
    
    if success and response then
        return game:GetService("HttpService"):JSONDecode(response)
    else
        return {candidates = {{content = {parts = {{text = "1"}}}}}} -- Default fallback
    end
end

-- Creazione della finestra principale
local Window = Rayfield:CreateWindow({
    Name = "✨ Ultimate AI Hub v5.0",
    LoadingTitle = "Loading AI-Powered Hub...",
    LoadingSubtitle = "by OnlyRobloxScript",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "UltimateAIHub",
        FileName = "Config"
    },
    KeySystem = false
})

-- Teleport GUI Fixato
local teleportGUI = Instance.new("ScreenGui")
teleportGUI.Name = "TeleportGUI"
teleportGUI.Parent = game:GetService("CoreGui")
teleportGUI.ResetOnSpawn = false

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 100)
frame.Position = UDim2.new(0.5, -100, 0.7, -50)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Visible = false
frame.Parent = teleportGUI

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
title.Text = "Quick Teleport"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.Parent = frame

local skyBtn = Instance.new("TextButton")
skyBtn.Size = UDim2.new(0.9, 0, 0, 30)
skyBtn.Position = UDim2.new(0.05, 0, 0.35, 0)
skyBtn.BackgroundColor3 = Color3.fromRGB(70, 130, 200)
skyBtn.Text = "🚀 Go to Sky (Y:256)"
skyBtn.Font = Enum.Font.Gotham
skyBtn.TextColor3 = Color3.white
skyBtn.Parent = frame

local downBtn = Instance.new("TextButton")
downBtn.Size = UDim2.new(0.9, 0, 0, 30)
downBtn.Position = UDim2.new(0.05, 0, 0.7, 0)
downBtn.BackgroundColor3 = Color3.fromRGB(200, 70, 70)
downBtn.Text = "⬇️ Go Down (Y:-50)"
downBtn.Font = Enum.Font.Gotham
downBtn.TextColor3 = Color3.white
downBtn.Parent = frame

skyBtn.MouseButton1Click:Connect(function()
    pcall(function()
        local char = game.Players.LocalPlayer.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            char.HumanoidRootPart.CFrame = CFrame.new(
                char.HumanoidRootPart.Position.X,
                256,
                char.HumanoidRootPart.Position.Z
            )
        end
    end)
end)

downBtn.MouseButton1Click:Connect(function()
    pcall(function()
        local char = game.Players.LocalPlayer.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            char.HumanoidRootPart.CFrame = CFrame.new(
                char.HumanoidRootPart.Position.X,
                -50,
                char.HumanoidRootPart.Position.Z
            )
        end
    end)
end)

-- Main Tab Fixata
local MainTab = Window:CreateTab("🏠 Main", 6022668888)

MainTab:CreateSection("Teleportation")
MainTab:CreateButton({
    Name = "✨ Show Teleport GUI",
    Callback = function()
        frame.Visible = not frame.Visible
        Rayfield:Notify({
            Title = frame.Visible and "Teleport GUI Shown" or "Teleport GUI Hidden",
            Content = frame.Visible and "Drag the window to move it" or "GUI is now hidden",
            Duration = 3,
            Image = 6022668888
        })
    end,
})

MainTab:CreateSection("Movement")
local walkSpeed = 16
MainTab:CreateSlider({
    Name = "🏃‍♂️ Max Speed",
    Range = {16, 200},
    Increment = 5,
    Suffix = "studs",
    CurrentValue = 16,
    Flag = "MaxSpeed",
    Callback = function(Value)
        walkSpeed = Value
        pcall(function()
            local humanoid = game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if humanoid then humanoid.WalkSpeed = Value end
        end)
    end,
})

local speedBoostActive = false
MainTab:CreateToggle({
    Name = "⚡ Speed Boost (Shift to activate)",
    CurrentValue = false,
    Flag = "SpeedBoost",
    Callback = function(Value)
        speedBoostActive = Value
        Rayfield:Notify({
            Title = Value and "Speed Boost Enabled" or "Speed Boost Disabled",
            Content = Value and "Hold Shift to activate boost" or "Speed boost deactivated",
            Duration = 3,
            Image = 6022668888
        })
    end,
})

MainTab:CreateSection("Server Actions")
MainTab:CreateButton({
    Name = "🔄 Server Hop",
    Callback = function()
        Rayfield:Notify({
            Title = "Server Hop",
            Content = "Finding new server...",
            Duration = 3,
            Image = 6022668888
        })
        
        local Http = game:GetService("HttpService")
        local TPS = game:GetService("TeleportService")
        local API = "https://games.roblox.com/v1/games/%s/servers/Public?sortOrder=Desc&limit=100"
        local GameId = game.PlaceId
        
        local function servers(Next)
            local Raw = game:HttpGet(API:format(GameId) .. (Next and "&cursor="..Next or "")
            return Http:JSONDecode(Raw)
        end
        
        local function joinServer()
            local Server; 
            local Next;
            repeat 
                local Servers = servers(Next)
                Server = Servers.data[1]
                Next = Servers.nextPageCursor
            until Server
            
            TPS:TeleportToPlaceInstance(GameId, Server.id)
        end
        
        joinServer()
    end,
})

MainTab:CreateButton({
    Name = "🔁 Rejoin Server",
    Callback = function()
        game:GetService("TeleportService"):Teleport(game.PlaceId)
    end,
})

MainTab:CreateButton({
    Name = "🚪 Exit Game",
    Callback = function()
        game:Shutdown()
    end,
})

-- Combat Tab Fixata
local CombatTab = Window:CreateTab("⚔️ Combat", 6022668888)

CombatTab:CreateSection("Kill Aura")
local killAuraActive = false
local killAuraRange = 25
local killAuraCooldown = 0.3

CombatTab:CreateToggle({
    Name = "💀 Kill Aura",
    CurrentValue = false,
    Flag = "KillAura",
    Callback = function(Value)
        killAuraActive = Value
        Rayfield:Notify({
            Title = Value and "Kill Aura Enabled" or "Kill Aura Disabled",
            Content = Value and "Attacking nearby enemies" or "Combat system offline",
            Duration = 3,
            Image = 6022668888
        })
    end,
})

CombatTab:CreateSlider({
    Name = "📏 Kill Aura Range",
    Range = {5, 50},
    Increment = 1,
    Suffix = "studs",
    CurrentValue = 25,
    Flag = "AuraRange",
    Callback = function(Value)
        killAuraRange = Value
    end,
})

CombatTab:CreateSlider({
    Name = "⏱️ Attack Cooldown",
    Range = {0.1, 1.5},
    Increment = 0.1,
    Suffix = "seconds",
    CurrentValue = 0.3,
    Flag = "AttackCooldown",
    Callback = function(Value)
        killAuraCooldown = Value
    end,
})

-- AI Combat System
spawn(function()
    while true do
        if killAuraActive then
            pcall(function()
                local player = game.Players.LocalPlayer
                local character = player.Character
                local humanoidRootPart = character and character:FindFirstChild("HumanoidRootPart")
                
                if humanoidRootPart then
                    -- Find best weapon using AI analysis
                    local bestWeapon
                    local highestDamage = 0
                    
                    for _, tool in ipairs(player.Backpack:GetChildren()) do
                        if tool:IsA("Tool") then
                            -- Ask AI to evaluate weapon
                            local prompt = string.format("Evaluate this weapon for combat: %s. Respond with just a number 1-10.", tool.Name)
                            local response = queryGemini(prompt)
                            local rating = tonumber(response.candidates[1].content.parts[1].text) or 5
                            
                            if rating > highestDamage then
                                bestWeapon = tool
                                highestDamage = rating
                            end
                        end
                    end
                    
                    if bestWeapon then
                        player.Character.Humanoid:EquipTool(bestWeapon)
                        
                        for _, target in ipairs(game.Players:GetPlayers()) do
                            if target ~= player and target.Character then
                                local targetHRP = target.Character:FindFirstChild("HumanoidRootPart")
                                local targetHumanoid = target.Character:FindFirstChildOfClass("Humanoid")
                                
                                if targetHRP and targetHumanoid and targetHumanoid.Health > 0 then
                                    local distance = (humanoidRootPart.Position - targetHRP.Position).Magnitude
                                    
                                    if distance <= killAuraRange then
                                        -- AI decision to attack
                                        humanoidRootPart.CFrame = CFrame.new(
                                            humanoidRootPart.Position,
                                            targetHRP.Position
                                        )
                                        
                                        bestWeapon:Activate()
                                        wait(killAuraCooldown)
                                    end
                                end
                            end
                        end
                    end
                end
            end)
        end
        wait(0.1)
    end
end)

-- Helper Tab Fixata
local HelperTab = Window:CreateTab("🛠️ Helper", 6022668888)

HelperTab:CreateSection("Anti-Cheats")
HelperTab:CreateToggle({
    Name = "⚠️ Anti Trap",
    CurrentValue = false,
    Flag = "AntiTrap",
    Callback = function(Value)
        Rayfield:Notify({
            Title = Value and "Anti Trap Enabled" or "Anti Trap Disabled",
            Content = Value and "Traps will be avoided" or "Traps can affect you",
            Duration = 3,
            Image = 6022668888
        })
    end,
})

HelperTab:CreateToggle({
    Name = "❄️ Anti Freeze",
    CurrentValue = false,
    Flag = "AntiFreeze",
    Callback = function(Value)
        if Value then
            spawn(function()
                while HelperTab:Get("AntiFreeze").CurrentValue do
                    pcall(function()
                        local char = game.Players.LocalPlayer.Character
                        if char then
                            for _, v in ipairs(char:GetChildren()) do
                                if v:IsA("BasePart") and v.Anchored then
                                    v.Anchored = false
                                end
                            end
                        end
                        wait(0.5)
                    end)
                end
            end)
            Rayfield:Notify({
                Title = "Anti Freeze Enabled",
                Content = "Immune to freeze effects",
                Duration = 3,
                Image = 6022668888
            })
        else
            Rayfield:Notify({
                Title = "Anti Freeze Disabled",
                Content = "Can be frozen",
                Duration = 3,
                Image = 6022668888
            })
        end
    end,
})

HelperTab:CreateToggle({
    Name = "⏱️ Anti AFK",
    CurrentValue = false,
    Flag = "AntiAFK",
    Callback = function(Value)
        if Value then
            local VirtualUser = game:GetService("VirtualUser")
            game:GetService("Players").LocalPlayer.Idled:Connect(function()
                VirtualUser:CaptureController()
                VirtualUser:ClickButton2(Vector2.new())
            end)
            Rayfield:Notify({
                Title = "Anti AFK Enabled",
                Content = "You won't be kicked for AFK",
                Duration = 3,
                Image = 6022668888
            })
        else
            Rayfield:Notify({
                Title = "Anti AFK Disabled",
                Content = "AFK detection active",
                Duration = 3,
                Image = 6022668888
            })
        end
    end,
})

HelperTab:CreateSection("Movement")
local infiniteJumpEnabled = false
HelperTab:CreateToggle({
    Name = "🦘 Infinite Jump",
    CurrentValue = false,
    Flag = "InfiniteJump",
    Callback = function(Value)
        infiniteJumpEnabled = Value
        game:GetService("UserInputService").JumpRequest:Connect(function()
            if infiniteJumpEnabled then
                pcall(function()
                    game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid"):ChangeState("Jumping")
                end)
            end
        end)
        Rayfield:Notify({
            Title = Value and "Infinite Jump Enabled" or "Infinite Jump Disabled",
            Content = Value and "Bypassing anti-cheat..." or "Normal jump restored",
            Duration = 3,
            Image = 6022668888
        })
    end,
})

local flyEnabled = false
local flySpeed = 50
HelperTab:CreateToggle({
    Name = "✈️ Fly (Press E to toggle)",
    CurrentValue = false,
    Flag = "Fly",
    Callback = function(Value)
        flyEnabled = Value
        Rayfield:Notify({
            Title = Value and "Fly Enabled" or "Fly Disabled",
            Content = Value and "Press E to toggle flight mode" or "Flight mode deactivated",
            Duration = Value and 5 or 3,
            Image = 6022668888
        })
    end,
})

-- Fly system
local function setupFly()
    local player = game.Players.LocalPlayer
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoid = character:WaitForChild("Humanoid")

    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.MaxForce = Vector3.new(9e9, 9e9, 9e9)
    bodyVelocity.Parent = character.HumanoidRootPart

    local flying = false

    game:GetService("UserInputService").InputBegan:Connect(function(input)
        if input.KeyCode == Enum.KeyCode.E and flyEnabled then
            flying = not flying
            bodyVelocity.MaxForce = flying and Vector3.new(9e9, 9e9, 9e9) or Vector3.new(0, 0, 0)
        end
    end)

    game:GetService("RunService").Heartbeat:Connect(function()
        if flyEnabled and flying and character and character:FindFirstChild("HumanoidRootPart") then
            local rootPart = character.HumanoidRootPart
            local camera = workspace.CurrentCamera

            local moveDirection = Vector3.new(0, 0, 0)
            if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.W) then
                moveDirection = moveDirection + camera.CFrame.LookVector
            end
            if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.S) then
                moveDirection = moveDirection - camera.CFrame.LookVector
            end
            if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.D) then
                moveDirection = moveDirection + camera.CFrame.RightVector
            end
            if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.A) then
                moveDirection = moveDirection - camera.CFrame.RightVector
            end
            if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.Space) then
                moveDirection = moveDirection + Vector3.new(0, 1, 0)
            end
            if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.LeftShift) then
                moveDirection = moveDirection + Vector3.new(0, -1, 0)
            end

            if moveDirection.Magnitude > 0 then
                bodyVelocity.Velocity = moveDirection.Unit * flySpeed
            else
                bodyVelocity.Velocity = Vector3.new(0, 0, 0)
            end
        end
    end)
end

if game.Players.LocalPlayer.Character then
    setupFly()
end
game.Players.LocalPlayer.CharacterAdded:Connect(setupFly)

-- ESP Tab Fixata
local ESPTab = Window:CreateTab("👁️ ESP", 6022668888)

local playersESP = {}
ESPTab:CreateToggle({
    Name = "👤 Player ESP",
    CurrentValue = false,
    Flag = "PlayerESP",
    Callback = function(Value)
        if Value then
            for _, player in ipairs(game:GetService("Players"):GetPlayers()) do
                if player ~= game.Players.LocalPlayer then
                    pcall(function()
                        if player.Character then
                            local highlight = Instance.new("Highlight")
                            highlight.Name = player.Name .. "_ESP"
                            highlight.OutlineColor = Color3.new(1, 0, 0)
                            highlight.FillColor = Color3.new(1, 0, 0)
                            highlight.FillTransparency = 0.5
                            highlight.Parent = player.Character
                            playersESP[player] = highlight
                        end
                    end)
                end
            end
            Rayfield:Notify({
                Title = "Player ESP Enabled",
                Content = "Players highlighted in red",
                Duration = 3,
                Image = 6022668888
            })
        else
            for player, highlight in pairs(playersESP) do
                if highlight then
                    highlight:Destroy()
                end
            end
            table.clear(playersESP)
            Rayfield:Notify({
                Title = "Player ESP Disabled",
                Content = "Player highlights removed",
                Duration = 3,
                Image = 6022668888
            })
        end
    end,
})

-- Auto-Update ESP
game:GetService("Players").PlayerAdded:Connect(function(player)
    if ESPTab:Get("PlayerESP").CurrentValue then
        player.CharacterAdded:Connect(function(char)
            if playersESP[player] then playersESP[player]:Destroy() end
            local highlight = Instance.new("Highlight")
            highlight.Name = player.Name .. "_ESP"
            highlight.OutlineColor = Color3.new(1, 0, 0)
            highlight.FillColor = Color3.new(1, 0, 0)
            highlight.FillTransparency = 0.5
            highlight.Parent = char
            playersESP[player] = highlight
        end)
    end
end)

-- AI Assistant Tab
local AITab = Window:CreateTab("🤖 AI Assistant", 6023423423)

local autoPlayEnabled = false
local lastDecisionTime = 0
local decisionCooldown = 5

AITab:CreateToggle({
    Name = "🎮 Auto Play Mode",
    CurrentValue = false,
    Flag = "AutoPlay",
    Callback = function(Value)
        autoPlayEnabled = Value
        if Value then
            Rayfield:Notify({
                Title = "AI Assistant Activated",
                Content = "The AI is now analyzing the game...",
                Duration = 5,
                Image = 6023423423
            })
            
            spawn(function()
                while autoPlayEnabled do
                    if os.time() - lastDecisionTime >= decisionCooldown then
                        makeAIDecision()
                        lastDecisionTime = os.time()
                    end
                    wait(1)
                end
            end)
        else
            Rayfield:Notify({
                Title = "AI Assistant Deactivated",
                Content = "Control returned to player",
                Duration = 3,
                Image = 6023423423
            })
        end
    end,
})

AITab:CreateSlider({
    Name = "⏱️ Decision Frequency",
    Range = {1, 30},
    Increment = 1,
    Suffix = "seconds",
    CurrentValue = 5,
    Flag = "AICooldown",
    Callback = function(Value)
        decisionCooldown = Value
    end,
})

local function analyzeGameEnvironment()
    local gameData = {
        player = {
            position = game.Players.LocalPlayer.Character.HumanoidRootPart.Position,
            health = game.Players.LocalPlayer.Character.Humanoid.Health,
            weapons = {}
        },
        enemies = {},
        objectives = {},
        environment = {}
    }
    
    for _, player in ipairs(game:GetService("Players"):GetPlayers()) do
        if player ~= game.Players.LocalPlayer and player.Character then
            table.insert(gameData.enemies, {
                name = player.Name,
                position = player.Character.HumanoidRootPart.Position,
                distance = (gameData.player.position - player.Character.HumanoidRootPart.Position).Magnitude
            })
        end
    end
    
    for _, obj in ipairs(workspace:GetChildren()) do
        if obj.Name:find("Flag") or obj.Name:find("Objective") then
            table.insert(gameData.objectives, {
                name = obj.Name,
                position = obj.Position
            })
        end
    end
    
    return gameData
end

local function makeAIDecision()
    local gameState = analyzeGameEnvironment()
    local prompt = string.format([[
        Analyze this Roblox game situation and suggest the best action (1-5):
        
        Player:
        - Position: %s
        - Health: %d
        - Nearby enemies: %d
        
        Available objectives: %d
        
        Respond only with the action number:
        1. Attack nearest enemy
        2. Go to objective
        3. Find health
        4. Explore area
        5. Find better weapons
    ]], 
    tostring(gameState.player.position),
    gameState.player.health,
    #gameState.enemies,
    #gameState.objectives)
    
    local response = queryGemini(prompt)
    local decision = tonumber(response.candidates[1].content.parts[1].text) or 1
    
    executeAIDecision(decision, gameState)
end

local function executeAIDecision(decision, gameState)
    local actionMessages = {
        "⚔️ Attacking nearest enemy",
        "🎯 Moving to objective",
        "💊 Searching for health",
        "🧭 Exploring area",
        "🔫 Looking for better weapons"
    }
    
    Rayfield:Notify({
        Title = "AI Decision: " .. actionMessages[decision],
        Content = "Executing optimized strategy...",
        Duration = 3,
        Image = 6023423423
    })
    
    if decision == 1 and #gameState.enemies > 0 then
        -- Activate combat systems
        if CombatTab then
            CombatTab:Get("KillAura").Callback(true)
        end
        
        local closestEnemy = gameState.enemies[1]
        for _, enemy in ipairs(gameState.enemies) do
            if enemy.distance < closestEnemy.distance then
                closestEnemy = enemy
            end
        end
        
        game.Players.LocalPlayer.Character.Humanoid:MoveTo(closestEnemy.position)
        
    elseif decision == 2 and #gameState.objectives > 0 then
        local closestObj = gameState.objectives[1]
        for _, obj in ipairs(gameState.objectives) do
            if (obj.position - gameState.player.position).Magnitude < 
               (closestObj.position - gameState.player.position).Magnitude then
                closestObj = obj
            end
        end
        
        game.Players.LocalPlayer.Character.Humanoid:MoveTo(closestObj.position)
        
    elseif decision == 3 then
        for _, item in ipairs(workspace:GetChildren()) do
            if item.Name:find("Med") or item.Name:find("Health") then
                game.Players.LocalPlayer.Character.Humanoid:MoveTo(item.Position)
                break
            end
        end
        
    elseif decision == 4 then
        local randomPos = gameState.player.position + Vector3.new(
            math.random(-50, 50),
            0,
            math.random(-50, 50)
        game.Players.LocalPlayer.Character.Humanoid:MoveTo(randomPos)
        
    elseif decision == 5 then
        for _, item in ipairs(workspace:GetChildren()) do
            if item:IsA("Tool") or item.Name:find("Weapon") then
                game.Players.LocalPlayer.Character.Humanoid:MoveTo(item.Position)
                break
            end
        end
    end
end

-- Runtime Updates
game:GetService("RunService").Heartbeat:Connect(function()
    -- Speed Boost
    if speedBoostActive then
        pcall(function()
            local humanoid = game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.LeftShift) then
                    humanoid.WalkSpeed = walkSpeed * 2
                else
                    humanoid.WalkSpeed = walkSpeed
                end
            end
        end)
    end
    
    -- Anti Trap
    if HelperTab:Get("AntiTrap").CurrentValue then
        pcall(function()
            for _, part in ipairs(workspace:GetDescendants()) do
                if part:IsA("BasePart") and part.CanCollide == false and part.Transparency > 0.5 then
                    part.CanCollide = false
                end
            end
        end)
    end
end)

-- Initialize
Rayfield:LoadConfiguration()
Rayfield:SetWatermark("✨ Ultimate AI Hub v5.0 | " .. os.date("%X"))
Rayfield:SetWatermarkVisibility(true)
Rayfield:SetKeybind(Enum.KeyCode.F4)
Rayfield:Notify({
    Title = "System Fully Initialized",
    Content = "All features loaded successfully!\nAI Integration: ONLINE",
    Duration = 5,
    Image = 6023423423
})

print("Ultimate AI Hub loaded with all features working!")
