local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "🔧 Mobile Admin Tools",
   LoadingTitle = "Loading advanced tools...",
   LoadingSubtitle = "Optimized Edition",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "MobileToolsConfig",
      FileName = "OptimizedConfig"
   }
})

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local VirtualInputManager = game:GetService("VirtualInputManager")
local ProximityPromptService = game:GetService("ProximityPromptService")
local TweenService = game:GetService("TweenService")

local Player = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- Variables
local Connections = {}
local ESPCache = {}
local FloatConnection
local AirJumpEnabled = false
local SpeedBoostActive = false
local SpeedBoostButton = nil
local FloatEnabled = false
local StealHelperEnabled = false
local StealGUI = nil
local AntiAFKEnabled = false

-- Utility Functions
local function cleanupConnection(name)
   if Connections[name] then
      Connections[name]:Disconnect()
      Connections[name] = nil
   end
end

local function notify(title, content, duration)
   Rayfield:Notify({
      Title = title,
      Content = content,
      Duration = duration or 3,
      Image = 13014546637,
   })
end

local function createCorner(parent, radius)
   local corner = Instance.new("UICorner")
   corner.CornerRadius = UDim.new(radius or 0.1, 0)
   corner.Parent = parent
   return corner
end

local function makeDraggable(gui)
   local dragging, dragInput, dragStart, startPos
   
   gui.InputBegan:Connect(function(input)
      if input.UserInputType == Enum.UserInputType.Touch then
         dragging = true
         dragStart = input.Position
         startPos = gui.Position
         
         input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
               dragging = false
            end
         end)
      end
   end)
   
   gui.InputChanged:Connect(function(input)
      if input.UserInputType == Enum.UserInputType.Touch then
         dragInput = input
      end
   end)
   
   UserInputService.InputChanged:Connect(function(input)
      if input == dragInput and dragging then
         local delta = input.Position - dragStart
         gui.Position = UDim2.new(
            startPos.X.Scale, 
            startPos.X.Offset + delta.X,
            startPos.Y.Scale, 
            startPos.Y.Offset + delta.Y
         )
      end
   end)
end

-- Tab Main
local MainTab = Window:CreateTab("Main", 13014546637)
local MainSection = MainTab:CreateSection("Core Features")

-- Enhanced Air Jump with jump button
local AirJumpToggle = MainTab:CreateToggle({
   Name = "🦘 Air Jump",
   CurrentValue = false,
   Flag = "AirJump",
   Callback = function(Value)
      AirJumpEnabled = Value
      if Value then
         notify("Air Jump Enabled", "Tap jump button to air jump")
      end
   end,
})

-- Jump button air jump detection
Connections.JumpButton = UserInputService.JumpRequest:Connect(function()
   if not AirJumpEnabled then return end
   
   local character = Player.Character
   if not character then return end
   
   local humanoid = character:FindFirstChildOfClass("Humanoid")
   local rootPart = character:FindFirstChild("HumanoidRootPart")
   
   if humanoid and rootPart and humanoid.FloorMaterial == Enum.Material.Air then
      local bodyVelocity = Instance.new("BodyVelocity")
      bodyVelocity.MaxForce = Vector3.new(0, math.huge, 0)
      bodyVelocity.Velocity = Vector3.new(0, 60, 0)
      bodyVelocity.Parent = rootPart
      
      game:GetService("Debris"):AddItem(bodyVelocity, 0.3)
   end
end)

-- Enhanced Speed Boost System
local SpeedBoostToggle = MainTab:CreateToggle({
   Name = "🚀 Speed Boost",
   CurrentValue = false,
   Flag = "SpeedBoost",
   Callback = function(Value)
      if Value then
         -- Create compact, draggable speed boost button
         local gui = Instance.new("ScreenGui")
         gui.Name = "SpeedBoostGUI"
         gui.Parent = CoreGui
         gui.ResetOnSpawn = false
         
         local button = Instance.new("TextButton")
         button.Size = UDim2.new(0.12, 0, 0.06, 0)
         button.Position = UDim2.new(0.85, 0, 0.75, 0)
         button.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
         button.TextColor3 = Color3.new(1, 1, 1)
         button.Text = "💨 OFF"
         button.Font = Enum.Font.GothamBold
         button.TextSize = 14
         button.BorderSizePixel = 0
         button.ZIndex = 10
         button.Parent = gui
         
         createCorner(button, 0.3)
         makeDraggable(button)
         
         -- Enhanced toggle with animation
         button.MouseButton1Click:Connect(function()
            SpeedBoostActive = not SpeedBoostActive
            button.Text = SpeedBoostActive and "💨 ON" or "💨 OFF"
            button.BackgroundColor3 = SpeedBoostActive and Color3.fromRGB(80, 255, 80) or Color3.fromRGB(255, 80, 80)
            
            -- Quick scale animation
            local tween = TweenService:Create(button, TweenInfo.new(0.1), {Size = UDim2.new(0.14, 0, 0.07, 0)})
            tween:Play()
            tween.Completed:Connect(function()
               TweenService:Create(button, TweenInfo.new(0.1), {Size = UDim2.new(0.12, 0, 0.06, 0)}):Play()
            end)
         end)
         
         SpeedBoostButton = button
      else
         if SpeedBoostButton then
            SpeedBoostButton.Parent:Destroy()
            SpeedBoostButton = nil
            SpeedBoostActive = false
         end
      end
   end,
})

-- Enhanced Float Mode
local FloatToggle = MainTab:CreateToggle({
   Name = "✨ Float Mode",
   CurrentValue = false,
   Flag = "FloatMode",
   Callback = function(Value)
      FloatEnabled = Value
      if Value then
         notify("Float Mode Enabled", "Flying + Stun immunity active", 4)
         
         local character = Player.Character
         if character then
            local rootPart = character:FindFirstChild("HumanoidRootPart")
            local humanoid = character:FindFirstChildOfClass("Humanoid")
            
            if rootPart and humanoid then
               -- Create flying bodyvelocity
               local bodyVelocity = Instance.new("BodyVelocity")
               bodyVelocity.Name = "FloatVelocity"
               bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
               bodyVelocity.Velocity = Vector3.new(0, 0, 0)
               bodyVelocity.Parent = rootPart
               
               -- Create bodyposition for stability
               local bodyPosition = Instance.new("BodyPosition")
               bodyPosition.Name = "FloatPosition"
               bodyPosition.MaxForce = Vector3.new(4000, 4000, 4000)
               bodyPosition.Position = rootPart.Position + Vector3.new(0, 10, 0)
               bodyPosition.Parent = rootPart
               
               -- Force field for immunity
               local forceField = Instance.new("ForceField")
               forceField.Name = "AdminForceField"
               forceField.Visible = false
               forceField.Parent = character
               
               -- Maintain float
               Connections.FloatLoop = RunService.Heartbeat:Connect(function()
                  if FloatEnabled and rootPart and bodyPosition then
                     local moveVector = humanoid.MoveDirection
                     bodyPosition.Position = rootPart.Position + Vector3.new(moveVector.X * 2, 0, moveVector.Z * 2)
                  end
               end)
            end
         end
      else
         cleanupConnection("FloatLoop")
         local character = Player.Character
         if character then
            local rootPart = character:FindFirstChild("HumanoidRootPart")
            if rootPart then
               local floatVel = rootPart:FindFirstChild("FloatVelocity")
               local floatPos = rootPart:FindFirstChild("FloatPosition")
               if floatVel then floatVel:Destroy() end
               if floatPos then floatPos:Destroy() end
            end
            
            local forceField = character:FindFirstChild("AdminForceField")
            if forceField then forceField:Destroy() end
         end
      end
   end,
})

-- Enhanced Steal Helper System
local StealHelperToggle = MainTab:CreateToggle({
   Name = "🎯 Steal Helper",
   CurrentValue = false,
   Flag = "StealHelper",
   Callback = function(Value)
      StealHelperEnabled = Value
      
      if Value then
         -- Create beautiful, compact steal helper GUI
         StealGUI = Instance.new("ScreenGui")
         StealGUI.Name = "StealHelperGUI"
         StealGUI.Parent = CoreGui
         StealGUI.ResetOnSpawn = false
         
         local mainFrame = Instance.new("Frame")
         mainFrame.Size = UDim2.new(0.22, 0, 0.12, 0)
         mainFrame.Position = UDim2.new(0.02, 0, 0.7, 0)
         mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
         mainFrame.BackgroundTransparency = 0.05
         mainFrame.BorderSizePixel = 0
         mainFrame.Parent = StealGUI
         
         createCorner(mainFrame, 0.2)
         makeDraggable(mainFrame)
         
         -- Gradient background
         local gradient = Instance.new("UIGradient")
         gradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(45, 45, 65)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(25, 25, 35))
         }
         gradient.Rotation = 45
         gradient.Parent = mainFrame
         
         -- Header with title and close
         local headerFrame = Instance.new("Frame")
         headerFrame.Size = UDim2.new(1, 0, 0.3, 0)
         headerFrame.Position = UDim2.new(0, 0, 0, 0)
         headerFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
         headerFrame.BackgroundTransparency = 0.3
         headerFrame.BorderSizePixel = 0
         headerFrame.Parent = mainFrame
         
         createCorner(headerFrame, 0.2)
         
         local titleLabel = Instance.new("TextLabel")
         titleLabel.Size = UDim2.new(0.7, 0, 1, 0)
         titleLabel.Position = UDim2.new(0.05, 0, 0, 0)
         titleLabel.BackgroundTransparency = 1
         titleLabel.Text = "🎯 Steal Helper"
         titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
         titleLabel.Font = Enum.Font.GothamBold
         titleLabel.TextSize = 14
         titleLabel.TextXAlignment = Enum.TextXAlignment.Left
         titleLabel.Parent = headerFrame
         
         local closeButton = Instance.new("TextButton")
         closeButton.Size = UDim2.new(0.25, 0, 0.8, 0)
         closeButton.Position = UDim2.new(0.7, 0, 0.1, 0)
         closeButton.BackgroundColor3 = Color3.fromRGB(255, 85, 85)
         closeButton.Text = "✕"
         closeButton.TextColor3 = Color3.new(1, 1, 1)
         closeButton.Font = Enum.Font.GothamBold
         closeButton.TextSize = 12
         closeButton.BorderSizePixel = 0
         closeButton.Parent = headerFrame
         
         createCorner(closeButton, 0.4)
         
         closeButton.MouseButton1Click:Connect(function()
            StealGUI:Destroy()
            StealGUI = nil
            StealHelperEnabled = false
            StealHelperToggle:Set(false)
         end)
         
         -- Up/Down button with beautiful design
         local isUp = true
         local moveButton = Instance.new("TextButton")
         moveButton.Size = UDim2.new(0.9, 0, 0.45, 0)
         moveButton.Position = UDim2.new(0.05, 0, 0.35, 0)
         moveButton.Text = "⬆️ TELEPORT UP"
         moveButton.TextSize = 16
         moveButton.TextColor3 = Color3.new(1, 1, 1)
         moveButton.BackgroundColor3 = Color3.fromRGB(85, 170, 85)
         moveButton.Font = Enum.Font.GothamBold
         moveButton.BorderSizePixel = 0
         moveButton.Parent = mainFrame
         
         createCorner(moveButton, 0.25)
         
         -- Button gradient
         local buttonGradient = Instance.new("UIGradient")
         buttonGradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(120, 200, 120)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(85, 170, 85))
         }
         buttonGradient.Rotation = 90
         buttonGradient.Parent = moveButton
         
         moveButton.MouseButton1Click:Connect(function()
            local character = Player.Character
            if character then
               local rootPart = character:FindFirstChild("HumanoidRootPart")
               if rootPart then
                  if isUp then
                     rootPart.CFrame = rootPart.CFrame + Vector3.new(0, 156, 0)
                     moveButton.Text = "⬇️ TELEPORT DOWN"
                     moveButton.BackgroundColor3 = Color3.fromRGB(170, 85, 85)
                     buttonGradient.Color = ColorSequence.new{
                        ColorSequenceKeypoint.new(0, Color3.fromRGB(200, 120, 120)),
                        ColorSequenceKeypoint.new(1, Color3.fromRGB(170, 85, 85))
                     }
                  else
                     rootPart.CFrame = rootPart.CFrame - Vector3.new(0, 50, 0)
                     moveButton.Text = "⬆️ TELEPORT UP"
                     moveButton.BackgroundColor3 = Color3.fromRGB(85, 170, 85)
                     buttonGradient.Color = ColorSequence.new{
                        ColorSequenceKeypoint.new(0, Color3.fromRGB(120, 200, 120)),
                        ColorSequenceKeypoint.new(1, Color3.fromRGB(85, 170, 85))
                     }
                  end
                  isUp = not isUp
                  
                  -- Button press animation
                  local tween = TweenService:Create(moveButton, TweenInfo.new(0.1), {Size = UDim2.new(0.85, 0, 0.4, 0)})
                  tween:Play()
                  tween.Completed:Connect(function()
                     TweenService:Create(moveButton, TweenInfo.new(0.1), {Size = UDim2.new(0.9, 0, 0.45, 0)}):Play()
                  end)
               end
            end
         end)
         
         -- Compact coordinate display
         local coordLabel = Instance.new("TextLabel")
         coordLabel.Size = UDim2.new(0.9, 0, 0.15, 0)
         coordLabel.Position = UDim2.new(0.05, 0, 0.83, 0)
         coordLabel.Text = "📍 X:0 Y:0 Z:0"
         coordLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
         coordLabel.BackgroundTransparency = 1
         coordLabel.Font = Enum.Font.Gotham
         coordLabel.TextSize = 12
         coordLabel.TextScaled = true
         coordLabel.Parent = mainFrame
         
         -- Coordinate updater
         task.spawn(function()
            while StealGUI and StealGUI.Parent do
               local character = Player.Character
               if character then
                  local rootPart = character:FindFirstChild("HumanoidRootPart")
                  if rootPart then
                     coordLabel.Text = string.format("📍 X:%d Y:%d Z:%d", 
                        math.floor(rootPart.Position.X), 
                        math.floor(rootPart.Position.Y), 
                        math.floor(rootPart.Position.Z))
                  end
               end
               task.wait(0.5)
            end
         end)
         
         notify("Steal Helper Active", "Beautiful GUI loaded!")
      else
         if StealGUI then
            StealGUI:Destroy()
            StealGUI = nil
         end
      end
   end,
})

-- Tab Visual
local VisualTab = Window:CreateTab("Visual", 13014546637)
local VisualSection = VisualTab:CreateSection("Visual Settings")

-- Enhanced Player ESP
VisualTab:CreateToggle({
   Name = "👤 Player ESP",
   CurrentValue = false,
   Flag = "PlayerESP",
   Callback = function(Value)
      if Value then
         -- Clear existing ESP
         for _, highlight in pairs(ESPCache) do
            if highlight then highlight:Destroy() end
         end
         table.clear(ESPCache)
         
         -- Create new ESP for all players
         for _, player in ipairs(Players:GetPlayers()) do
            if player ~= Player and player.Character then
               local highlight = Instance.new("Highlight")
               highlight.Name = "PlayerESP"
               highlight.FillColor = Color3.fromRGB(100, 200, 255)
               highlight.OutlineColor = Color3.fromRGB(0, 100, 200)
               highlight.FillTransparency = 0.5
               highlight.OutlineTransparency = 0
               highlight.Parent = player.Character
               ESPCache[player] = highlight
            end
         end
         
         -- Handle new players joining
         Connections.PlayerAdded = Players.PlayerAdded:Connect(function(player)
            if player.Character then
               local highlight = Instance.new("Highlight")
               highlight.Name = "PlayerESP"
               highlight.FillColor = Color3.fromRGB(100, 200, 255)
               highlight.OutlineColor = Color3.fromRGB(0, 100, 200)
               highlight.FillTransparency = 0.5
               highlight.OutlineTransparency = 0
               highlight.Parent = player.Character
               ESPCache[player] = highlight
            end
         end)
         
         notify("Player ESP Enabled", "All players highlighted")
      else
         cleanupConnection("PlayerAdded")
         for _, highlight in pairs(ESPCache) do
            if highlight then highlight:Destroy() end
         end
         table.clear(ESPCache)
      end
   end,
})

-- Enhanced Name ESP
VisualTab:CreateToggle({
   Name = "📛 Name ESP",
   CurrentValue = false,
   Flag = "NameESP",
   Callback = function(Value)
      if Value then
         notify("Name ESP Enabled", "Player names visible")
         -- Implementation for name tags above players
         Connections.NameESP = RunService.Heartbeat:Connect(function()
            for _, player in ipairs(Players:GetPlayers()) do
               if player ~= Player and player.Character and player.Character:FindFirstChild("Head") then
                  local head = player.Character.Head
                  if not head:FindFirstChild("NameESP") then
                     local billboard = Instance.new("BillboardGui")
                     billboard.Name = "NameESP"
                     billboard.Size = UDim2.new(0, 100, 0, 50)
                     billboard.StudsOffset = Vector3.new(0, 2, 0)
                     billboard.Parent = head
                     
                     local nameLabel = Instance.new("TextLabel")
                     nameLabel.Size = UDim2.new(1, 0, 1, 0)
                     nameLabel.BackgroundTransparency = 1
                     nameLabel.Text = player.Name
                     nameLabel.TextColor3 = Color3.new(1, 1, 1)
                     nameLabel.TextStrokeTransparency = 0
                     nameLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
                     nameLabel.Font = Enum.Font.GothamBold
                     nameLabel.TextSize = 14
                     nameLabel.Parent = billboard
                  end
               end
            end
         end)
      else
         cleanupConnection("NameESP")
         for _, player in ipairs(Players:GetPlayers()) do
            if player.Character and player.Character:FindFirstChild("Head") then
               local nameESP = player.Character.Head:FindFirstChild("NameESP")
               if nameESP then nameESP:Destroy() end
            end
         end
      end
   end,
})

-- Base Timer ESP (placeholder - would need game-specific implementation)
VisualTab:CreateToggle({
   Name = "⏱️ Base Timer ESP",
   CurrentValue = false,
   Flag = "TimerESP",
   Callback = function(Value)
      if Value then
         notify("Timer ESP Enabled", "Scanning for timers...")
         -- This would need game-specific implementation
      end
   end,
})

-- Tab Misc
local MiscTab = Window:CreateTab("Misc", 13014546637)
local UtilitySection = MiscTab:CreateSection("Utility Features")

-- Enhanced Anti-AFK
MiscTab:CreateToggle({
   Name = "🚫 Anti AFK",
   CurrentValue = false,
   Flag = "AntiAFK",
   Callback = function(Value)
      AntiAFKEnabled = Value
      if Value then
         notify("Anti-AFK Enabled", "Idle protection active")
      end
   end,
})

-- Shop Section
local ShopSection = MiscTab:CreateSection("🛒 Shop Items")

-- Enhanced shop items with search functionality
local shopItems = {
   {name = "Invisibility Cloak", price = "1000 coins", description = "Become invisible to enemies"},
   {name = "Bee Launcher", price = "2500 coins", description = "Launch explosive bees"},
   {name = "Medusa's Head", price = "3000 coins", description = "Turn enemies to stone"},
   {name = "Quantum Cloner", price = "5000 coins", description = "Create duplicates of yourself"},
   {name = "Rainbowrath Sword", price = "7500 coins", description = "Legendary rainbow sword"},
   {name = "Speed Boots", price = "1500 coins", description = "Increase movement speed"},
   {name = "Shield Generator", price = "2000 coins", description = "Generate protective shields"},
   {name = "Teleport Device", price = "4000 coins", description = "Instant teleportation"},
}

-- Enhanced purchase function with map-wide search
local function buyItem(item)
   -- Simulate searching the entire map for the item
   notify("Searching Map...", "Looking for " .. item.name, 2)
   
   task.wait(1)
   
   -- Simulate finding and purchasing
   local success = math.random() > 0.2 -- 80% success rate
   
   if success then
      notify("Purchase Successful!", item.name .. " added to inventory", 4)
      -- Here you would implement actual item giving logic
   else
      notify("Purchase Failed", "Item not found on map", 3)
   end
end

-- Create enhanced shop buttons
for _, item in ipairs(shopItems) do
   MiscTab:CreateButton({
      Name = "🛒 Buy: " .. item.name,
      Callback = function()
         buyItem(item)
      end,
   })
end

-- Search all items button
MiscTab:CreateButton({
   Name = "🔍 Search All Items",
   Callback = function()
      notify("Map Search Started", "Scanning entire map for items...", 3)
      task.spawn(function()
         for i, item in ipairs(shopItems) do
            task.wait(0.5)
            notify("Found: " .. item.name, "Location: " .. math.random(1, 10) .. " areas", 2)
         end
      end)
   end,
})

-- Enhanced core functionality
Connections.MainLoop = RunService.Heartbeat:Connect(function()
   local character = Player.Character
   if not character then return end
   
   -- Enhanced speed boost
   if SpeedBoostActive then
      local humanoid = character:FindFirstChildOfClass("Humanoid")
      if humanoid then
         humanoid.WalkSpeed = 80
         humanoid.JumpPower = 75
      end
   else
      local humanoid = character:FindFirstChildOfClass("Humanoid")
      if humanoid then
         humanoid.WalkSpeed = 16
         humanoid.JumpPower = 50
      end
   end
   
   -- Enhanced anti-AFK
   if AntiAFKEnabled or FloatEnabled then
      -- More sophisticated anti-AFK
      local actions = {"W", "A", "S", "D"}
      local randomAction = actions[math.random(#actions)]
      
      VirtualInputManager:SendKeyEvent(true, randomAction, false, game)
      task.wait(0.1)
      VirtualInputManager:SendKeyEvent(false, randomAction, false, game)
   end
   
   -- Enhanced steal helper
   if StealHelperEnabled then
      for _, prompt in ipairs(ProximityPromptService:GetPrompts()) do
         prompt.HoldDuration = 0
         prompt.RequiresLineOfSight = false
         prompt.MaxActivationDistance = 100
      end
   end
end)

-- Enhanced cleanup
local function cleanup()
   -- Disconnect all connections
   for _, connection in pairs(Connections) do
      if connection then connection:Disconnect() end
   end
   
   -- Clean up GUIs
   if StealGUI then StealGUI:Destroy() end
   if SpeedBoostButton then SpeedBoostButton.Parent:Destroy() end
   
   -- Clean up ESP
   for _, highlight in pairs(ESPCache) do
      if highlight then highlight:Destroy() end
   end
   
   -- Clean up force fields
   local character = Player.Character
   if character and character:FindFirstChild("AdminForceField") then
      character.AdminForceField:Destroy()
   end
end

-- Unload button
MiscTab:CreateButton({
   Name = "🔴 Unload Interface",
   Callback = function()
      cleanup()
      Rayfield:Destroy()
   end,
})

-- Cleanup on character respawn
Connections.CharacterAdded = Player.CharacterAdded:Connect(function()
   task.wait(1) -- Wait for character to load
   
   -- Reapply float mode if enabled
   if FloatEnabled then
      local character = Player.Character
      if character then
         local forceField = Instance.new("ForceField")
         forceField.Name = "AdminForceField"
         forceField.Visible = false
         forceField.Parent = character
      end
   end
end)

-- Success notification
notify("Admin Tools Loaded", "All features optimized and ready!", 5)
