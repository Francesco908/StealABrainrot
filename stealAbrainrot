-- Water Hub - Enhanced Admin Script
-- Modern Fluent UI Design with Full Functionality

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local SoundService = game:GetService("SoundService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Variables
local waterHub = {}
local connections = {}
local isFlying = false
local flySpeed = 50
local isInvisible = false
local hasAirJump = false
local espEnabled = false
local espConnections = {}
local lockTarget = nil
local lockPosition = nil
local autoLockEnabled = false
local speedBoostEnabled = false
local originalWalkSpeed = 16

-- Create click sound
local clickSound = Instance.new("Sound")
clickSound.SoundId = "rbxassetid://270882215" -- Soft click sound
clickSound.Volume = 0.3
clickSound.Parent = SoundService

-- Create Main GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "WaterHub"
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Main Frame (Fluent UI with transparency)
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 450, 0, 400)
mainFrame.Position = UDim2.new(0.5, -225, 0.5, -200)
mainFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
mainFrame.BackgroundTransparency = 0.2
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

-- Add corner rounding
local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 12)
mainCorner.Parent = mainFrame

-- Add subtle shadow effect
local shadow = Instance.new("ImageLabel")
shadow.Name = "Shadow"
shadow.Image = "rbxassetid://1316045217"
shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
shadow.ImageTransparency = 0.8
shadow.ScaleType = Enum.ScaleType.Slice
shadow.SliceCenter = Rect.new(10, 10, 118, 118)
shadow.Size = UDim2.new(1, 20, 1, 20)
shadow.Position = UDim2.new(0, -10, 0, -10)
shadow.BackgroundTransparency = 1
shadow.ZIndex = -1
shadow.Parent = mainFrame

-- Title Bar
local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 40)
titleBar.Position = UDim2.new(0, 0, 0, 0)
titleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
titleBar.BackgroundTransparency = 0.2
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 12)
titleCorner.Parent = titleBar

-- Title Text
local titleText = Instance.new("TextLabel")
titleText.Name = "TitleText"
titleText.Size = UDim2.new(1, -80, 1, 0)
titleText.Position = UDim2.new(0, 15, 0, 0)
titleText.BackgroundTransparency = 1
titleText.Text = "WATER HUB"
titleText.TextColor3 = Color3.fromRGB(200, 200, 255)
titleText.TextScaled = true
titleText.Font = Enum.Font.GothamBold
titleText.TextXAlignment = Enum.TextXAlignment.Left
titleText.Parent = titleBar

-- Minimize Button
local minimizeButton = Instance.new("ImageButton")
minimizeButton.Name = "MinimizeButton"
minimizeButton.Size = UDim2.new(0, 30, 0, 30)
minimizeButton.Position = UDim2.new(1, -70, 0, 5)
minimizeButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
minimizeButton.BorderSizePixel = 0
minimizeButton.Image = "rbxassetid://3926305904"
minimizeButton.ImageRectOffset = Vector2.new(124, 204)
minimizeButton.ImageRectSize = Vector2.new(36, 36)
minimizeButton.ImageColor3 = Color3.fromRGB(200, 200, 200)
minimizeButton.Parent = titleBar

local minimizeCorner = Instance.new("UICorner")
minimizeCorner.CornerRadius = UDim.new(0, 6)
minimizeCorner.Parent = minimizeButton

-- Close Button
local closeButton = Instance.new("ImageButton")
closeButton.Name = "CloseButton"
closeButton.Size = UDim2.new(0, 30, 0, 30)
closeButton.Position = UDim2.new(1, -35, 0, 5)
closeButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
closeButton.BorderSizePixel = 0
closeButton.Image = "rbxassetid://3926305904"
closeButton.ImageRectOffset = Vector2.new(284, 4)
closeButton.ImageRectSize = Vector2.new(24, 24)
closeButton.ImageColor3 = Color3.fromRGB(200, 200, 200)
closeButton.Parent = titleBar

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 6)
closeCorner.Parent = closeButton

-- Tab Container
local tabContainer = Instance.new("Frame")
tabContainer.Name = "TabContainer"
tabContainer.Size = UDim2.new(1, 0, 0, 40)
tabContainer.Position = UDim2.new(0, 0, 0, 40)
tabContainer.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
tabContainer.BackgroundTransparency = 0.2
tabContainer.BorderSizePixel = 0
tabContainer.Parent = mainFrame

-- Content Frame
local contentFrame = Instance.new("Frame")
contentFrame.Name = "ContentFrame"
contentFrame.Size = UDim2.new(1, -20, 1, -90)
contentFrame.Position = UDim2.new(0, 10, 0, 85)
contentFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
contentFrame.BackgroundTransparency = 0.2
contentFrame.BorderSizePixel = 0
contentFrame.Parent = mainFrame

-- Content corner
local contentCorner = Instance.new("UICorner")
contentCorner.CornerRadius = UDim.new(0, 8)
contentCorner.Parent = contentFrame

-- Tab System
local tabs = {"Main", "ESP", "Misc", "Server"}
local tabButtons = {}
local tabContents = {}
local activeTab = "Main"

-- Create Tab Buttons
for i, tabName in ipairs(tabs) do
    local tabButton = Instance.new("TextButton")
    tabButton.Name = tabName .. "Tab"
    tabButton.Size = UDim2.new(0.25, -2, 1, -4)
    tabButton.Position = UDim2.new((i-1) * 0.25, 0, 0, 2)
    tabButton.BackgroundColor3 = tabName == activeTab and Color3.fromRGB(0, 120, 215) or Color3.fromRGB(50, 50, 50)
    tabButton.BackgroundTransparency = tabName == activeTab and 0 or 0.3
    tabButton.BorderSizePixel = 0
    tabButton.Text = tabName
    tabButton.TextColor3 = Color3.fromRGB(220, 220, 220)
    tabButton.TextScaled = true
    tabButton.Font = Enum.Font.GothamMedium
    tabButton.Parent = tabContainer
    
    tabButtons[tabName] = tabButton
    
    -- Create content frame for each tab
    local content = Instance.new("ScrollingFrame")
    content.Name = tabName .. "Content"
    content.Size = UDim2.new(1, -10, 1, -10)
    content.Position = UDim2.new(0, 5, 0, 5)
    content.BackgroundTransparency = 1
    content.BorderSizePixel = 0
    content.ScrollBarThickness = 5
    content.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 100)
    content.CanvasSize = UDim2.new(0, 0, 0, 0)
    content.AutomaticCanvasSize = Enum.AutomaticSize.Y
    content.Visible = tabName == activeTab
    content.Parent = contentFrame
    
    -- Add layout to content
    local uiListLayout = Instance.new("UIListLayout")
    uiListLayout.Padding = UDim.new(0, 10)
    uiListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    uiListLayout.Parent = content
    
    local uiPadding = Instance.new("UIPadding")
    uiPadding.PaddingTop = UDim.new(0, 5)
    uiPadding.PaddingLeft = UDim.new(0, 5)
    uiPadding.PaddingRight = UDim.new(0, 5)
    uiPadding.Parent = content
    
    tabContents[tabName] = content
end

-- Helper Function to Create Buttons
local function createButton(parent, text, callback)
    local button = Instance.new("TextButton")
    button.Name = text .. "Button"
    button.Size = UDim2.new(1, 0, 0, 40)
    button.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
    button.BackgroundTransparency = 0.2
    button.BorderSizePixel = 0
    button.Text = text
    button.TextColor3 = Color3.fromRGB(220, 220, 255)
    button.TextScaled = true
    button.Font = Enum.Font.GothamMedium
    button.LayoutOrder = #parent:GetChildren()
    button.Parent = parent
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = button
    
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(80, 80, 100)}):Play()
    end)
    
    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(60, 60, 80)}):Play()
    end)
    
    button.MouseButton1Click:Connect(function()
        clickSound:Play()
        callback()
    end)
    
    return button
end

-- Helper Function to Create Toggle Buttons
local function createToggle(parent, text, callback)
    local frame = Instance.new("Frame")
    frame.Name = text .. "Frame"
    frame.Size = UDim2.new(1, 0, 0, 40)
    frame.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
    frame.BackgroundTransparency = 0.2
    frame.BorderSizePixel = 0
    frame.LayoutOrder = #parent:GetChildren()
    frame.Parent = parent
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = frame
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.Position = UDim2.new(0, 15, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.fromRGB(220, 220, 255)
    label.TextScaled = true
    label.Font = Enum.Font.GothamMedium
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame
    
    local toggle = Instance.new("TextButton")
    toggle.Name = "Toggle"
    toggle.Size = UDim2.new(0, 60, 0, 30)
    toggle.Position = UDim2.new(1, -70, 0.5, -15)
    toggle.BackgroundColor3 = Color3.fromRGB(100, 30, 30)
    toggle.BorderSizePixel = 0
    toggle.Text = "OFF"
    toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggle.TextScaled = true
    toggle.Font = Enum.Font.GothamBold
    toggle.Parent = frame
    
    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(0, 15)
    toggleCorner.Parent = toggle
    
    local isOn = false
    
    toggle.MouseButton1Click:Connect(function()
        clickSound:Play()
        isOn = not isOn
        if isOn then
            TweenService:Create(toggle, TweenInfo.new(0.2), {
                BackgroundColor3 = Color3.fromRGB(30, 100, 30),
                Position = UDim2.new(1, -30, 0.5, -15)
            }):Play()
            toggle.Text = "ON"
        else
            TweenService:Create(toggle, TweenInfo.new(0.2), {
                BackgroundColor3 = Color3.fromRGB(100, 30, 30),
                Position = UDim2.new(1, -70, 0.5, -15)
            }):Play()
            toggle.Text = "OFF"
        end
        callback(isOn)
    end)
    
    return toggle
end

-- ESP Functions (same as before)

-- Flight System (same as before)

-- Helper GUI System (same as before)

-- Auto Lock GUI (same as before)

-- Populate Main Tab
local mainContent = tabContents["Main"]

-- Helper Button
createButton(mainContent, "Helper", function()
    createHelperGUI()
end)

-- Float Toggle
createToggle(mainContent, "Float", function(enabled)
    isFlying = enabled
    if enabled then
        startFlying()
    end
end)

-- Air Jump Toggle
createToggle(mainContent, "Air Jump", function(enabled)
    hasAirJump = enabled
    if enabled then
        connections.airJump = UserInputService.JumpRequest:Connect(function()
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                player.Character.HumanoidRootPart.AssemblyLinearVelocity = Vector3.new(0, 50, 0)
            end
        end)
    else
        if connections.airJump then
            connections.airJump:Disconnect()
        end
    end
end)

-- Invisible Player Toggle
createToggle(mainContent, "Invisible Player", function(enabled)
    isInvisible = enabled
    if player.Character then
        for _, part in pairs(player.Character:GetChildren()) do
            if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                part.Transparency = enabled and 1 or 0
            elseif part:IsA("Accessory") then
                part.Handle.Transparency = enabled and 1 or 0
            end
        end
    end
end)

-- Speed Boost Toggle
createToggle(mainContent, "Speed Boost (50%)", function(enabled)
    speedBoostEnabled = enabled
    if player.Character and player.Character:FindFirstChild("Humanoid") then
        local humanoid = player.Character.Humanoid
        if enabled then
            originalWalkSpeed = humanoid.WalkSpeed
            humanoid.WalkSpeed = originalWalkSpeed * 1.5
        else
            humanoid.WalkSpeed = originalWalkSpeed
        end
    end
end)

-- Auto Lock Button
createButton(mainContent, "Auto Lock", function()
    createAutoLockGUI()
end)

-- Populate ESP Tab
local espContent = tabContents["ESP"]

-- ESP Players Toggle
createToggle(espContent, "ESP Players", function(enabled)
    espEnabled = enabled
    if enabled then
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= player then
                createESP(p)
            end
        end
        
        espConnections.playerAdded = Players.PlayerAdded:Connect(function(p)
            if espEnabled then
                createESP(p)
            end
        end)
        
        espConnections.playerRemoving = Players.PlayerRemoving:Connect(function(p)
            removeESP(p)
        end)
    else
        for _, p in pairs(Players:GetPlayers()) do
            removeESP(p)
        end
        
        for _, connection in pairs(espConnections) do
            connection:Disconnect()
        end
        espConnections = {}
    end
end)

-- ESP Names Toggle
createToggle(espContent, "ESP Names", function(enabled)
    -- This is handled within the ESP creation function
end)

-- Populate Misc Tab
local miscContent = tabContents["Misc"]
local soonLabel = Instance.new("TextLabel")
soonLabel.Size = UDim2.new(1, 0, 1, 0)
soonLabel.BackgroundTransparency = 1
soonLabel.Text = "Coming Soon..."
soonLabel.TextColor3 = Color3.fromRGB(180, 180, 220)
soonLabel.TextScaled = true
soonLabel.Font = Enum.Font.GothamMedium
soonLabel.Parent = miscContent

-- Populate Server Tab
local serverContent = tabContents["Server"]

-- Leave Server Button
createButton(serverContent, "Leave Server", function()
    game:Shutdown()
end)

-- Rejoin Server Button
createButton(serverContent, "Rejoin Server", function()
    TeleportService:Teleport(game.PlaceId, player)
end)

-- Server Hop Button
createButton(serverContent, "Server Hop", function()
    local servers = HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"))
    if servers and servers.data then
        for _, server in pairs(servers.data) do
            if server.playing < server.maxPlayers and server.id ~= game.JobId then
                TeleportService:TeleportToPlaceInstance(game.PlaceId, server.id, player)
                break
            end
        end
    end
end)

-- Tab System Logic
for tabName, button in pairs(tabButtons) do
    button.MouseButton1Click:Connect(function()
        clickSound:Play()
        -- Update active tab
        activeTab = tabName
        
        -- Update button colors
        for name, btn in pairs(tabButtons) do
            btn.BackgroundColor3 = name == activeTab and Color3.fromRGB(0, 120, 215) or Color3.fromRGB(50, 50, 50)
            btn.BackgroundTransparency = name == activeTab and 0 or 0.3
        end
        
        -- Update content visibility
        for name, content in pairs(tabContents) do
            content.Visible = name == activeTab
        end
    end)
end

-- Minimize/Close functionality
local isMinimized = false
minimizeButton.MouseButton1Click:Connect(function()
    clickSound:Play()
    isMinimized = not isMinimized
    local targetSize = isMinimized and UDim2.new(0, 450, 0, 40) or UDim2.new(0, 450, 0, 400)
    
    TweenService:Create(mainFrame, TweenInfo.new(0.3), {Size = targetSize}):Play()
    
    tabContainer.Visible = not isMinimized
    contentFrame.Visible = not isMinimized
end)

closeButton.MouseButton1Click:Connect(function()
    clickSound:Play()
    -- Clean up connections
    for _, connection in pairs(connections) do
        connection:Disconnect()
    end
    for _, connection in pairs(espConnections) do
        connection:Disconnect()
    end
    
    screenGui:Destroy()
end)

-- Character respawn handling (same as before)

print("Water Hub loaded successfully!")
