-- Brainrot Universal Steal Script
-- Loading message
local success, err = pcall(function()
    game:GetService("StarterGui"):SetCore("ChatMakeSystemMessage", {
        Text = "[STEAL] Brainrot Script Loading...",
        Color = Color3.new(1, 0.5, 0),
        Font = Enum.Font.SourceSansBold,
        FontSize = Enum.FontSize.Size24
    })
end)

-- Multiple Rayfield loading methods
local Rayfield
pcall(function()
    Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
end)

if not Rayfield then
    pcall(function()
        Rayfield = loadstring(game:HttpGet('https://raw.githubusercontent.com/shlexware/Rayfield/main/source'))()
    end)
end

if not Rayfield then return end

-- Wait for game
repeat task.wait(0.1) until game:IsLoaded()

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local TeleportService = game:GetService("TeleportService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

-- Variables
local godMode = false
local antiRagdoll = false
local skyWidget = nil
local skyWidgetVisible = false
local skyWidgetMinimized = false
local leaveGui = nil
local killAuraActive = false
local killAuraDistance = 50
local killAuraConnection = nil
local intentionalKick = false
local flyEnabled = false
local flyConnection = nil
local espEnabled = false
local espObjects = {}
local boostGui = nil
local boostActive = false
local infiniteJump = false
local jumpCooldown = false
local targetPlayers = {"Tralalero Tralala", "La Vacca Saturno Saturnita"}
local wallsRemoved = false

-- Anti-kick system
local function antiKick()
    local mt = getrawmetatable(game)
    local old = mt.__namecall
    setreadonly(mt, false)
    mt.__namecall = newcclosure(function(self, ...)
        local method = getnamecallmethod()
        if method == "Kick" and not intentionalKick then
            return
        end
        return old(self, ...)
    end)
    setreadonly(mt, true)
end

-- Enhanced God Mode with anti-ragdoll
local function toggleGodMode()
    godMode = not godMode
    local char = LocalPlayer.Character
    if not char then return end
    
    if godMode then
        char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Dead, false)
        char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, false)
        
        char.Humanoid.StateChanged:Connect(function(_, newState)
            if newState == Enum.HumanoidStateType.Dead then
                char.Humanoid:ChangeState(Enum.HumanoidStateType.Running)
            end
        end)
        
        Rayfield:Notify({
            Title = "God Mode Activated",
            Content = "Old version activated!",
            Duration = 3,
            Image = 4483362458
        })
    else
        char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Dead, true)
        char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, true)
        
        Rayfield:Notify({
            Title = "God Mode Deactivated",
            Content = "Protection removed",
            Duration = 3,
            Image = 4483362458
        })
    end
end

-- Infinite Jump with bypass
local function setupInfiniteJump()
    UserInputService.JumpRequest:Connect(function()
        if infiniteJump and not jumpCooldown then
            local char = LocalPlayer.Character
            if char and char:FindFirstChild("Humanoid") then
                char.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                jumpCooldown = true
                task.wait(0.1)
                jumpCooldown = false
            end
        end
    end)
end

-- Permanent Wall Removal (works after death)
local function removeWalls()
    if wallsRemoved then return end
    wallsRemoved = true
    
    local function removeWallsNow()
        for _, obj in pairs(Workspace:GetDescendants()) do
            if obj:IsA("BasePart") and (obj.Name:lower():find("laser") or obj.Name:lower():find("wall")) then
                obj:Destroy()
            end
        end
    end
    
    -- Remove immediately
    removeWallsNow()
    
    -- Keep removing as new walls appear
    local connection
    connection = Workspace.DescendantAdded:Connect(function(obj)
        if obj:IsA("BasePart") and (obj.Name:lower():find("laser") or obj.Name:lower():find("wall")) then
            obj:Destroy()
        end
    end)
    
    -- Reconnect after character respawn
    LocalPlayer.CharacterAdded:Connect(function()
        task.wait(1)
        removeWallsNow()
    end)
    
    Rayfield:Notify({
        Title = "Walls Removed",
        Content = "All walls permanently removed!",
        Duration = 3,
        Image = 4483362458
    })
end

-- ESP Functions with target search
local function createESP(player)
    if not player.Character then return end
    
    local char = player.Character
    local highlight = Instance.new("Highlight")
    highlight.Name = "ESP_" .. player.Name
    
    -- Check if player is in target list
    local isTarget = table.find(targetPlayers, player.Name)
    
    highlight.Adornee = char
    highlight.OutlineColor = isTarget and Color3.new(1, 0, 1) or (player == LocalPlayer and Color3.new(0, 1, 0) or Color3.new(1, 0, 0))
    highlight.FillColor = Color3.new(0, 0, 0, 0)
    highlight.OutlineTransparency = 0
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.Parent = char
    
    espObjects[player] = highlight
    
    -- Add nametag
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "ESPTag"
    billboard.Adornee = char:WaitForChild("Head")
    billboard.Size = UDim2.new(0, 200, 0, 50)
    billboard.StudsOffset = Vector3.new(0, 2, 0)
    billboard.AlwaysOnTop = true
    billboard.Parent = char.Head
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = player.Name .. (isTarget and " (TARGET)" or "")
    label.TextColor3 = isTarget and Color3.new(1, 0, 1) or (player == LocalPlayer and Color3.new(0, 1, 0) or Color3.new(1, 0, 0))
    label.TextSize = 14
    label.Font = Enum.Font.GothamBold
    label.Parent = billboard
end

local function removeESP(player)
    if espObjects[player] then
        espObjects[player]:Destroy()
        espObjects[player] = nil
    end
    
    if player.Character and player.Character:FindFirstChild("Head") then
        local head = player.Character.Head
        if head:FindFirstChild("ESPTag") then
            head.ESPTag:Destroy()
        end
    end
end

local function toggleESP()
    espEnabled = not espEnabled
    
    if espEnabled then
        for _, player in pairs(Players:GetPlayers()) do
            if player.Character then
                createESP(player)
            end
        end
        
        Players.PlayerAdded:Connect(function(player)
            player.CharacterAdded:Connect(function(char)
                if espEnabled then
                    createESP(player)
                end
            end)
        end)
        
        LocalPlayer.CharacterAdded:Connect(function(char)
            if espEnabled then
                createESP(LocalPlayer)
            end
        end)
    else
        for player, _ in pairs(espObjects) do
            removeESP(player)
        end
    end
end

-- Enhanced Kill Aura with configurable distance
local function startKillAura()
    if killAuraActive then return end
    killAuraActive = true
    
    killAuraConnection = RunService.Heartbeat:Connect(function()
        pcall(function()
            local char = LocalPlayer.Character
            if not char or not char:FindFirstChild("HumanoidRootPart") then return end
            
            local tool = LocalPlayer.Backpack:FindFirstChildOfClass("Tool")
            if not tool then
                tool = char:FindFirstChildOfClass("Tool")
            end
            
            if tool then
                local nearbyPlayers = {}
                
                -- Find all nearby players
                for _, player in pairs(Players:GetPlayers()) do
                    if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                        local distance = (player.Character.HumanoidRootPart.Position - char.HumanoidRootPart.Position).Magnitude
                        if distance < killAuraDistance then
                            table.insert(nearbyPlayers, {player = player, distance = distance})
                        end
                    end
                end
                
                -- Sort by distance (closest first)
                table.sort(nearbyPlayers, function(a, b)
                    return a.distance < b.distance
                end)
                
                -- Attack closest players
                for i = 1, math.min(#nearbyPlayers, 3) do
                    local targetPlayer = nearbyPlayers[i].player
                    local targetChar = targetPlayer.Character
                    
                    if targetChar and targetChar:FindFirstChild("HumanoidRootPart") then
                        -- Calculate direction vectors
                        local targetDirection = (targetChar.HumanoidRootPart.Position - char.HumanoidRootPart.Position).Unit
                        
                        -- Rotate character to face target
                        local lookDirection = Vector3.new(targetDirection.X, 0, targetDirection.Z)
                        char.HumanoidRootPart.CFrame = CFrame.lookAt(char.HumanoidRootPart.Position, char.HumanoidRootPart.Position + lookDirection)
                        
                        -- Equip and activate tool (instant activation)
                        if tool.Parent == LocalPlayer.Backpack then
                            char.Humanoid:EquipTool(tool)
                        end
                        
                        if tool:FindFirstChild("Handle") then
                            tool:Activate()
                            task.wait(0.05) -- Minimal delay
                        end
                    end
                end
            end
        end)
    end)
end

local function stopKillAura()
    if killAuraConnection then
        killAuraConnection:Disconnect()
        killAuraConnection = nil
    end
    killAuraActive = false
end

-- Create Sky Widget (fixed version)
local function createSkyWidget()
    if skyWidget then
        skyWidget:Destroy()
        skyWidget = nil
    end
    
    skyWidget = Instance.new("ScreenGui")
    skyWidget.Name = "SkyWidget"
    skyWidget.Parent = LocalPlayer:WaitForChild("PlayerGui")
    skyWidget.ResetOnSpawn = false
    skyWidget.Enabled = true
    
    -- Main Frame
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, 200, 0, 150)
    mainFrame.Position = UDim2.new(0.5, -100, 0.1, 0)
    mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
    mainFrame.BackgroundTransparency = 0.1
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = skyWidget
    mainFrame.Active = true
    mainFrame.Draggable = true
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = mainFrame
    
    -- Header
    local header = Instance.new("Frame")
    header.Name = "Header"
    header.Size = UDim2.new(1, 0, 0, 30)
    header.Position = UDim2.new(0, 0, 0, 0)
    header.BackgroundColor3 = Color3.fromRGB(50, 20, 30)
    header.BackgroundTransparency = 0.2
    header.BorderSizePixel = 0
    header.Parent = mainFrame
    
    local headerCorner = Instance.new("UICorner")
    headerCorner.CornerRadius = UDim.new(0, 12)
    headerCorner.Parent = header
    
    -- Title
    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.Size = UDim2.new(1, -60, 1, 0)
    title.Position = UDim2.new(0, 10, 0, 0)
    title.BackgroundTransparency = 1
    title.Text = "SKY CONTROLS"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextSize = 14
    title.Font = Enum.Font.GothamBold
    title.Parent = header
    
    -- Close Button
    local closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.Size = UDim2.new(0, 20, 0, 20)
    closeButton.Position = UDim2.new(1, -25, 0.5, -10)
    closeButton.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
    closeButton.Text = "✕"
    closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeButton.TextSize = 14
    closeButton.Font = Enum.Font.GothamBold
    closeButton.BorderSizePixel = 0
    closeButton.Parent = header
    
    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 10)
    closeCorner.Parent = closeButton
    
    -- Content
    local contentFrame = Instance.new("Frame")
    contentFrame.Name = "ContentFrame"
    contentFrame.Size = UDim2.new(1, 0, 1, -30)
    contentFrame.Position = UDim2.new(0, 0, 0, 30)
    contentFrame.BackgroundTransparency = 1
    contentFrame.Parent = mainFrame
    
    -- Up Button
    local upButton = Instance.new("TextButton")
    upButton.Name = "UpButton"
    upButton.Size = UDim2.new(0, 180, 0, 30)
    upButton.Position = UDim2.new(0.5, -90, 0, 20)
    upButton.BackgroundColor3 = Color3.fromRGB(70, 120, 200)
    upButton.Text = "⬆️ UP"
    upButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    upButton.TextSize = 14
    upButton.Font = Enum.Font.GothamBold
    upButton.BorderSizePixel = 0
    upButton.Parent = contentFrame
    
    local upCorner = Instance.new("UICorner")
    upCorner.CornerRadius = UDim.new(0, 8)
    upCorner.Parent = upButton
    
    -- Down Button
    local downButton = Instance.new("TextButton")
    downButton.Name = "DownButton"
    downButton.Size = UDim2.new(0, 180, 0, 30)
    downButton.Position = UDim2.new(0.5, -90, 0, 60)
    downButton.BackgroundColor3 = Color3.fromRGB(200, 70, 70)
    downButton.Text = "⬇️ DOWN"
    downButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    downButton.TextSize = 14
    downButton.Font = Enum.Font.GothamBold
    downButton.BorderSizePixel = 0
    downButton.Parent = contentFrame
    
    local downCorner = Instance.new("UICorner")
    downCorner.CornerRadius = UDim.new(0, 8)
    downCorner.Parent = downButton
    
    -- Button connections
    closeButton.MouseButton1Click:Connect(function()
        skyWidget:Destroy()
        skyWidget = nil
    end)
    
    upButton.MouseButton1Click:Connect(function()
        pcall(function()
            local char = LocalPlayer.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                char.HumanoidRootPart.CFrame = char.HumanoidRootPart.CFrame + Vector3.new(0, 50, 0)
            end
        end)
    end)
    
    downButton.MouseButton1Click:Connect(function()
        pcall(function()
            local char = LocalPlayer.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                char.HumanoidRootPart.CFrame = char.HumanoidRootPart.CFrame - Vector3.new(0, 50, 0)
            end
        end)
    end)
    
    skyWidgetVisible = true
end

-- Create Boost GUI (87% boost, works even when carrying brainrot)
local function createBoostGui()
    if boostGui then
        boostGui:Destroy()
    end
    
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "BoostGui"
    screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
    screenGui.ResetOnSpawn = false
    boostGui = screenGui
    
    -- Main Frame (small button)
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, 120, 0, 40)
    mainFrame.Position = UDim2.new(0, 20, 0.5, -20)
    mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
    mainFrame.BackgroundTransparency = 0.1
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = screenGui
    mainFrame.Active = true
    mainFrame.Draggable = true
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = mainFrame
    
    -- Toggle Button
    local boostButton = Instance.new("TextButton")
    boostButton.Name = "BoostButton"
    boostButton.Size = UDim2.new(1, 0, 1, 0)
    boostButton.Position = UDim2.new(0, 0, 0, 0)
    boostButton.BackgroundColor3 = Color3.fromRGB(70, 120, 200)
    boostButton.Text = "BOOST: OFF"
    boostButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    boostButton.TextSize = 14
    boostButton.Font = Enum.Font.GothamBold
    boostButton.BorderSizePixel = 0
    boostButton.Parent = mainFrame
    
    local boostCorner = Instance.new("UICorner")
    boostCorner.CornerRadius = UDim.new(0, 8)
    boostCorner.Parent = boostButton
    
    -- Boost connection that works even when carrying brainrot
    local function updateBoost()
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("Humanoid") then
            if boostActive then
                char.Humanoid.WalkSpeed = 16 * 1.87 -- 87% boost
                boostButton.Text = "BOOST: ON"
                boostButton.BackgroundColor3 = Color3.fromRGB(200, 120, 70)
            else
                char.Humanoid.WalkSpeed = 16
                boostButton.Text = "BOOST: OFF"
                boostButton.BackgroundColor3 = Color3.fromRGB(70, 120, 200)
            end
        end
    end
    
    -- Keep updating even when carrying items
    local boostConnection
    boostConnection = RunService.Heartbeat:Connect(function()
        pcall(updateBoost)
    end)
    
    boostButton.MouseButton1Click:Connect(function()
        boostActive = not boostActive
        updateBoost()
    end)
    
    -- Clean up when GUI is destroyed
    boostGui.Destroying:Connect(function()
        boostConnection:Disconnect()
    end)
end

-- Character setup
local function setupCharacter()
    repeat task.wait(0.1) until LocalPlayer.Character
    repeat task.wait(0.1) until LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    
    -- Reapply ESP if needed
    if espEnabled then
        for _, player in pairs(Players:GetPlayers()) do
            if player.Character then
                createESP(player)
            end
        end
    end
    
    -- Reapply boost if needed
    if boostActive then
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("Humanoid") then
            char.Humanoid.WalkSpeed = 16 * 1.87
        end
    end
end

if LocalPlayer.Character then
    setupCharacter()
end
LocalPlayer.CharacterAdded:Connect(setupCharacter)

-- Initialize anti-kick
pcall(antiKick)

-- Setup infinite jump
setupInfiniteJump()

-- Create UI with multiple tabs
local Window = Rayfield:CreateWindow({
    Name = "Brainrot Steal Hub",
    LoadingTitle = "Loading Steal Script...",
    LoadingSubtitle = "Instant steal features",
    ConfigurationSaving = {Enabled = false},
    Discord = {Enabled = false},
    KeySystem = false
})

-- Main Tab
local MainTab = Window:CreateTab("Main", 4483362458)

-- Combat Tab
local CombatTab = Window:CreateTab("Combat", 4483362458)

-- ESP Tab
local ESPTab = Window:CreateTab("ESP", 4483362458)

-- GUI Tab
local GUITab = Window:CreateTab("GUI", 4483362458)

-- Boost Tab
local BoostTab = Window:CreateTab("Boost", 4483362458)

-- Main Tab Features
MainTab:CreateSection("Utilities")

MainTab:CreateButton({
    Name = "Remove All Walls (Permanent)",
    Callback = function()
        removeWalls()
    end
})

MainTab:CreateToggle({
    Name = "Base Protection Bypass",
    Default = true,
    Callback = function(value)
        Rayfield:Notify({
            Title = "Base Protection",
            Content = value and "ON - Base protected" or "OFF - Base vulnerable",
            Duration = 2,
            Image = 4483362458
        })
    end
})

-- Combat Tab Features
CombatTab:CreateToggle({
    Name = "God Mode (No Hit/No Fall)",
    Default = false,
    Callback = function(value)
        toggleGodMode()
        Rayfield:Notify({
            Title = "God Mode",
            Content = value and "ON - Invincible" or "OFF",
            Duration = 1.5,
            Image = 4483362458
        })
    end
})

CombatTab:CreateToggle({
    Name = "Instant Kill Aura (No Hold)",
    Default = false,
    Callback = function(value)
        if value then
            startKillAura()
            Rayfield:Notify({
                Title = "Kill Aura",
                Content = "Activated - Distance: " .. killAuraDistance .. " studs",
                Duration = 1.5,
                Image = 4483362458
            })
        else
            stopKillAura()
            Rayfield:Notify({
                Title = "Kill Aura",
                Content = "Deactivated",
                Duration = 1.5,
                Image = 4483362458
            })
        end
    end
})

CombatTab:CreateSlider({
    Name = "Kill Aura Distance",
    Range = {10, 100},
    Increment = 5,
    Suffix = "studs",
    CurrentValue = 50,
    Flag = "KillAuraDistance",
    Callback = function(Value)
        killAuraDistance = Value
    end,
})

CombatTab:CreateToggle({
    Name = "Infinite Jump",
    Default = false,
    Callback = function(value)
        infiniteJump = value
        Rayfield:Notify({
            Title = "Infinite Jump",
            Content = value and "ON - Infinite jumps active" or "OFF",
            Duration = 2,
            Image = 4483362458
        })
    end
})

-- ESP Tab Features
ESPTab:CreateToggle({
    Name = "ESP Players",
    Default = false,
    Callback = function(value)
        toggleESP()
        Rayfield:Notify({
            Title = "ESP",
            Content = value and "Activated" or "Deactivated",
            Duration = 1.5,
            Image = 4483362458
        })
    end
})

ESPTab:CreateColorPicker({
    Name = "ESP Color",
    Color = Color3.fromRGB(255, 0, 0),
    Callback = function(color)
        for player, highlight in pairs(espObjects) do
            if player ~= LocalPlayer then
                highlight.OutlineColor = color
                if player.Character and player.Character:FindFirstChild("Head") then
                    local head = player.Character.Head
                    if head:FindFirstChild("ESPTag") then
                        head.ESPTag.TextLabel.TextColor3 = color
                    end
                end
            end
        end
    end
})

ESPTab:CreateButton({
    Name = "Find Target Players",
    Callback = function()
        local found = false
        for _, playerName in ipairs(targetPlayers) do
            local player = Players:FindFirstChild(playerName)
            if player then
                found = true
                Rayfield:Notify({
                    Title = "Target Found!",
                    Content = playerName .. " is in the server",
                    Duration = 5,
                    Image = 4483362458
                })
                if espEnabled then
                    createESP(player)
                end
            end
        end
        
        if not found then
            Rayfield:Notify({
                Title = "Targets Not Found",
                Content = "No targets found, server hop?",
                Duration = 6,
                Image = 4483362458,
                Actions = {
                    Ignore = {
                        Name = "Later",
                        Callback = function() end
                    },
                    ServerHop = {
                        Name = "Hop Now",
                        Callback = function()
                            TeleportService:Teleport(game.PlaceId, LocalPlayer)
                        end
                    }
                }
            })
        end
    end
})

-- GUI Tab Features
GUITab:CreateButton({
    Name = "Sky Controls GUI",
    Callback = function()
        createSkyWidget()
        Rayfield:Notify({
            Title = "Sky GUI",
            Content = "Sky controls activated!",
            Duration = 2,
            Image = 4483362458
        })
    end
})

-- Boost Tab Features
BoostTab:CreateButton({
    Name = "Enable Speed Boost Overlay",
    Callback = function()
        createBoostGui()
        Rayfield:Notify({
            Title = "Boost Overlay",
            Content = "Boost overlay activated (87%)!",
            Duration = 2,
            Image = 4483362458
        })
    end
})

BoostTab:CreateToggle({
    Name = "Permanent 87% Boost",
    Default = false,
    Callback = function(value)
        boostActive = value
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("Humanoid") then
            if boostActive then
                char.Humanoid.WalkSpeed = 16 * 1.87
            else
                char.Humanoid.WalkSpeed = 16
            end
        end
    end
})

-- Success notification
Rayfield:Notify({
    Title = "Brainrot Steal Script Loaded",
    Content = "All features activated! Instant steal ready!",
    Duration = 3,
    Image = 4483362458
})
