-- Water Hub Script Ultra Avanzato per Roblox
-- GUI Premium con Design Moderno e FunzionalitÃ  Complete

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local Lighting = game:GetService("Lighting")
local Camera = workspace.CurrentCamera

local player = Players.LocalPlayer
local mouse = player:GetMouse()

-- Variabili globali
local waterHubGui
local connections = {}
local toggleStates = {}
local basePosition = nil
local originalWalkSpeed = 16
local originalJumpPower = 50

-- Stati delle funzionalitÃ 
local states = {
    infiniteJump = false,
    float = false,
    speedBoost = false,
    espPlayers = false,
    espNames = false,
    noclip = false,
    fly = false
}

-- Configurazioni
local config = {
    flySpeed = 50,
    walkSpeed = 100,
    espUpdateRate = 0.1,
    animationSpeed = 0.3
}

-- Funzione per creare effetti di gradiente
local function createGradient(parent, color1, color2, rotation)
    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, color1),
        ColorSequenceKeypoint.new(1, color2)
    })
    gradient.Rotation = rotation or 45
    gradient.Parent = parent
    return gradient
end

-- Funzione per creare ombre
local function createShadow(parent)
    local shadow = Instance.new("Frame")
    shadow.Name = "Shadow"
    shadow.Size = UDim2.new(1, 6, 1, 6)
    shadow.Position = UDim2.new(0, -3, 0, -3)
    shadow.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    shadow.BackgroundTransparency = 0.7
    shadow.ZIndex = parent.ZIndex - 1
    shadow.Parent = parent.Parent
    
    local shadowCorner = Instance.new("UICorner")
    shadowCorner.CornerRadius = UDim.new(0, 15)
    shadowCorner.Parent = shadow
    
    return shadow
end

-- Funzione per creare frame moderni con effetti
local function createModernFrame(parent, size, position, backgroundColor, cornerRadius, withShadow)
    local frame = Instance.new("Frame")
    frame.Size = size
    frame.Position = position
    frame.BackgroundColor3 = backgroundColor
    frame.BorderSizePixel = 0
    frame.ZIndex = 2
    frame.Parent = parent
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, cornerRadius or 15)
    corner.Parent = frame
    
    if withShadow then
        createShadow(frame)
    end
    
    return frame
end

-- Funzione per creare switch moderni con animazioni
local function createModernSwitch(parent, position, callback, initialState)
    local switchContainer = createModernFrame(parent, UDim2.new(0, 60, 0, 30), position, Color3.fromRGB(35, 35, 35), 15, false)
    
    local switchTrack = createModernFrame(switchContainer, UDim2.new(1, -4, 1, -4), UDim2.new(0, 2, 0, 2), Color3.fromRGB(60, 60, 60), 13, false)
    
    local switchButton = createModernFrame(switchTrack, UDim2.new(0, 22, 0, 22), UDim2.new(0, 2, 0, 2), Color3.fromRGB(220, 220, 220), 11, false)
    
    -- Gradiente per il track quando attivo
    local activeGradient = createGradient(switchTrack, Color3.fromRGB(0, 150, 255), Color3.fromRGB(0, 200, 255), 90)
    activeGradient.Enabled = false
    
    -- Gradiente per il button
    local buttonGradient = createGradient(switchButton, Color3.fromRGB(255, 255, 255), Color3.fromRGB(240, 240, 240), 45)
    
    local isOn = initialState or false
    
    local function updateSwitch(state, animate)
        isOn = state
        local targetPos = isOn and UDim2.new(1, -24, 0, 2) or UDim2.new(0, 2, 0, 2)
        local targetTrackColor = isOn and Color3.fromRGB(0, 170, 255) or Color3.fromRGB(60, 60, 60)
        
        activeGradient.Enabled = isOn
        
        if animate then
            local tweenInfo = TweenInfo.new(config.animationSpeed, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)
            TweenService:Create(switchButton, tweenInfo, {Position = targetPos}):Play()
            TweenService:Create(switchTrack, tweenInfo, {BackgroundColor3 = targetTrackColor}):Play()
        else
            switchButton.Position = targetPos
            switchTrack.BackgroundColor3 = targetTrackColor
        end
    end
    
    local function toggle()
        updateSwitch(not isOn, true)
        if callback then callback(isOn) end
    end
    
    switchContainer.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            toggle()
        end
    end)
    
    -- Inizializza lo stato
    updateSwitch(isOn, false)
    
    return switchContainer, updateSwitch, function() return isOn end
end

-- Funzione per rendere draggable con effetti fluidi
local function makeDraggable(gui)
    local dragToggle = false
    local dragStart = nil
    local startPos = nil
    
    local function updateInput(input)
        local delta = input.Position - dragStart
        local position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        gui.Position = position
    end
    
    gui.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragToggle = true
            dragStart = input.Position
            startPos = gui.Position
            
            -- Effetto di elevazione durante il drag
            TweenService:Create(gui, TweenInfo.new(0.2), {Size = gui.Size + UDim2.new(0, 4, 0, 4)}):Play()
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragToggle = false
                    -- Ritorna alle dimensioni normali
                    TweenService:Create(gui, TweenInfo.new(0.2), {Size = gui.Size - UDim2.new(0, 4, 0, 4)}):Play()
                end
            end)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement and dragToggle then
            updateInput(input)
        end
    end)
end

-- Funzioni di utilitÃ  per il character
local function getCharacter()
    return player.Character or player.CharacterAdded:Wait()
end

local function getHumanoid()
    local character = getCharacter()
    return character:WaitForChild("Humanoid")
end

local function getRootPart()
    local character = getCharacter()
    return character:WaitForChild("HumanoidRootPart")
end

-- Funzione Infinite Jump
local function toggleInfiniteJump(enabled)
    states.infiniteJump = enabled
    
    if connections.infiniteJump then
        connections.infiniteJump:Disconnect()
        connections.infiniteJump = nil
    end
    
    if enabled then
        connections.infiniteJump = UserInputService.JumpRequest:Connect(function()
            local humanoid = getHumanoid()
            if humanoid then
                humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end)
    end
end

-- Funzione Float
local function toggleFloat(enabled)
    states.float = enabled
    local rootPart = getRootPart()
    
    if connections.floatBody then
        connections.floatBody:Destroy()
        connections.floatBody = nil
    end
    
    if enabled and rootPart then
        local bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
        bodyVelocity.Velocity = Vector3.new(0, 0, 0)
        bodyVelocity.Parent = rootPart
        connections.floatBody = bodyVelocity
    end
end

-- Funzione Speed Boost
local function toggleSpeedBoost(enabled)
    states.speedBoost = enabled
    local humanoid = getHumanoid()
    
    if humanoid then
        humanoid.WalkSpeed = enabled and config.walkSpeed or originalWalkSpeed
    end
end

-- Funzione Noclip
local function toggleNoclip(enabled)
    states.noclip = enabled
    
    if connections.noclip then
        connections.noclip:Disconnect()
        connections.noclip = nil
    end
    
    if enabled then
        connections.noclip = RunService.Stepped:Connect(function()
            local character = getCharacter()
            if character then
                for _, part in pairs(character:GetDescendants()) do
                    if part:IsA("BasePart") and part.CanCollide then
                        part.CanCollide = false
                    end
                end
            end
        end)
    else
        local character = getCharacter()
        if character then
            for _, part in pairs(character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = true
                end
            end
        end
    end
end

-- Funzione Fly
local function toggleFly(enabled)
    states.fly = enabled
    local rootPart = getRootPart()
    
    if connections.flyBody then
        connections.flyBody:Destroy()
        connections.flyBody = nil
    end
    
    if connections.flyControl then
        connections.flyControl:Disconnect()
        connections.flyControl = nil
    end
    
    if enabled and rootPart then
        local bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
        bodyVelocity.Velocity = Vector3.new(0, 0, 0)
        bodyVelocity.Parent = rootPart
        connections.flyBody = bodyVelocity
        
        connections.flyControl = RunService.Heartbeat:Connect(function()
            local camera = workspace.CurrentCamera
            local moveVector = Vector3.new(0, 0, 0)
            
            if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                moveVector = moveVector + camera.CFrame.LookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                moveVector = moveVector - camera.CFrame.LookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                moveVector = moveVector - camera.CFrame.RightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                moveVector = moveVector + camera.CFrame.RightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                moveVector = moveVector + Vector3.new(0, 1, 0)
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
                moveVector = moveVector - Vector3.new(0, 1, 0)
            end
            
            bodyVelocity.Velocity = moveVector * config.flySpeed
        end)
    end
end

-- Funzioni ESP
local function createPlayerESP(targetPlayer)
    if not targetPlayer.Character or not targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
        return
    end
    
    local character = targetPlayer.Character
    local rootPart = character.HumanoidRootPart
    
    if rootPart:FindFirstChild("WaterHubESP") then
        return
    end
    
    local espGui = Instance.new("BillboardGui")
    espGui.Name = "WaterHubESP"
    espGui.Adornee = rootPart
    espGui.Size = UDim2.new(0, 100, 0, 50)
    espGui.StudsOffset = Vector3.new(0, 2, 0)
    espGui.AlwaysOnTop = true
    espGui.Parent = rootPart
    
    -- Box ESP
    if states.espPlayers then
        local espFrame = createModernFrame(espGui, UDim2.new(1, 0, 1, 0), UDim2.new(0, 0, 0, 0), Color3.fromRGB(255, 50, 50), 8, false)
        espFrame.BackgroundTransparency = 0.3
        espFrame.BorderSizePixel = 2
        espFrame.BorderColor3 = Color3.fromRGB(255, 255, 255)
        
        local espGradient = createGradient(espFrame, Color3.fromRGB(255, 0, 0), Color3.fromRGB(255, 100, 100), 45)
    end
    
    -- Name ESP
    if states.espNames then
        local nameLabel = Instance.new("TextLabel")
        nameLabel.Size = UDim2.new(1, 0, 0, 25)
        nameLabel.Position = UDim2.new(0, 0, 0, -30)
        nameLabel.BackgroundTransparency = 1
        nameLabel.Text = targetPlayer.Name
        nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        nameLabel.TextScaled = true
        nameLabel.Font = Enum.Font.SourceSansBold
        nameLabel.TextStrokeTransparency = 0
        nameLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
        nameLabel.Parent = espGui
    end
end

local function toggleESP(espType, enabled)
    if espType == "players" then
        states.espPlayers = enabled
    elseif espType == "names" then
        states.espNames = enabled
    end
    
    -- Rimuovi tutti gli ESP esistenti
    for _, targetPlayer in pairs(Players:GetPlayers()) do
        if targetPlayer ~= player and targetPlayer.Character then
            local esp = targetPlayer.Character:FindFirstChild("HumanoidRootPart"):FindFirstChild("WaterHubESP")
            if esp then
                esp:Destroy()
            end
        end
    end
    
    -- Disconnetti la connessione esistente
    if connections.espUpdate then
        connections.espUpdate:Disconnect()
        connections.espUpdate = nil
    end
    
    -- Se almeno uno Ã¨ abilitato, avvia l'aggiornamento
    if states.espPlayers or states.espNames then
        connections.espUpdate = RunService.Heartbeat:Connect(function()
            for _, targetPlayer in pairs(Players:GetPlayers()) do
                if targetPlayer ~= player then
                    createPlayerESP(targetPlayer)
                end
            end
        end)
    end
end

-- Funzione per creare pulsanti moderni
local function createModernButton(parent, size, position, text, color, callback)
    local button = createModernFrame(parent, size, position, color, 12, true)
    
    local gradient = createGradient(button, color, Color3.new(color.R * 0.8, color.G * 0.8, color.B * 0.8), 45)
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextScaled = true
    label.Font = Enum.Font.SourceSansBold
    label.Parent = button
    
    -- Effetti hover
    button.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            TweenService:Create(button, TweenInfo.new(0.1), {Size = size - UDim2.new(0, 4, 0, 4)}):Play()
            if callback then callback() end
        elseif input.UserInputType == Enum.UserInputType.MouseMovement then
            TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = Color3.new(color.R * 1.2, color.G * 1.2, color.B * 1.2)}):Play()
        end
    end)
    
    button.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            TweenService:Create(button, TweenInfo.new(0.1), {Size = size}):Play()
        elseif input.UserInputType == Enum.UserInputType.MouseMovement then
            TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = color}):Play()
        end
    end)
    
    return button
end

-- Creazione GUI principale
local function createMainGui()
    waterHubGui = Instance.new("ScreenGui")
    waterHubGui.Name = "WaterHubUltra"
    waterHubGui.Parent = CoreGui
    waterHubGui.ResetOnSpawn = false
    
    -- Frame principale con effetti avanzati
    local mainFrame = createModernFrame(waterHubGui, UDim2.new(0, 450, 0, 400), UDim2.new(0.5, -225, 0.5, -200), Color3.fromRGB(25, 25, 25), 20, true)
    mainFrame.BackgroundTransparency = 0.05
    makeDraggable(mainFrame)
    
    -- Gradiente principale
    local mainGradient = createGradient(mainFrame, Color3.fromRGB(30, 30, 30), Color3.fromRGB(15, 15, 15), 135)
    
    -- Header con design premium
    local header = createModernFrame(mainFrame, UDim2.new(1, 0, 0, 50), UDim2.new(0, 0, 0, 0), Color3.fromRGB(20, 20, 20), 20, false)
    local headerGradient = createGradient(header, Color3.fromRGB(0, 150, 255), Color3.fromRGB(0, 100, 200), 90)
    
    -- Titolo con effetti
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(0, 250, 1, 0)
    title.Position = UDim2.new(0, 15, 0, 0)
    title.BackgroundTransparency = 1
    title.Text = "ðŸ’§ WATER HUB ULTRA"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextScaled = true
    title.Font = Enum.Font.SourceSansBold
    title.TextStrokeTransparency = 0.5
    title.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    title.Parent = header
    
    -- Pulsanti header
    local minimizeBtn = createModernButton(header, UDim2.new(0, 35, 0, 30), UDim2.new(1, -80, 0, 10), "âž–", Color3.fromRGB(255, 193, 7), function()
        local isVisible = mainFrame.Visible
        mainFrame.Visible = not isVisible
        if not isVisible then
            TweenService:Create(mainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back), {Size = UDim2.new(0, 450, 0, 400)}):Play()
        end
    end)
    
    local closeBtn = createModernButton(header, UDim2.new(0, 35, 0, 30), UDim2.new(1, -40, 0, 10), "âŒ", Color3.fromRGB(220, 53, 69), function()
        TweenService:Create(mainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back), {Size = UDim2.new(0, 0, 0, 0)}):Play()
        wait(0.3)
        waterHubGui:Destroy()
    end)
    
    -- Sistema di tab migliorato
    local tabsFrame = createModernFrame(mainFrame, UDim2.new(1, -20, 0, 45), UDim2.new(0, 10, 0, 60), Color3.fromRGB(35, 35, 35), 15, false)
    
    local tabs = {"Main", "Visual", "Misc", "Server"}
    local tabButtons = {}
    local contentFrames = {}
    local activeTab = 1
    
    for i, tabName in ipairs(tabs) do
        local tabBtn = createModernFrame(tabsFrame, UDim2.new(0.25, -3, 1, -6), UDim2.new((i-1) * 0.25, 3, 0, 3), Color3.fromRGB(45, 45, 45), 12, false)
        
        local tabLabel = Instance.new("TextLabel")
        tabLabel.Size = UDim2.new(1, 0, 1, 0)
        tabLabel.BackgroundTransparency = 1
        tabLabel.Text = tabName
        tabLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
        tabLabel.TextScaled = true
        tabLabel.Font = Enum.Font.SourceSansBold
        tabLabel.Parent = tabBtn
        
        tabButtons[i] = {frame = tabBtn, label = tabLabel}
        
        -- Content frame
        local contentFrame = createModernFrame(mainFrame, UDim2.new(1, -20, 0, 270), UDim2.new(0, 10, 0, 115), Color3.fromRGB(30, 30, 30), 15, false)
        contentFrame.Visible = (i == 1)
        contentFrames[i] = contentFrame
        
        -- Tab click handler
        tabBtn.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                -- Deseleziona tutti i tab
                for j, tab in ipairs(tabButtons) do
                    contentFrames[j].Visible = false
                    tab.label.TextColor3 = Color3.fromRGB(180, 180, 180)
                    tab.frame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
                end
                
                -- Seleziona il tab corrente
                contentFrame.Visible = true
                tabLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
                tabBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
                activeTab = i
            end
        end)
    end
    
    -- Seleziona il primo tab di default
    tabButtons[1].label.TextColor3 = Color3.fromRGB(255, 255, 255)
    tabButtons[1].frame.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
    
    -- CONTENUTO TAB MAIN
    local mainContent = contentFrames[1]
    
    -- Infinite Jump
    local ijLabel = Instance.new("TextLabel")
    ijLabel.Size = UDim2.new(0, 250, 0, 35)
    ijLabel.Position = UDim2.new(0, 20, 0, 20)
    ijLabel.BackgroundTransparency = 1
    ijLabel.Text = "ðŸ¦˜ Infinite Jump"
    ijLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    ijLabel.TextScaled = true
    ijLabel.Font = Enum.Font.SourceSansBold
    ijLabel.TextXAlignment = Enum.TextXAlignment.Left
    ijLabel.Parent = mainContent
    
    local ijSwitch = createModernSwitch(mainContent, UDim2.new(1, -80, 0, 25), function(enabled)
        toggleInfiniteJump(enabled)
    end)
    
    -- Float
    local floatLabel = Instance.new("TextLabel")
    floatLabel.Size = UDim2.new(0, 250, 0, 35)
    floatLabel.Position = UDim2.new(0, 20, 0, 65)
    floatLabel.BackgroundTransparency = 1
    floatLabel.Text = "ðŸŽˆ Float"
    floatLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    floatLabel.TextScaled = true
    floatLabel.Font = Enum.Font.SourceSansBold
    floatLabel.TextXAlignment = Enum.TextXAlignment.Left
    floatLabel.Parent = mainContent
    
    local floatSwitch = createModernSwitch(mainContent, UDim2.new(1, -80, 0, 70), function(enabled)
        toggleFloat(enabled)
    end)
    
    -- Noclip
    local noclipLabel = Instance.new("TextLabel")
    noclipLabel.Size = UDim2.new(0, 250, 0, 35)
    noclipLabel.Position = UDim2.new(0, 20, 0, 110)
    noclipLabel.BackgroundTransparency = 1
    noclipLabel.Text = "ðŸ‘» Noclip"
    noclipLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    noclipLabel.TextScaled = true
    noclipLabel.Font = Enum.Font.SourceSansBold
    noclipLabel.TextXAlignment = Enum.TextXAlignment.Left
    noclipLabel.Parent = mainContent
    
    local noclipSwitch = createModernSwitch(mainContent, UDim2.new(1, -80, 0, 115), function(enabled)
        toggleNoclip(enabled)
    end)
    
    -- Fly
    local flyLabel = Instance.new("TextLabel")
    flyLabel.Size = UDim2.new(0, 250, 0, 35)
    flyLabel.Position = UDim2.new(0, 20, 0, 155)
    flyLabel.BackgroundTransparency = 1
    flyLabel.Text = "âœˆï¸ Fly (WASD + Space/Shift)"
    flyLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    flyLabel.TextScaled = true
    flyLabel.Font = Enum.Font.SourceSansBold
    flyLabel.TextXAlignment = Enum.TextXAlignment.Left
    flyLabel.Parent = mainContent
    
    local flySwitch = createModernSwitch(mainContent, UDim2.new(1, -80, 0, 160), function(enabled)
        toggleFly(enabled)
    end)
    
    -- Speed Boost
    local speedLabel = Instance.new("TextLabel")
    speedLabel.Size = UDim2.new(0, 250, 0, 35)
    speedLabel.Position = UDim2.new(0, 20, 0, 200)
    speedLabel.BackgroundTransparency = 1
    speedLabel.Text = "âš¡ Speed Boost"
    speedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    speedLabel.TextScaled = true
    speedLabel.Font = Enum.Font.SourceSansBold
    speedLabel.TextXAlignment = Enum.TextXAlignment.Left
    speedLabel.Parent = mainContent
    
    local speedSwitch = createModernSwitch(mainContent, UDim2.new(1, -80, 0, 205), function(enabled)
        toggleSpeedBoost(enabled)
    end)
    
    -- Teleport Button
    createModernButton(mainContent, UDim2.new(0, 180, 0, 35), UDim2.new(0, 230, 0, 25), "ðŸš€ Teleport Menu", Color3.fromRGB(138, 43, 226), function()
        createTeleportGui()
    end)
    
    -- CONTENUTO TAB VISUAL
    local visualContent = contentFrames[2]
    
    -- ESP Player
    local espLabel = Instance.new("TextLabel")
    espLabel.Size = UDim2.new(0, 250, 0, 35)
    espLabel.Position = UDim2.new(0, 20, 0, 20)
    espLabel.BackgroundTransparency = 1
    espLabel.Text = "ðŸ‘ï¸ ESP Player"
    espLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    espLabel.TextScaled = true
    espLabel.Font = Enum.Font.SourceSansBold
    espLabel.TextXAlignment = Enum.TextXAlignment.Left
    espLabel.Parent = visualContent
    
    local espSwitch = createModernSwitch(visualContent, UDim2.new(1, -80, 0, 25), function(enabled)
        toggleESP("players", enabled)
    end)
    
    -- ESP Names
    local espNameLabel = Instance.new("TextLabel")
    espNameLabel.Size = UDim2.new(0, 250, 0, 35)
    espNameLabel.Position = UDim2.new(0, 20, 0, 70)
    espNameLabel.BackgroundTransparency = 1
    espNameLabel.Text = "ðŸ·ï¸ ESP Names"
    espNameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    espNameLabel.TextScaled = true
    espNameLabel.Font = Enum.Font.SourceSansBold
    espNameLabel.TextXAlignment = Enum.TextXAlignment.Left
    espNameLabel.Parent = visualContent
    
    local espNameSwitch = createModernSwitch(visualContent, UDim2.new(1, -80, 0, 75), function(enabled)
        toggleESP("names", enabled)
    end)
    
    -- CONTENUTO TAB MISC
    local miscContent = contentFrames[3]
    
    local buyLabel = Instance.new("TextLabel")
    buyLabel.Size = UDim2.new(1, -20, 0, 40)
    buyLabel.Position = UDim2.new(0, 10, 0, 20)
    buyLabel.BackgroundTransparency = 1
    buyLabel.Text = "ðŸ’° More Features Coming Soon..."
    buyLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    buyLabel.TextScaled = true
    buyLabel.Font = Enum.Font.SourceSansItalic
    buyLabel.Parent = miscContent
    
    -- Auto Steal Button
    createModernButton(miscContent, UDim2.new(0, 250, 0, 45), UDim2.new(0, 20, 0, 80), "ðŸ”¥ Auto Steal System", Color3.fromRGB(220, 53, 69), function()
        createAutoStealGui()
    end)
end

-- GUI Teleport migliorata
function createTeleportGui()
    local tpGui = Instance.new("ScreenGui")
    tpGui.Name = "TeleportGui"
    tpGui.Parent = CoreGui
    
    local tpFrame = createModernFrame(tpGui, UDim2.new(0, 250, 0, 150), UDim2.new(0.5, -125, 0.3, 0), Color3.fromRGB(25, 25, 25), 18, true)
    tpFrame.BackgroundTransparency = 0.05
    makeDraggable(tpFrame)
    
    local tpGradient = createGradient(tpFrame, Color3.fromRGB(30, 30, 30), Color3.fromRGB(15, 15, 15), 135)
    
    local tpHeader = createModernFrame(tpFrame, UDim2.new(1, 0, 0, 40), UDim2.new(0, 0, 0, 0), Color3.fromRGB(138, 43, 226), 18, false)
    local headerGrad = createGradient(tpHeader, Color3.fromRGB(138, 43, 226), Color3.fromRGB(100, 20, 180), 90)
    
    local tpTitle = Instance.new("TextLabel")
    tpTitle.Size = UDim2.new(1, -50, 1, 0)
    tpTitle.Position = UDim2.new(0, 15, 0, 0)
    tpTitle.BackgroundTransparency = 1
    tpTitle.Text = "ðŸš€ Teleport Control"
    tpTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
    tpTitle.TextScaled = true
    tpTitle.Font = Enum.Font.SourceSansBold
    tpTitle.Parent = tpHeader
    
    local closeTPBtn = createModernButton(tpHeader, UDim2.new(0, 30, 0, 30), UDim2.new(1, -35, 0, 5), "âŒ", Color3.fromRGB(220, 53, 69), function()
        tpGui:Destroy()
    end)
    
    createModernButton(tpFrame, UDim2.new(0, 100, 0, 40), UDim2.new(0, 20, 0, 60), "â¬†ï¸ UP (+156)", Color3.fromRGB(40, 167, 69), function()
        local rootPart = getRootPart()
        if rootPart then
            rootPart.CFrame = rootPart.CFrame + Vector3.new(0, 156, 0)
        end
    end)
    
    createModernButton(tpFrame, UDim2.new(0, 100, 0, 40), UDim2.new(0, 130, 0, 60), "â¬‡ï¸ DOWN (-50)", Color3.fromRGB(220, 53, 69), function()
        local rootPart = getRootPart()
        if rootPart then
            rootPart.CFrame = rootPart.CFrame + Vector3.new(0, -50, 0)
        end
    end)
end

-- Auto Steal GUI migliorata
function createAutoStealGui()
    local stealGui = Instance.new("ScreenGui")
    stealGui.Name = "AutoStealGui"
    stealGui.Parent = CoreGui
    
    local stealFrame = createModernFrame(stealGui, UDim2.new(0, 300, 0, 180), UDim2.new(0.5, -150, 0.4, 0), Color3.fromRGB(25, 25, 25), 18, true)
    stealFrame.BackgroundTransparency = 0.05
    makeDraggable(stealFrame)
    
    local stealGradient = createGradient(stealFrame, Color3.fromRGB(30, 30, 30), Color3.fromRGB(15, 15, 15), 135)
    
    local stealHeader = createModernFrame(stealFrame, UDim2.new(1, 0, 0, 40), UDim2.new(0, 0, 0, 0), Color3.fromRGB(220, 53, 69), 18, false)
    local headerGrad = createGradient(stealHeader, Color3.fromRGB(220, 53, 69), Color3.fromRGB(180, 20, 40), 90)
    
    local stealTitle = Instance.new("TextLabel")
    stealTitle.Size = UDim2.new(1, -50, 1, 0)
    stealTitle.Position = UDim2.new(0, 15, 0, 0)
    stealTitle.BackgroundTransparency = 1
    stealTitle.Text = "ðŸ”‘ Auto Steal System"
    stealTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
    stealTitle.TextScaled = true
    stealTitle.Font = Enum.Font.SourceSansBold
    stealTitle.Parent = stealHeader
    
    local keyBox = createModernFrame(stealFrame, UDim2.new(1, -40, 0, 35), UDim2.new(0, 20, 0, 60), Color3.fromRGB(45, 45, 45), 12, false)
    
    local keyInput = Instance.new("TextBox")
    keyInput.Size = UDim2.new(1, -10, 1, 0)
    keyInput.Position = UDim2.new(0, 5, 0, 0)
    keyInput.BackgroundTransparency = 1
    keyInput.Text = "Enter Key Here..."
    keyInput.TextColor3 = Color3.fromRGB(200, 200, 200)
    keyInput.TextScaled = true
    keyInput.Font = Enum.Font.SourceSans
    keyInput.Parent = keyBox
    
    createModernButton(stealFrame, UDim2.new(0, 120, 0, 35), UDim2.new(0, 20, 0, 110), "ðŸ“º Subscribe", Color3.fromRGB(255, 0, 0), function()
        -- Simulazione subscribe
    end)
    
    createModernButton(stealFrame, UDim2.new(0, 120, 0, 35), UDim2.new(0, 150, 0, 110), "âœ… Enter", Color3.fromRGB(40, 167, 69), function()
        stealGui:Destroy()
        createBaseGui()
    end)
end

-- Base GUI migliorata
function createBaseGui()
    local baseGui = Instance.new("ScreenGui")
    baseGui.Name = "BaseGui"
    baseGui.Parent = CoreGui
    
    local baseFrame = createModernFrame(baseGui, UDim2.new(0, 280, 0, 160), UDim2.new(0.7, 0, 0.3, 0), Color3.fromRGB(25, 25, 25), 18, true)
    baseFrame.BackgroundTransparency = 0.05
    makeDraggable(baseFrame)
    
    local baseGradient = createGradient(baseFrame, Color3.fromRGB(30, 30, 30), Color3.fromRGB(15, 15, 15), 135)
    
    local baseHeader = createModernFrame(baseFrame, UDim2.new(1, 0, 0, 40), UDim2.new(0, 0, 0, 0), Color3.fromRGB(0, 123, 255), 18, false)
    local headerGrad = createGradient(baseHeader, Color3.fromRGB(0, 123, 255), Color3.fromRGB(0, 80, 200), 90)
    
    local baseTitle = Instance.new("TextLabel")
    baseTitle.Size = UDim2.new(1, -50, 1, 0)
    baseTitle.Position = UDim2.new(0, 15, 0, 0)
    baseTitle.BackgroundTransparency = 1
    baseTitle.Text = "ðŸ  Base Control System"
    baseTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
    baseTitle.TextScaled = true
    baseTitle.Font = Enum.Font.SourceSansBold
    baseTitle.Parent = baseHeader
    
    createModernButton(baseFrame, UDim2.new(1, -40, 0, 40), UDim2.new(0, 20, 0, 60), "ðŸ“ Set Current Position as Base", Color3.fromRGB(255, 193, 7), function()
        local rootPart = getRootPart()
        if rootPart then
            basePosition = rootPart.Position
            local button = baseFrame:FindFirstChild("SetBaseButton")
            if button then button.Text = "âœ… Base Position Saved!" end
            wait(2)
            if button then button.Text = "ðŸ“ Set Current Position as Base" end
        end
    end)
    
    createModernButton(baseFrame, UDim2.new(1, -40, 0, 40), UDim2.new(0, 20, 0, 110), "âœˆï¸ Fly to Base (Auto Mode)", Color3.fromRGB(0, 200, 255), function()
        if basePosition then
            flyToBase()
            baseGui:Destroy()
        end
    end)
end

-- Fly to Base function migliorata
function flyToBase()
    local rootPart = getRootPart()
    if not rootPart or not basePosition then return end
    
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
    bodyVelocity.Parent = rootPart
    
    local bodyAngularVelocity = Instance.new("BodyAngularVelocity")
    bodyAngularVelocity.MaxTorque = Vector3.new(4000, 4000, 4000)
    bodyAngularVelocity.AngularVelocity = Vector3.new(0, 0, 0)
    bodyAngularVelocity.Parent = rootPart
    
    -- Posizione target a 165 di altezza sopra la base
    local targetPosition = Vector3.new(basePosition.X, basePosition.Y + 165, basePosition.Z)
    
    -- Orienta il personaggio all'indietro
    rootPart.CFrame = CFrame.lookAt(rootPart.Position, rootPart.Position - rootPart.CFrame.LookVector)
    
    -- Calcola direzione e velocitÃ 
    local direction = (targetPosition - rootPart.Position).Unit
    bodyVelocity.Velocity = direction * config.flySpeed
    
    -- Monitora il volo
    spawn(function()
        repeat
            RunService.Heartbeat:Wait()
            local distance = (rootPart.Position - targetPosition).Magnitude
            if distance > 10 then
                direction = (targetPosition - rootPart.Position).Unit
                bodyVelocity.Velocity = direction * config.flySpeed
            end
        until (rootPart.Position - targetPosition).Magnitude < 10
        
        -- Ferma il volo
        bodyVelocity:Destroy()
        bodyAngularVelocity:Destroy()
        
        -- Crea pulsante down
        createDownButton()
    end)
end

-- Down Button migliorato
function createDownButton()
    local downGui = Instance.new("ScreenGui")
    downGui.Name = "DownGui"
    downGui.Parent = CoreGui
    
    local downBtn = createModernFrame(downGui, UDim2.new(0, 120, 0, 60), UDim2.new(0.5, -60, 0.8, 0), Color3.fromRGB(220, 53, 69), 20, true)
    downBtn.BackgroundTransparency = 0.1
    
    local downGradient = createGradient(downBtn, Color3.fromRGB(220, 53, 69), Color3.fromRGB(180, 20, 40), 45)
    
    local downLabel = Instance.new("TextLabel")
    downLabel.Size = UDim2.new(1, 0, 1, 0)
    downLabel.BackgroundTransparency = 1
    downLabel.Text = "â¬‡ï¸ LAND"
    downLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    downLabel.TextScaled = true
    downLabel.Font = Enum.Font.SourceSansBold
    downLabel.TextStrokeTransparency = 0.5
    downLabel.Parent = downBtn
    
    -- Animazione pulsante
    local pulseAnimation = TweenService:Create(downBtn, TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {Size = UDim2.new(0, 130, 0, 65)})
    pulseAnimation:Play()
    
    downBtn.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            local rootPart = getRootPart()
            if rootPart and basePosition then
                rootPart.CFrame = CFrame.new(basePosition)
                pulseAnimation:Cancel()
                downGui:Destroy()
            end
        end
    end)
end

-- Gestione cleanup
Players.PlayerRemoving:Connect(function(leavingPlayer)
    if leavingPlayer == player then
        for _, connection in pairs(connections) do
            if connection and typeof(connection) == "RBXScriptConnection" then
                connection:Disconnect()
            elseif connection and connection.Destroy then
                connection:Destroy()
            end
        end
    end
end)

-- Inizializzazione
spawn(function()
    wait(1) -- Attende che tutto sia caricato
    createMainGui()
    
    -- Animazione di entrata
    local mainFrame = waterHubGui:FindFirstChild("Frame")
    if mainFrame then
        mainFrame.Size = UDim2.new(0, 0, 0, 0)
        TweenService:Create(mainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.new(0, 450, 0, 400)}):Play()
    end
end)
