local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ProximityPromptService = game:GetService("ProximityPromptService")
local TweenService = game:GetService("TweenService")

local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()

local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/violin-suzutsuki/LinoriaLib/main/Library.lua"))()
local ThemeManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/violin-suzutsuki/LinoriaLib/main/ThemeManager.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/violin-suzutsuki/LinoriaLib/main/SaveManager.lua"))()

local Window = Library:CreateWindow({
    Title = "Admin Fun Tools",
    Center = true,
    AutoShow = true,
})

-- Tab principale
local MainTab = Window:AddTab("Main")
local MainBox = MainTab:AddLeftGroupbox("Funzioni Principali")

-- Air Jump
MainBox:AddToggle("AirJumpToggle", {
    Text = "Air Jump",
    Default = false,
    Tooltip = "Permette di saltare in aria",
})

MainBox:AddKeyPicker("AirJumpKey", {
    Default = "Space",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "Air Jump Key",
    NoUI = false,
})

-- Speed Boost
local SpeedBoostToggle = MainBox:AddToggle("SpeedBoostToggle", {
    Text = "Speed Boost",
    Default = false,
    Tooltip = "Attiva/disattiva boost velocità",
})

local SpeedBoostOverlay = MainBox:AddButton("", function() end)
SpeedBoostOverlay:SetText("")
SpeedBoostOverlay.Visible = false

SpeedBoostToggle:OnChanged(function()
    SpeedBoostOverlay.Visible = SpeedBoostToggle.Value
end)

-- Overlay Speed Boost
spawn(function()
    while wait(0.1) do
        if SpeedBoostOverlay.Visible then
            SpeedBoostOverlay:SetText(SpeedBoostActive and "ON" or "OFF")
            SpeedBoostOverlay:SetTextColor(SpeedBoostActive and Color3.new(0,1,0) or Color3.new(1,0,0))
        end
    end
end)

-- Float (Anti-Stun + Anti-AFK)
MainBox:AddToggle("FloatToggle", {
    Text = "Float Mode",
    Default = false,
    Tooltip = "Immunità ai colpi + Anti AFK",
})

-- Steal Helper
local StealHelperToggle = MainBox:AddToggle("StealHelperToggle", {
    Text = "Steal Helper",
    Default = false,
    Tooltip = "Riduce i tempi di raccolta",
})

-- GUI Steal Helper
local StealGUI = Instance.new("ScreenGui")
StealGUI.Name = "StealHelperGUI"
StealGUI.Parent = Player.PlayerGui

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 150, 0, 120)
Frame.Position = UDim2.new(0.5, -75, 0.7, -60)
Frame.BackgroundTransparency = 0.5
Frame.Visible = false
Frame.Parent = StealGUI

local UpButton = Instance.new("TextButton")
UpButton.Size = UDim2.new(0.8, 0, 0.3, 0)
UpButton.Position = UDim2.new(0.1, 0, 0.1, 0)
UpButton.Text = "UP ↑"
UpButton.Parent = Frame

local DownButton = Instance.new("TextButton")
DownButton.Size = UDim2.new(0.8, 0, 0.3, 0)
DownButton.Position = UDim2.new(0.1, 0, 0.6, 0)
DownButton.Text = "DOWN ↓"
DownButton.Parent = Frame

local CoordLabel = Instance.new("TextLabel")
CoordLabel.Size = UDim2.new(1, 0, 0.2, 0)
CoordLabel.Position = UDim2.new(0, 0, 0.9, 0)
CoordLabel.Text = "X:0 Y:0 Z:0"
CoordLabel.BackgroundTransparency = 1
CoordLabel.Parent = Frame

-- Funzionalità Steal Helper
StealHelperToggle:OnChanged(function()
    Frame.Visible = StealHelperToggle.Value
    
    if StealHelperToggle.Value then
        for _, prompt in ipairs(ProximityPromptService:GetPrompts()) do
            prompt.HoldDuration = 0
        end
    end
end)

-- Aggiorna coordinate
RunService.Heartbeat:Connect(function()
    if StealHelperToggle.Value and Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
        local pos = Player.Character.HumanoidRootPart.Position
        CoordLabel.Text = string.format("X:%.1f Y:%.1f Z:%.1f", pos.X, pos.Y, pos.Z)
    end
end)

-- Pulsanti UP/DOWN
UpButton.MouseButton1Click:Connect(function()
    if Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
        local tween = TweenService:Create(
            Player.Character.HumanoidRootPart,
            TweenInfo.new(0.5),
            {Position = Player.Character.HumanoidRootPart.Position + Vector3.new(0, 165, 0)}
        )
        tween:Play()
    end
end)

DownButton.MouseButton1Click:Connect(function()
    if Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
        local tween = TweenService:Create(
            Player.Character.HumanoidRootPart,
            TweenInfo.new(0.5),
            {Position = Player.Character.HumanoidRootPart.Position - Vector3.new(0, 50, 0)}
        )
        tween:Play()
    end
end)

-- Tab Visual
local VisualTab = Window:AddTab("Visual")
local VisualBox = VisualTab:AddLeftGroupbox("ESP Settings")

-- Player ESP
VisualBox:AddToggle("PlayerESPToggle", {
    Text = "Player ESP",
    Default = false,
    Tooltip = "Mostra i giocatori",
})

-- Base Timer ESP
VisualBox:AddToggle("TimerESPToggle", {
    Text = "Base Timer ESP",
    Default = false,
    Tooltip = "Mostra i timer delle basi",
})

-- Name ESP
VisualBox:AddToggle("NameESPToggle", {
    Text = "Name ESP",
    Default = false,
})

-- Tab Misc
local MiscTab = Window:AddTab("Misc")
local ShopBox = MiscTab:AddLeftGroupbox("Acquisti Shop")

-- Funzione acquisto generica
local function BuyItem(itemName)
    local success, msg = pcall(function()
        -- Simulazione ricerca nel Dex
        local found = false
        local itemPrice = 0
        
        -- Ricerca fittizia (da implementare con il vero Dex)
        for _, item in ipairs(workspace:GetDescendants()) do
            if item.Name:lower() == itemName:lower() then
                found = true
                itemPrice = item:GetAttribute("Price") or 1000
                break
            end
        end
        
        if not found then
            Library:Notify("Oggetto non trovato!", 3)
            return
        end
        
        -- Controllo soldi
        local playerMoney = Player:GetAttribute("Money") or 0
        if playerMoney >= itemPrice then
            -- Simulazione acquisto
            Player:SetAttribute("Money", playerMoney - itemPrice)
            Library:Notify("Acquistato: "..itemName, 5)
        else
            Library:Notify("Fondi insufficienti!", 3)
        end
    end)
    
    if not success then
        Library:Notify("Errore acquisto: "..msg, 5)
    end
end

-- Pulsanti acquisto
local shopItems = {
    "Invisibility Cloak",
    "Bee Launcher",
    "Medusa's Head",
    "Quantum Cloner",
    "Rainbowrath Sword"
}

for _, item in ipairs(shopItems) do
    ShopBox:AddButton(item, function()
        BuyItem(item)
    end)
end

-- Anti-AFK
local AntiAFK = MiscTab:AddLeftGroupbox("Utility")
AntiAFK:AddToggle("AntiAFKToggle", {
    Text = "Anti AFK",
    Default = false,
    Tooltip = "Previene il kick AFK",
})

-- Manager temi e salvataggi
ThemeManager:SetLibrary(Library)
SaveManager:SetLibrary(Library)
SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({})
ThemeManager:SetFolder("AdminFun")
SaveManager:SetFolder("AdminFun")
SaveManager:BuildConfigSection(Tabs)
ThemeManager:ApplyToTab(Tabs)
Library:Notify("Script caricato con successo!", 5)

-- Funzioni core
do
    -- Air Jump
    local function HandleAirJump()
        if MainBox:GetValue("AirJumpToggle") then
            -- Implementazione air jump
        end
    end
    
    -- Speed Boost
    local SpeedBoostActive = false
    SpeedBoostOverlay:SetCallback(function()
        SpeedBoostActive = not SpeedBoostActive
        -- Implementazione speed boost
    end)
    
    -- Float Mode
    MainBox:GetValueChangedSignal("FloatToggle"):Connect(function()
        if MainBox:GetValue("FloatToggle") then
            -- Implementazione anti-stun
            -- Implementazione anti-afk
        end
    end)
    
    -- Player ESP
    VisualBox:GetValueChangedSignal("PlayerESPToggle"):Connect(function()
        if VisualBox:GetValue("PlayerESPToggle") then
            -- Implementazione ESP giocatori
        end
    end)
    
    -- Anti AFK
    AntiAFK:GetValueChangedSignal("AntiAFKToggle"):Connect(function()
        if AntiAFK:GetValue("AntiAFKToggle") then
            -- Implementazione anti AFK
        end
    end)
end

-- Cleanup
Library.Unload = function()
    StealGUI:Destroy()
end
