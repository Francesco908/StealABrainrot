-- Water Hub Script - Ultimate Professional Edition v5.0
-- Versione ottimizzata con animazioni minime e particelle ridotte

-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local TeleportService = game:GetService("TeleportService")
local VirtualUser = game:GetService("VirtualUser")
local StarterGui = game:GetService("StarterGui")
local Workspace = game:GetService("Workspace")

-- Variabili
local player = Players.LocalPlayer
local camera = Workspace.CurrentCamera

-- Variabili globali
local waterHubGui = nil
local minimizedIcon = nil
local loadingGui = nil
local openGuis = {}
local connections = {}
local states = {
    infiniteJump = false,
    speedBoost = false,
    espPlayers = false,
    noclip = false,
    fly = false,
    godMode = true,
    antiKick = true,
    tpBase = false,
    stealHelper = false
}

-- Schema colori semplificato
local colors = {
    primary = Color3.fromRGB(0, 170, 255),
    secondary = Color3.fromRGB(0, 140, 210),
    background = Color3.fromRGB(25, 30, 40),
    surface = Color3.fromRGB(35, 40, 50),
    danger = Color3.fromRGB(220, 53, 69),
    warning = Color3.fromRGB(255, 193, 7),
    text = Color3.fromRGB(255, 255, 255)
}

-- Funzioni di utilit√†
local function getCharacter()
    return player.Character or player.CharacterAdded:Wait()
end

local function getHumanoid()
    local char = getCharacter()
    return char and char:FindFirstChildOfClass("Humanoid")
end

local function getRootPart()
    local char = getCharacter()
    return char and char:FindFirstChild("HumanoidRootPart")
end

-- Creazione UI
local function createFrame(parent, size, position, color, transparency)
    local frame = Instance.new("Frame")
    frame.Size = size
    frame.Position = position
    frame.BackgroundColor3 = color
    frame.BackgroundTransparency = transparency or 0
    frame.BorderSizePixel = 0
    frame.Parent = parent
    return frame
end

local function createButton(parent, size, position, color, text)
    local button = Instance.new("TextButton")
    button.Size = size
    button.Position = position
    button.BackgroundColor3 = color
    button.Text = text
    button.TextColor3 = colors.text
    button.TextScaled = true
    button.Font = Enum.Font.SourceSansBold
    button.BorderSizePixel = 0
    button.Parent = parent
    return button
end

local function createSwitch(parent, position, callback, initialState)
    local switchFrame = createFrame(parent, UDim2.new(0, 50, 0, 25), position, 
        initialState and colors.primary or Color3.fromRGB(80, 80, 80), 0)
    switchFrame.Active = true
    
    local switchButton = createFrame(switchFrame, UDim2.new(0, 21, 0, 21), 
        initialState and UDim2.new(1, -23, 0, 2) or UDim2.new(0, 2, 0, 2), 
        Color3.fromRGB(255, 255, 255), 0)
    
    local isOn = initialState or false
    
    local function toggle()
        isOn = not isOn
        switchButton.Position = isOn and UDim2.new(1, -23, 0, 2) or UDim2.new(0, 2, 0, 2)
        switchFrame.BackgroundColor3 = isOn and colors.primary or Color3.fromRGB(80, 80, 80)
        if callback then callback(isOn) end
    end
    
    switchFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            toggle()
        end
    end)
    
    return switchFrame, toggle
end

-- Funzionalit√† principali
local function toggleGodMode(enabled)
    states.godMode = enabled
    if connections.godMode then connections.godMode:Disconnect() end
    
    if enabled then
        connections.godMode = RunService.Heartbeat:Connect(function()
            local humanoid = getHumanoid()
            if humanoid then
                humanoid.Health = humanoid.MaxHealth
            end
        end)
    end
end

local function toggleInfiniteJump(enabled)
    states.infiniteJump = enabled
    if connections.infiniteJump then connections.infiniteJump:Disconnect() end
    
    if enabled then
        connections.infiniteJump = UserInputService.JumpRequest:Connect(function()
            local humanoid = getHumanoid()
            if humanoid then
                humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end)
    end
end

local function toggleSpeedBoost(enabled)
    states.speedBoost = enabled
    local humanoid = getHumanoid()
    
    if enabled and humanoid then
        humanoid.WalkSpeed = 25
    elseif humanoid then
        humanoid.WalkSpeed = 16
    end
end

local function toggleNoclip(enabled)
    states.noclip = enabled
    if connections.noclip then connections.noclip:Disconnect() end
    
    if enabled then
        connections.noclip = RunService.Stepped:Connect(function()
            local character = getCharacter()
            if character then
                for _, part in pairs(character:GetDescendants()) do
                    if part:IsA("BasePart") then part.CanCollide = false end
                end
            end
        end)
    end
end

local function teleportToPosition(position)
    local rootPart = getRootPart()
    if rootPart then
        rootPart.CFrame = CFrame.new(position)
        return true
    end
    return false
end

-- UI principale
createMinimizedIcon = function()
    if minimizedIcon then minimizedIcon:Destroy() end
    minimizedIcon = Instance.new("ScreenGui")
    minimizedIcon.Name = "WaterHubMinimized"
    minimizedIcon.Parent = CoreGui
    
    local waterDrop = Instance.new("ImageButton")
    waterDrop.Size = UDim2.new(0, 70, 0, 70)
    waterDrop.Position = UDim2.new(0, 20, 0, 20)
    waterDrop.BackgroundTransparency = 1
    waterDrop.Image = "rbxassetid://6034684930"
    waterDrop.ImageColor3 = colors.primary
    waterDrop.Parent = minimizedIcon
    
    waterDrop.MouseButton1Click:Connect(function()
        minimizedIcon:Destroy()
        createMainGui()
    end)
end

createMainGui = function()
    if waterHubGui then waterHubGui:Destroy() end
    waterHubGui = Instance.new("ScreenGui")
    waterHubGui.Name = "WaterHubMain"
    waterHubGui.Parent = CoreGui
    
    local mainFrame = createFrame(waterHubGui, UDim2.new(0, 350, 0, 400), UDim2.new(0.5, -175, 0.5, -200), 
        Color3.fromRGB(40, 45, 55), 0.15)
    
    local header = createFrame(mainFrame, UDim2.new(1, 0, 0, 40), UDim2.new(0, 0, 0, 0), colors.primary, 0)
    
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(0.6, 0, 1, 0)
    title.Position = UDim2.new(0, 15, 0, 0)
    title.BackgroundTransparency = 1
    title.Text = "üíß Water Hub v5"
    title.TextColor3 = colors.text
    title.TextScaled = true
    title.Font = Enum.Font.SourceSansBold
    title.Parent = header
    
    local minimizeBtn = createButton(header, UDim2.new(0, 30, 0, 30), UDim2.new(1, -70, 0.5, -15), 
        colors.warning, "‚àí")
    local closeBtn = createButton(header, UDim2.new(0, 30, 0, 30), UDim2.new(1, -35, 0.5, -15), 
        colors.danger, "√ó")
    
    local mainContent = createFrame(mainFrame, UDim2.new(1, -20, 1, -50), UDim2.new(0, 10, 0, 50), 
        colors.surface, 0.05)
    
    -- Funzionalit√† principali
    local yPos = 10
    local function addFeature(text, icon, callback, initialState)
        local container = Instance.new("Frame")
        container.Size = UDim2.new(1, -20, 0, 35)
        container.Position = UDim2.new(0, 10, 0, yPos)
        container.BackgroundTransparency = 1
        container.Parent = mainContent
        
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(1, -60, 1, 0)
        label.BackgroundTransparency = 1
        label.Text = icon .. " " .. text
        label.TextColor3 = colors.text
        label.TextScaled = true
        label.Font = Enum.Font.SourceSans
        label.Parent = container
        
        createSwitch(container, UDim2.new(1, -55, 0.5, -12.5), callback, initialState)
        yPos = yPos + 40
    end
    
    addFeature("God Mode", "üõ°Ô∏è", toggleGodMode, states.godMode)
    addFeature("Infinite Jump", "ü¶ò", toggleInfiniteJump, states.infiniteJump)
    addFeature("Speed Boost", "‚ö°", toggleSpeedBoost, states.speedBoost)
    addFeature("Noclip", "üëª", toggleNoclip, states.noclip)
    
    -- Bottoni server
    local rejoinBtn = createButton(mainFrame, UDim2.new(0.9, 0, 0, 40), UDim2.new(0.05, 0, 1, -50), 
        colors.primary, "Rejoin Server")
    rejoinBtn.MouseButton1Click:Connect(function() 
        TeleportService:Teleport(game.PlaceId, player) 
    end)
    
    local leaveBtn = createButton(mainFrame, UDim2.new(0.9, 0, 0, 40), UDim2.new(0.05, 0, 1, -100), 
        colors.danger, "Leave Game")
    leaveBtn.MouseButton1Click:Connect(function() 
        player:Kick("Left via Water Hub") 
    end)
    
    -- Animazioni di chiusura/minimizzazione
    minimizeBtn.MouseButton1Click:Connect(function()
        TweenService:Create(mainFrame, TweenInfo.new(0.3), {
            Size = UDim2.new(0, 70, 0, 70),
            Position = UDim2.new(0, 20, 0, 20)
        }):Play()
        wait(0.3)
        waterHubGui:Destroy()
        createMinimizedIcon()
    end)
    
    closeBtn.MouseButton1Click:Connect(function()
        TweenService:Create(mainFrame, TweenInfo.new(0.3), {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0.5, 0)
        }):Play()
        wait(0.3)
        waterHubGui:Destroy()
    end)
end

local function createLoadingScreen()
    loadingGui = Instance.new("ScreenGui")
    loadingGui.Name = "WaterHubLoading"
    loadingGui.Parent = CoreGui
    
    local bg = createFrame(loadingGui, UDim2.new(1, 0, 1, 0), UDim2.new(0, 0, 0, 0), colors.background, 0)
    
    -- Particelle ridotte (solo 5 invece di 10)
    for i = 1, 5 do
        local particle = Instance.new("Frame")
        particle.Size = UDim2.new(0, 5, 0, 5)
        particle.Position = UDim2.new(math.random(), 0, math.random(), 0)
        particle.BackgroundColor3 = colors.primary
        particle.Parent = bg
    end
    
    local loadingLabel = Instance.new("TextLabel")
    loadingLabel.Size = UDim2.new(0, 200, 0, 50)
    loadingLabel.Position = UDim2.new(0.5, -100, 0.5, -25)
    loadingLabel.BackgroundTransparency = 1
    loadingLabel.Text = "Loading Water Hub..."
    loadingLabel.TextColor3 = colors.text
    loadingLabel.TextScaled = true
    loadingLabel.Font = Enum.Font.SourceSansBold
    loadingLabel.Parent = bg
    
    wait(2)
    loadingGui:Destroy()
    createMainGui()
end

-- Avvio
createLoadingScreen()
