-- Water Hub Script per Roblox
-- GUI Avanzata con tutte le funzionalit√†

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local rootPart = character:WaitForChild("HumanoidRootPart")

-- Variabili globali
local waterHubGui
local connections = {}
local isNoclipEnabled = false
local isFlyEnabled = false
local isInfiniteJumpEnabled = false
local espEnabled = false
local espNameEnabled = false
local basePosition = nil
local flySpeed = 50

-- Funzione per creare GUI arrotondata
local function createRoundedFrame(parent, size, position, backgroundColor, cornerRadius)
    local frame = Instance.new("Frame")
    frame.Size = size
    frame.Position = position
    frame.BackgroundColor3 = backgroundColor
    frame.BorderSizePixel = 0
    frame.Parent = parent
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, cornerRadius or 12)
    corner.Parent = frame
    
    return frame
end

-- Funzione per creare switch
local function createSwitch(parent, position, callback)
    local switchFrame = createRoundedFrame(parent, UDim2.new(0, 50, 0, 25), position, Color3.fromRGB(60, 60, 60), 15)
    
    local switchButton = createRoundedFrame(switchFrame, UDim2.new(0, 20, 0, 20), UDim2.new(0, 2, 0, 2), Color3.fromRGB(200, 200, 200), 10)
    
    local isOn = false
    
    local function toggle()
        isOn = not isOn
        local targetPos = isOn and UDim2.new(0, 28, 0, 2) or UDim2.new(0, 2, 0, 2)
        local targetColor = isOn and Color3.fromRGB(0, 170, 255) or Color3.fromRGB(60, 60, 60)
        
        TweenService:Create(switchButton, TweenInfo.new(0.2), {Position = targetPos}):Play()
        TweenService:Create(switchFrame, TweenInfo.new(0.2), {BackgroundColor3 = targetColor}):Play()
        
        if callback then callback(isOn) end
    end
    
    switchFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            toggle()
        end
    end)
    
    return switchFrame, toggle
end

-- Funzione per rendere draggable
local function makeDraggable(gui)
    local dragToggle = nil
    local dragSpeed = 0.25
    local dragStart = nil
    local startPos = nil
    
    local function updateInput(input)
        local delta = input.Position - dragStart
        local position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        TweenService:Create(gui, TweenInfo.new(dragSpeed), {Position = position}):Play()
    end
    
    gui.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragToggle = true
            dragStart = input.Position
            startPos = gui.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragToggle = false
                end
            end)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement and dragToggle then
            updateInput(input)
        end
    end)
end

-- Funzioni principali
local function infiniteJump()
    connections.infiniteJump = UserInputService.JumpRequest:Connect(function()
        if isInfiniteJumpEnabled then
            humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end)
end

local function float()
    if not connections.float then
        local bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
        bodyVelocity.Velocity = Vector3.new(0, 0, 0)
        bodyVelocity.Parent = rootPart
        
        connections.float = bodyVelocity
    else
        connections.float:Destroy()
        connections.float = nil
    end
end

local function speedBoost(enabled)
    if enabled then
        humanoid.WalkSpeed = 100
    else
        humanoid.WalkSpeed = 16
    end
end

local function createESP()
    for _, targetPlayer in pairs(Players:GetPlayers()) do
        if targetPlayer ~= player and targetPlayer.Character then
            local character = targetPlayer.Character
            local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
            
            if humanoidRootPart and not humanoidRootPart:FindFirstChild("ESP") then
                local billboardGui = Instance.new("BillboardGui")
                billboardGui.Name = "ESP"
                billboardGui.Adornee = humanoidRootPart
                billboardGui.Size = UDim2.new(0, 100, 0, 50)
                billboardGui.StudsOffset = Vector3.new(0, 2, 0)
                billboardGui.Parent = humanoidRootPart
                
                local frame = Instance.new("Frame")
                frame.Size = UDim2.new(1, 0, 1, 0)
                frame.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
                frame.BackgroundTransparency = 0.5
                frame.BorderSizePixel = 2
                frame.BorderColor3 = Color3.fromRGB(255, 255, 255)
                frame.Parent = billboardGui
                
                if espNameEnabled then
                    local nameLabel = Instance.new("TextLabel")
                    nameLabel.Size = UDim2.new(1, 0, 0.5, 0)
                    nameLabel.BackgroundTransparency = 1
                    nameLabel.Text = targetPlayer.Name
                    nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
                    nameLabel.TextScaled = true
                    nameLabel.Font = Enum.Font.SourceSansBold
                    nameLabel.Parent = billboardGui
                end
            end
        end
    end
end

local function removeESP()
    for _, targetPlayer in pairs(Players:GetPlayers()) do
        if targetPlayer.Character then
            local esp = targetPlayer.Character:FindFirstChild("HumanoidRootPart"):FindFirstChild("ESP")
            if esp then esp:Destroy() end
        end
    end
end

-- Creazione GUI principale
local function createMainGui()
    waterHubGui = Instance.new("ScreenGui")
    waterHubGui.Name = "WaterHub"
    waterHubGui.Parent = CoreGui
    waterHubGui.ResetOnSpawn = false
    
    -- Frame principale
    local mainFrame = createRoundedFrame(waterHubGui, UDim2.new(0, 400, 0, 350), UDim2.new(0.5, -200, 0.5, -175), Color3.fromRGB(40, 40, 40), 15)
    mainFrame.BackgroundTransparency = 0.1
    makeDraggable(mainFrame)
    
    -- Header
    local header = createRoundedFrame(mainFrame, UDim2.new(1, 0, 0, 40), UDim2.new(0, 0, 0, 0), Color3.fromRGB(50, 50, 50), 15)
    
    -- Titolo
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(0, 200, 1, 0)
    title.Position = UDim2.new(0, 10, 0, 0)
    title.BackgroundTransparency = 1
    title.Text = "üíß Water Hub"
    title.TextColor3 = Color3.fromRGB(0, 170, 255)
    title.TextScaled = true
    title.Font = Enum.Font.SourceSansBold
    title.Parent = header
    
    -- Pulsante minimizza
    local minimizeBtn = Instance.new("TextButton")
    minimizeBtn.Size = UDim2.new(0, 30, 0, 25)
    minimizeBtn.Position = UDim2.new(1, -70, 0, 7)
    minimizeBtn.BackgroundColor3 = Color3.fromRGB(255, 200, 0)
    minimizeBtn.Text = "‚ûñ"
    minimizeBtn.TextScaled = true
    minimizeBtn.Font = Enum.Font.SourceSansBold
    minimizeBtn.Parent = header
    
    local corner1 = Instance.new("UICorner")
    corner1.CornerRadius = UDim.new(0, 8)
    corner1.Parent = minimizeBtn
    
    -- Pulsante chiudi
    local closeBtn = Instance.new("TextButton")
    closeBtn.Size = UDim2.new(0, 30, 0, 25)
    closeBtn.Position = UDim2.new(1, -35, 0, 7)
    closeBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
    closeBtn.Text = "‚ùå"
    closeBtn.TextScaled = true
    closeBtn.Font = Enum.Font.SourceSansBold
    closeBtn.Parent = header
    
    local corner2 = Instance.new("UICorner")
    corner2.CornerRadius = UDim.new(0, 8)
    corner2.Parent = closeBtn
    
    -- Tabs
    local tabsFrame = createRoundedFrame(mainFrame, UDim2.new(1, -20, 0, 40), UDim2.new(0, 10, 0, 50), Color3.fromRGB(35, 35, 35), 10)
    
    local tabs = {"Main", "Visual", "Misc", "Server"}
    local tabButtons = {}
    local contentFrames = {}
    
    for i, tabName in ipairs(tabs) do
        local tabBtn = Instance.new("TextButton")
        tabBtn.Size = UDim2.new(0.25, -5, 1, 0)
        tabBtn.Position = UDim2.new((i-1) * 0.25, 2, 0, 0)
        tabBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        tabBtn.Text = tabName
        tabBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
        tabBtn.TextScaled = true
        tabBtn.Font = Enum.Font.SourceSans
        tabBtn.Parent = tabsFrame
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = tabBtn
        
        tabButtons[i] = tabBtn
        
        -- Content frame per ogni tab
        local contentFrame = createRoundedFrame(mainFrame, UDim2.new(1, -20, 0, 220), UDim2.new(0, 10, 0, 100), Color3.fromRGB(45, 45, 45), 10)
        contentFrame.Visible = (i == 1)
        contentFrames[i] = contentFrame
    end
    
    -- Tab switching
    for i, btn in ipairs(tabButtons) do
        btn.MouseButton1Click:Connect(function()
            for j, frame in ipairs(contentFrames) do
                frame.Visible = (j == i)
            end
            for j, button in ipairs(tabButtons) do
                button.BackgroundColor3 = (j == i) and Color3.fromRGB(0, 170, 255) or Color3.fromRGB(60, 60, 60)
            end
        end)
    end
    
    -- MAIN TAB CONTENT
    local mainContent = contentFrames[1]
    
    -- Infinite Jump
    local ijLabel = Instance.new("TextLabel")
    ijLabel.Size = UDim2.new(0, 200, 0, 30)
    ijLabel.Position = UDim2.new(0, 20, 0, 20)
    ijLabel.BackgroundTransparency = 1
    ijLabel.Text = "ü¶ò Infinite Jump"
    ijLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    ijLabel.TextScaled = true
    ijLabel.Font = Enum.Font.SourceSans
    ijLabel.TextXAlignment = Enum.TextXAlignment.Left
    ijLabel.Parent = mainContent
    
    local ijSwitch = createSwitch(mainContent, UDim2.new(1, -70, 0, 25), function(enabled)
        isInfiniteJumpEnabled = enabled
        if enabled then
            infiniteJump()
        else
            if connections.infiniteJump then
                connections.infiniteJump:Disconnect()
            end
        end
    end)
    
    -- Float
    local floatLabel = Instance.new("TextLabel")
    floatLabel.Size = UDim2.new(0, 200, 0, 30)
    floatLabel.Position = UDim2.new(0, 20, 0, 60)
    floatLabel.BackgroundTransparency = 1
    floatLabel.Text = "üéà Float"
    floatLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    floatLabel.TextScaled = true
    floatLabel.Font = Enum.Font.SourceSans
    floatLabel.TextXAlignment = Enum.TextXAlignment.Left
    floatLabel.Parent = mainContent
    
    local floatSwitch = createSwitch(mainContent, UDim2.new(1, -70, 0, 65), function(enabled)
        float()
    end)
    
    -- Teleport
    local tpBtn = Instance.new("TextButton")
    tpBtn.Size = UDim2.new(0, 150, 0, 30)
    tpBtn.Position = UDim2.new(0, 20, 0, 100)
    tpBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
    tpBtn.Text = "üöÄ Teleport"
    tpBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    tpBtn.TextScaled = true
    tpBtn.Font = Enum.Font.SourceSansBold
    tpBtn.Parent = mainContent
    
    local tpCorner = Instance.new("UICorner")
    tpCorner.CornerRadius = UDim.new(0, 8)
    tpCorner.Parent = tpBtn
    
    -- Speed Boost
    local speedLabel = Instance.new("TextLabel")
    speedLabel.Size = UDim2.new(0, 200, 0, 30)
    speedLabel.Position = UDim2.new(0, 20, 0, 140)
    speedLabel.BackgroundTransparency = 1
    speedLabel.Text = "‚ö° Speed Boost"
    speedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    speedLabel.TextScaled = true
    speedLabel.Font = Enum.Font.SourceSans
    speedLabel.TextXAlignment = Enum.TextXAlignment.Left
    speedLabel.Parent = mainContent
    
    local speedSwitch = createSwitch(mainContent, UDim2.new(1, -70, 0, 145), function(enabled)
        speedBoost(enabled)
    end)
    
    -- VISUAL TAB CONTENT
    local visualContent = contentFrames[2]
    
    -- ESP Player
    local espLabel = Instance.new("TextLabel")
    espLabel.Size = UDim2.new(0, 200, 0, 30)
    espLabel.Position = UDim2.new(0, 20, 0, 20)
    espLabel.BackgroundTransparency = 1
    espLabel.Text = "üëÅÔ∏è ESP Player"
    espLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    espLabel.TextScaled = true
    espLabel.Font = Enum.Font.SourceSans
    espLabel.TextXAlignment = Enum.TextXAlignment.Left
    espLabel.Parent = visualContent
    
    local espSwitch = createSwitch(visualContent, UDim2.new(1, -70, 0, 25), function(enabled)
        espEnabled = enabled
        if enabled then
            createESP()
            connections.espUpdate = RunService.Heartbeat:Connect(createESP)
        else
            removeESP()
            if connections.espUpdate then
                connections.espUpdate:Disconnect()
            end
        end
    end)
    
    -- ESP Name
    local espNameLabel = Instance.new("TextLabel")
    espNameLabel.Size = UDim2.new(0, 200, 0, 30)
    espNameLabel.Position = UDim2.new(0, 20, 0, 60)
    espNameLabel.BackgroundTransparency = 1
    espNameLabel.Text = "üè∑Ô∏è ESP Name Player"
    espNameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    espNameLabel.TextScaled = true
    espNameLabel.Font = Enum.Font.SourceSans
    espNameLabel.TextXAlignment = Enum.TextXAlignment.Left
    espNameLabel.Parent = visualContent
    
    local espNameSwitch = createSwitch(visualContent, UDim2.new(1, -70, 0, 65), function(enabled)
        espNameEnabled = enabled
    end)
    
    -- MISC TAB CONTENT
    local miscContent = contentFrames[3]
    
    local buyLabel = Instance.new("TextLabel")
    buyLabel.Size = UDim2.new(1, -20, 0, 30)
    buyLabel.Position = UDim2.new(0, 10, 0, 20)
    buyLabel.BackgroundTransparency = 1
    buyLabel.Text = "üí∞ Buy soon..."
    buyLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
    buyLabel.TextScaled = true
    buyLabel.Font = Enum.Font.SourceSansItalic
    buyLabel.Parent = miscContent
    
    -- Auto Steal Button
    local autoStealBtn = Instance.new("TextButton")
    autoStealBtn.Size = UDim2.new(0, 200, 0, 40)
    autoStealBtn.Position = UDim2.new(0, 20, 0, 60)
    autoStealBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
    autoStealBtn.Text = "üî• Auto Steal"
    autoStealBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    autoStealBtn.TextScaled = true
    autoStealBtn.Font = Enum.Font.SourceSansBold
    autoStealBtn.Parent = miscContent
    
    local autoStealCorner = Instance.new("UICorner")
    autoStealCorner.CornerRadius = UDim.new(0, 10)
    autoStealCorner.Parent = autoStealBtn
    
    -- Event handlers
    closeBtn.MouseButton1Click:Connect(function()
        waterHubGui:Destroy()
    end)
    
    minimizeBtn.MouseButton1Click:Connect(function()
        mainFrame.Visible = not mainFrame.Visible
    end)
    
    -- Teleport GUI
    tpBtn.MouseButton1Click:Connect(function()
        createTeleportGui()
    end)
    
    -- Auto Steal GUI
    autoStealBtn.MouseButton1Click:Connect(function()
        createAutoStealGui()
    end)
end

-- GUI Teleport
function createTeleportGui()
    local tpGui = Instance.new("ScreenGui")
    tpGui.Name = "TeleportGui"
    tpGui.Parent = CoreGui
    
    local tpFrame = createRoundedFrame(tpGui, UDim2.new(0, 200, 0, 120), UDim2.new(0.5, -100, 0.3, 0), Color3.fromRGB(40, 40, 40), 12)
    tpFrame.BackgroundTransparency = 0.1
    makeDraggable(tpFrame)
    
    local tpTitle = Instance.new("TextLabel")
    tpTitle.Size = UDim2.new(1, -40, 0, 30)
    tpTitle.Position = UDim2.new(0, 10, 0, 5)
    tpTitle.BackgroundTransparency = 1
    tpTitle.Text = "üöÄ Teleport"
    tpTitle.TextColor3 = Color3.fromRGB(0, 170, 255)
    tpTitle.TextScaled = true
    tpTitle.Font = Enum.Font.SourceSansBold
    tpTitle.Parent = tpFrame
    
    local closeTPBtn = Instance.new("TextButton")
    closeTPBtn.Size = UDim2.new(0, 25, 0, 25)
    closeTPBtn.Position = UDim2.new(1, -30, 0, 5)
    closeTPBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
    closeTPBtn.Text = "‚ùå"
    closeTPBtn.TextScaled = true
    closeTPBtn.Parent = tpFrame
    
    local upBtn = Instance.new("TextButton")
    upBtn.Size = UDim2.new(0, 80, 0, 30)
    upBtn.Position = UDim2.new(0, 20, 0, 45)
    upBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
    upBtn.Text = "‚¨ÜÔ∏è UP"
    upBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    upBtn.TextScaled = true
    upBtn.Font = Enum.Font.SourceSansBold
    upBtn.Parent = tpFrame
    
    local downBtn = Instance.new("TextButton")
    downBtn.Size = UDim2.new(0, 80, 0, 30)
    downBtn.Position = UDim2.new(0, 110, 0, 45)
    downBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
    downBtn.Text = "‚¨áÔ∏è DOWN"
    downBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    downBtn.TextScaled = true
    downBtn.Font = Enum.Font.SourceSansBold
    downBtn.Parent = tpFrame
    
    -- Angoli arrotondati per tutti i pulsanti
    for _, btn in pairs({closeTPBtn, upBtn, downBtn}) do
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = btn
    end
    
    -- Eventi
    closeTPBtn.MouseButton1Click:Connect(function()
        tpGui:Destroy()
    end)
    
    upBtn.MouseButton1Click:Connect(function()
        rootPart.CFrame = rootPart.CFrame + Vector3.new(0, 156, 0)
    end)
    
    downBtn.MouseButton1Click:Connect(function()
        rootPart.CFrame = rootPart.CFrame + Vector3.new(0, -50, 0)
    end)
end

-- Auto Steal GUI
function createAutoStealGui()
    local stealGui = Instance.new("ScreenGui")
    stealGui.Name = "AutoStealGui"
    stealGui.Parent = CoreGui
    
    local stealFrame = createRoundedFrame(stealGui, UDim2.new(0, 250, 0, 150), UDim2.new(0.5, -125, 0.4, 0), Color3.fromRGB(40, 40, 40), 12)
    stealFrame.BackgroundTransparency = 0.1
    makeDraggable(stealFrame)
    
    local stealTitle = Instance.new("TextLabel")
    stealTitle.Size = UDim2.new(1, -40, 0, 30)
    stealTitle.Position = UDim2.new(0, 10, 0, 5)
    stealTitle.BackgroundTransparency = 1
    stealTitle.Text = "üîë Auto Steal Key"
    stealTitle.TextColor3 = Color3.fromRGB(255, 100, 100)
    stealTitle.TextScaled = true
    stealTitle.Font = Enum.Font.SourceSansBold
    stealTitle.Parent = stealFrame
    
    local keyBox = Instance.new("TextBox")
    keyBox.Size = UDim2.new(1, -20, 0, 30)
    keyBox.Position = UDim2.new(0, 10, 0, 40)
    keyBox.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    keyBox.Text = "Enter Key..."
    keyBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    keyBox.TextScaled = true
    keyBox.Font = Enum.Font.SourceSans
    keyBox.Parent = stealFrame
    
    local subscribeBtn = Instance.new("TextButton")
    subscribeBtn.Size = UDim2.new(0, 100, 0, 30)
    subscribeBtn.Position = UDim2.new(0, 10, 0, 80)
    subscribeBtn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    subscribeBtn.Text = "üì∫ Subscribe"
    subscribeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    subscribeBtn.TextScaled = true
    subscribeBtn.Font = Enum.Font.SourceSansBold
    subscribeBtn.Parent = stealFrame
    
    local enterBtn = Instance.new("TextButton")
    enterBtn.Size = UDim2.new(0, 100, 0, 30)
    enterBtn.Position = UDim2.new(0, 120, 0, 80)
    enterBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
    enterBtn.Text = "‚úÖ Enter"
    enterBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    enterBtn.TextScaled = true
    enterBtn.Font = Enum.Font.SourceSansBold
    enterBtn.Parent = stealFrame
    
    -- Angoli arrotondati
    for _, element in pairs({keyBox, subscribeBtn, enterBtn}) do
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = element
    end
    
    enterBtn.MouseButton1Click:Connect(function()
        stealGui:Destroy()
        createBaseGui()
    end)
end

-- Base GUI
function createBaseGui()
    local baseGui = Instance.new("ScreenGui")
    baseGui.Name = "BaseGui"
    baseGui.Parent = CoreGui
    
    local baseFrame = createRoundedFrame(baseGui, UDim2.new(0, 200, 0, 120), UDim2.new(0.7, 0, 0.3, 0), Color3.fromRGB(40, 40, 40), 12)
    baseFrame.BackgroundTransparency = 0.1
    makeDraggable(baseFrame)
    
    local baseTitle = Instance.new("TextLabel")
    baseTitle.Size = UDim2.new(1, -40, 0, 30)
    baseTitle.Position = UDim2.new(0, 10, 0, 5)
    baseTitle.BackgroundTransparency = 1
    baseTitle.Text = "üè† Base Setup"
    baseTitle.TextColor3 = Color3.fromRGB(0, 170, 255)
    baseTitle.TextScaled = true
    baseTitle.Font = Enum.Font.SourceSansBold
    baseTitle.Parent = baseFrame
    
    local setBaseBtn = Instance.new("TextButton")
    setBaseBtn.Size = UDim2.new(1, -20, 0, 30)
    setBaseBtn.Position = UDim2.new(0, 10, 0, 40)
    setBaseBtn.BackgroundColor3 = Color3.fromRGB(255, 165, 0)
    setBaseBtn.Text = "üìç Set Base"
    setBaseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    setBaseBtn.TextScaled = true
    setBaseBtn.Font = Enum.Font.SourceSansBold
    setBaseBtn.Parent = baseFrame
    
    local flyToBaseBtn = Instance.new("TextButton")
    flyToBaseBtn.Size = UDim2.new(1, -20, 0, 30)
    flyToBaseBtn.Position = UDim2.new(0, 10, 0, 80)
    flyToBaseBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 255)
    flyToBaseBtn.Text = "‚úàÔ∏è Fly to Base"
    flyToBaseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    flyToBaseBtn.TextScaled = true
    flyToBaseBtn.Font = Enum.Font.SourceSansBold
    flyToBaseBtn.Parent = baseFrame
    
    -- Angoli arrotondati
    for _, btn in pairs({setBaseBtn, flyToBaseBtn}) do
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = btn
    end
    
    setBaseBtn.MouseButton1Click:Connect(function()
        basePosition = rootPart.Position
        setBaseBtn.Text = "‚úÖ Base Set!"
        wait(1)
        setBaseBtn.Text = "üìç Set Base"
    end)
    
    flyToBaseBtn.MouseButton1Click:Connect(function()
        if basePosition then
            flyToBase()
            baseGui:Destroy()
        end
    end)
end

-- Fly to Base function
function flyToBase()
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
    bodyVelocity.Parent = rootPart
    
    -- Vai a 165 di altezza
    local highPosition = Vector3.new(basePosition.X, basePosition.Y + 165, basePosition.Z)
    bodyVelocity.Velocity = (highPosition - rootPart.Position).Unit * flySpeed
    
    -- Gira il personaggio all'indietro
    rootPart.CFrame = CFrame.lookAt(rootPart.Position, rootPart.Position - rootPart.CFrame.LookVector)
    
    -- Aspetta di arrivare vicino alla base
    spawn(function()
        repeat
            RunService.Heartbeat:Wait()
        until (rootPart.Position - highPosition).Magnitude < 10
        
        bodyVelocity:Destroy()
        
        -- Crea pulsante Down
        createDownButton()
    end)
end

-- Down Button
function createDownButton()
    local downGui = Instance.new("ScreenGui")
    downGui.Name = "DownGui"
    downGui.Parent = CoreGui
    
    local downBtn = Instance.new("TextButton")
    downBtn.Size = UDim2.new(0, 100, 0, 50)
    downBtn.Position = UDim2.new(0.5, -50, 0.8, 0)
    downBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
    downBtn.Text = "‚¨áÔ∏è DOWN"
    downBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    downBtn.TextScaled = true
    downBtn.Font = Enum.Font.SourceSansBold
    downBtn.Parent = downGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 15)
    corner.Parent = downBtn
    
    downBtn.MouseButton1Click:Connect(function()
        rootPart.CFrame = CFrame.new(basePosition)
        downGui:Destroy()
    end)
end

-- Inizializza tutto
createMainGui()

-- Cleanup quando il player esce
Players.PlayerRemoving:Connect(function(leavingPlayer)
    if leavingPlayer == player then
        for _, connection in pairs(connections) do
            if connection and connection.Disconnect then
                connection:Disconnect()
            elseif connection and connection.Destroy then
                connection:Destroy()
            end
        end
    end
end)
