-- Brainrot Universal Script with Advanced Features v3.0
-- Enhanced with all requested features
local Rayfield
pcall(function()
    Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
end)

if not Rayfield then
    pcall(function()
        Rayfield = loadstring(game:HttpGet('https://raw.githubusercontent.com/shlexware/Rayfield/main/source'))()
    end)
end

if not Rayfield then return end

-- Wait for game
repeat task.wait() until game:IsLoaded()

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local TeleportService = game:GetService("TeleportService")
local LocalPlayer = Players.LocalPlayer

-- Variables
local basePosition = Vector3.new(0, 10, 0)
local dropPoint = Vector3.new(0, 300, 0)
local originalSpeed = 16
local godMode = false
local antiRagdoll = false
local skyWidget = nil
local leaveGui = nil
local baseGui = nil
local killAuraActive = false
local killAuraConnection = nil
local noclipActive = false
local noclipConnection = nil
local proximityPromptFixApplied = false
local speedBoostActive = false

-- Anti-kick system
local function antiKick()
    local mt = getrawmetatable(game)
    local old = mt.__namecall
    setreadonly(mt, false)
    mt.__namecall = newcclosure(function(self, ...)
        local method = getnamecallmethod()
        if method == "Kick" then
            return
        end
        return old(self, ...)
    end)
    setreadonly(mt, true)
end

-- Fix proximity prompt bug
local function fixProximityPrompt()
    if proximityPromptFixApplied then return end
    
    local function fixPrompt(prompt)
        if prompt:IsA("ProximityPrompt") then
            prompt.GuiObject:GetPropertyChangedSignal("Size"):Connect(function()
                if prompt.GuiObject.Size.Y.Offset > 100 then
                    prompt.GuiObject.Size = UDim2.new(1, 0, 0, 40)
                end
            end)
        end
    end

    -- Fix existing prompts
    for _, prompt in pairs(workspace:GetDescendants()) do
        fixPrompt(prompt)
    end

    -- Fix new prompts
    workspace.DescendantAdded:Connect(fixPrompt)
    
    proximityPromptFixApplied = true
end

-- Enhanced NoClip with bypass
local function toggleNoClip()
    noclipActive = not noclipActive
    
    if noclipActive then
        if noclipConnection then
            noclipConnection:Disconnect()
        end
        
        noclipConnection = RunService.Stepped:Connect(function()
            pcall(function()
                local char = LocalPlayer.Character
                if char then
                    for _, part in pairs(char:GetDescendants()) do
                        if part:IsA("BasePart") then
                            part.CanCollide = false
                            part.Velocity = Vector3.new(0, 0, 0)
                            part.RotVelocity = Vector3.new(0, 0, 0)
                        end
                    end
                end
            end)
        end)
    elseif noclipConnection then
        noclipConnection:Disconnect()
        noclipConnection = nil
    end
end

-- Natural walk teleport (115% speed for bypass)
local function naturalWalk(targetPosition)
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    
    local hrp = char.HumanoidRootPart
    local humanoid = char.Humanoid
    local startPos = hrp.Position
    local distance = (startPos - targetPosition).Magnitude
    
    -- Calculate time for 115% normal walk speed
    local walkTime = distance / (originalSpeed * 1.15)
    
    -- Create smooth tween
    local tweenInfo = TweenInfo.new(
        walkTime,
        Enum.EasingStyle.Linear,
        Enum.EasingDirection.InOut
    )
    
    local tween = TweenService:Create(hrp, tweenInfo, {CFrame = CFrame.new(targetPosition)})
    tween:Play()
end

-- Teleport to drop point and fall to enemy base
local function teleportAndDrop()
    pcall(function()
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            -- Save current position (enemy base)
            local enemyBasePosition = char.HumanoidRootPart.Position
            
            -- Teleport to drop point
            char.HumanoidRootPart.CFrame = CFrame.new(dropPoint)
            
            -- Wait a moment
            task.wait(0.5)
            
            -- Teleport back to enemy base position but at ground level
            local groundPosition = Vector3.new(enemyBasePosition.X, enemyBasePosition.Y + 5, enemyBasePosition.Z)
            char.HumanoidRootPart.CFrame = CFrame.new(groundPosition)
            
            Rayfield:Notify({
                Title = "Drop Teleport",
                Content = "Teleported to drop point and returned to enemy base",
                Duration = 2,
                Image = 4483362458
            })
        end
    end)
end

-- Enhanced Kill Aura with 360-degree detection
local function startKillAura()
    if killAuraActive then return end
    killAuraActive = true
    
    killAuraConnection = RunService.Heartbeat:Connect(function()
        pcall(function()
            local char = LocalPlayer.Character
            if not char or not char:FindFirstChild("HumanoidRootPart") then return end
            
            local tool = LocalPlayer.Backpack:FindFirstChildOfClass("Tool")
            if not tool then
                tool = char:FindFirstChildOfClass("Tool")
            end
            
            if tool then
                local nearbyPlayers = {}
                
                -- Find all nearby players
                for _, player in pairs(Players:GetPlayers()) do
                    if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                        local distance = (player.Character.HumanoidRootPart.Position - char.HumanoidRootPart.Position).Magnitude
                        if distance < 20 then
                            table.insert(nearbyPlayers, {player = player, distance = distance})
                        end
                    end
                end
                
                -- Sort by distance (closest first)
                table.sort(nearbyPlayers, function(a, b)
                    return a.distance < b.distance
                end)
                
                -- Attack closest players
                for i = 1, math.min(#nearbyPlayers, 3) do
                    local targetPlayer = nearbyPlayers[i].player
                    local targetChar = targetPlayer.Character
                    
                    if targetChar and targetChar:FindFirstChild("HumanoidRootPart") then
                        -- Calculate direction vectors for 360-degree coverage
                        local targetDirection = (targetChar.HumanoidRootPart.Position - char.HumanoidRootPart.Position).Unit
                        
                        -- Rotate character to face target
                        local lookDirection = Vector3.new(targetDirection.X, 0, targetDirection.Z)
                        char.HumanoidRootPart.CFrame = CFrame.lookAt(char.HumanoidRootPart.Position, char.HumanoidRootPart.Position + lookDirection)
                        
                        -- Equip and activate tool
                        if tool.Parent == LocalPlayer.Backpack then
                            char.Humanoid:EquipTool(tool)
                        end
                        
                        if tool:FindFirstChild("Handle") then
                            tool:Activate()
                        end
                        
                        task.wait(0.05)
                    end
                end
            end
        end)
    end)
end

local function stopKillAura()
    if killAuraConnection then
        killAuraConnection:Disconnect()
        killAuraConnection = nil
    end
    killAuraActive = false
end

-- Create UI
local Window = Rayfield:CreateWindow({
    Name = "🚀 Brainrot Hub Enhanced v3.0",
    LoadingTitle = "Loading Premium Features...",
    LoadingSubtitle = "Enhanced with all requested features",
    ConfigurationSaving = {Enabled = false},
    Discord = {Enabled = false},
    KeySystem = false
})

local MainTab = Window:CreateTab("🏠 Main", 4483362458)
local StealTab = Window:CreateTab("⚡ Steal Helper", 4483362458)
local OtherTab = Window:CreateTab("✨ Other", 4483362458)

-- Speed Section
MainTab:CreateSection("💨 Speed & Movement")

MainTab:CreateToggle({
    Name = "🚀 Bypass Speed Boost (45% Faster)",
    CurrentValue = false,
    Callback = function(value)
        speedBoostActive = value
        pcall(function()
            local char = LocalPlayer.Character
            if char and char:FindFirstChild("Humanoid") then
                if value then
                    char.Humanoid.WalkSpeed = originalSpeed * 1.45
                else
                    char.Humanoid.WalkSpeed = originalSpeed
                end
                Rayfield:Notify({
                    Title = "Speed Boost",
                    Content = value and "Bypass speed activated" or "Speed reset to normal",
                    Duration = 2,
                    Image = 4483362458
                })
            end
        end)
    end
})

MainTab:CreateButton({
    Name = "🚶 Natural Walk to Base (Bypass)",
    Callback = function()
        pcall(function()
            naturalWalk(basePosition)
            Rayfield:Notify({
                Title = "Natural Walk",
                Content = "Walking to base with bypass...",
                Duration = 2,
                Image = 4483362458
            })
        end)
    end
})

-- Teleport Section
MainTab:CreateSection("📍 Teleport")

MainTab:CreateButton({
    Name = "🏠 Go to Base",
    Callback = function()
        pcall(function()
            local char = LocalPlayer.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                char.HumanoidRootPart.CFrame = CFrame.new(basePosition)
                Rayfield:Notify({
                    Title = "Base Teleport",
                    Content = "Teleported to base",
                    Duration = 2,
                    Image = 4483362458
                })
            end
        end)
    end
})

-- Steal Helper Tab (Premium Design)
StealTab:CreateSection("⚔️ Combat Features")

StealTab:CreateToggle({
    Name = "🛡️ God Mode",
    CurrentValue = false,
    Callback = function(value)
        godMode = value
        local char = LocalPlayer.Character
        if not char then return end
        
        if godMode then
            for _, part in pairs(char:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
            if char:FindFirstChild("Humanoid") then
                char.Humanoid.MaxHealth = math.huge
                char.Humanoid.Health = math.huge
            end
        else
            for _, part in pairs(char:GetDescendants()) do
                if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                    part.CanCollide = true
                end
            end
            if char:FindFirstChild("Humanoid") then
                char.Humanoid.MaxHealth = 100
                char.Humanoid.Health = 100
            end
        end
        
        Rayfield:Notify({
            Title = "God Mode",
            Content = godMode and "God Mode ON" or "God Mode OFF",
            Duration = 2,
            Image = 4483362458
        })
    end
})

StealTab:CreateToggle({
    Name = "🌀 Enhanced Kill Aura 360°",
    CurrentValue = false,
    Callback = function(value)
        if value then
            startKillAura()
            Rayfield:Notify({
                Title = "Kill Aura",
                Content = "360° Kill Aura activated",
                Duration = 3,
                Image = 4483362458
            })
        else
            stopKillAura()
            Rayfield:Notify({
                Title = "Kill Aura",
                Content = "Kill Aura deactivated",
                Duration = 2,
                Image = 4483362458
            })
        end
    end
})

StealTab:CreateSection("🎭 Stealth Features")

StealTab:CreateToggle({
    Name = "👻 Bypass NoClip (Pass Through Walls)",
    CurrentValue = false,
    Callback = function(value)
        toggleNoClip()
        Rayfield:Notify({
            Title = "NoClip",
            Content = value and "Bypass NoClip Activated" or "NoClip Deactivated",
            Duration = 2,
            Image = 4483362458
        })
    end
})

StealTab:CreateButton({
    Name = "👤 Invisibility Toggle",
    Callback = function()
        pcall(function()
            local char = LocalPlayer.Character
            if char then
                for _, part in pairs(char:GetDescendants()) do
                    if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                        part.Transparency = part.Transparency == 0 and 1 or 0
                    end
                    if part:IsA("Accessory") then
                        part.Handle.Transparency = part.Handle.Transparency == 0 and 1 or 0
                    end
                end
                
                if char:FindFirstChild("Head") then
                    for _, child in pairs(char.Head:GetChildren()) do
                        if child:IsA("Decal") then
                            child.Transparency = child.Transparency == 0 and 1 or 0
                        end
                    end
                end
                
                Rayfield:Notify({
                    Title = "Invisibility",
                    Content = "Invisibility toggled",
                    Duration = 2,
                    Image = 4483362458
                })
            end
        end)
    end
})

StealTab:CreateSection("🚪 Server Management")

StealTab:CreateButton({
    Name = "🔄 Leave & Server Hop",
    Callback = function()
        pcall(function()
            TeleportService:Teleport(game.PlaceId, LocalPlayer)
        end)
    end
})

StealTab:CreateButton({
    Name = "🔁 Rejoin Game",
    Callback = function()
        pcall(function()
            TeleportService:Teleport(game.PlaceId, LocalPlayer)
        end)
    end
})

-- Other Tab Features
OtherTab:CreateSection("✨ Special Features")

OtherTab:CreateButton({
    Name = "📍 Set Current Position as Base",
    Callback = function()
        pcall(function()
            local char = LocalPlayer.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                basePosition = char.HumanoidRootPart.Position
                Rayfield:Notify({
                    Title = "Base Position Set",
                    Content = "Base set to current position",
                    Duration = 2,
                    Image = 4483362458
                })
            end
        end)
    end
})

OtherTab:CreateButton({
    Name = "📍 Set Current Position as Drop Point",
    Callback = function()
        pcall(function()
            local char = LocalPlayer.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                dropPoint = char.HumanoidRootPart.Position
                Rayfield:Notify({
                    Title = "Drop Point Set",
                    Content = "Drop point set to current position",
                    Duration = 2,
                    Image = 4483362458
                })
            end
        end)
    end
})

OtherTab:CreateButton({
    Name = "🚀 Teleport to Drop Point & Enemy Base",
    Callback = function()
        teleportAndDrop()
    end
})

OtherTab:CreateSection("⚙️ Utilities")

OtherTab:CreateButton({
    Name = "🔧 Fix Proximity Prompt Bug",
    Callback = function()
        fixProximityPrompt()
        Rayfield:Notify({
            Title = "Proximity Prompt",
            Content = "Proximity prompt bug fixed",
            Duration = 2,
            Image = 4483362458
        })
    end
})

OtherTab:CreateButton({
    Name = "🔄 Reset Character",
    Callback = function()
        pcall(function()
            LocalPlayer.Character:FindFirstChild("Humanoid").Health = 0
            Rayfield:Notify({
                Title = "Reset",
                Content = "Character reset",
                Duration = 2,
                Image = 4483362458
            })
        end)
    end
})

OtherTab:CreateSlider({
    Name = "👁️ FOV Changer",
    Range = {10, 120},
    Increment = 1,
    Suffix = "FOV",
    CurrentValue = 70,
    Flag = "FOVChanger",
    Callback = function(value)
        pcall(function()
            workspace.CurrentCamera.FieldOfView = value
        end)
    end
})

-- Initialize features
fixProximityPrompt()
pcall(antiKick)

-- Character setup
local function setupCharacter()
    repeat task.wait(0.1) until LocalPlayer.Character
    repeat task.wait(0.1) until LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    originalSpeed = LocalPlayer.Character.Humanoid.WalkSpeed
    
    -- Reapply speed boost if active
    if speedBoostActive then
        LocalPlayer.Character.Humanoid.WalkSpeed = originalSpeed * 1.45
    end
end

if LocalPlayer.Character then
    setupCharacter()
end
LocalPlayer.CharacterAdded:Connect(setupCharacter)

-- Success notification
Rayfield:Notify({
    Title = "🚀 Brainrot Hub Enhanced v3.0 Loaded",
    Content = "All features activated - Bypass Speed, Drop Teleport, Fixed Prompts!",
    Duration = 6,
    Image = 4483362458
})
