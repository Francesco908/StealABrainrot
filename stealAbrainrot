--[[
  Script Fighissimo Dark v1.0
  Funzionalità:
  - GUI con tema dark e pulsanti animati
  - Tabs: Main, Visual, Misc
  - Anti Ragdoll, Speed Boost, AntiSteal con KillAura
  - Anti Trap, Steal Helper con GUI movibile
  - ESP Player con nomi piccoli e visibili attraverso i muri
]]

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local RunService = game:GetService("RunService")

-- Configurazione colori
local COLORS = {
    Background = Color3.fromRGB(25, 25, 30),
    Button = Color3.fromRGB(45, 45, 55),
    ButtonHover = Color3.fromRGB(65, 65, 75),
    ButtonActive = Color3.fromRGB(230, 0, 230), -- Fuchsia violaceo
    Text = Color3.fromRGB(220, 220, 220),
    TabActive = Color3.fromRGB(70, 70, 80)
}

-- Creazione GUI principale
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FighissimoDark"
ScreenGui.Parent = game.CoreGui

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 400, 0, 300)
MainFrame.Position = UDim2.new(0.5, -200, 0.5, -150)
MainFrame.BackgroundColor3 = COLORS.Background
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local Tabs = {"Main", "Visual", "Misc"}
local TabButtons = {}
local TabFrames = {}

-- Creazione pulsanti tab
for i, tabName in ipairs(Tabs) do
    local TabButton = Instance.new("TextButton")
    TabButton.Name = tabName.."Tab"
    TabButton.Size = UDim2.new(0.33, -4, 0, 30)
    TabButton.Position = UDim2.new((i-1)/3, 2, 0, 0)
    TabButton.BackgroundColor3 = COLORS.Button
    TabButton.TextColor3 = COLORS.Text
    TabButton.Text = tabName
    TabButton.Font = Enum.Font.GothamBold
    TabButton.Parent = MainFrame
    
    local TabFrame = Instance.new("Frame")
    TabFrame.Size = UDim2.new(1, -10, 1, -40)
    TabFrame.Position = UDim2.new(0, 5, 0, 35)
    TabFrame.BackgroundTransparency = 1
    TabFrame.Visible = (i == 1)
    TabFrame.Parent = MainFrame
    
    TabButton.MouseButton1Click:Connect(function()
        for _, frame in pairs(TabFrames) do
            frame.Visible = false
        end
        TabFrame.Visible = true
        for _, btn in pairs(TabButtons) do
            btn.BackgroundColor3 = COLORS.Button
        end
        TabButton.BackgroundColor3 = COLORS.TabActive
    end)
    
    TabButtons[tabName] = TabButton
    TabFrames[tabName] = TabFrame
end

-- Funzione per creare pulsanti animati
local function CreateButton(parent, name, position, callback)
    local Button = Instance.new("TextButton")
    Button.Name = name
    Button.Size = UDim2.new(1, -20, 0, 30)
    Button.Position = position
    Button.BackgroundColor3 = COLORS.Button
    Button.TextColor3 = COLORS.Text
    Button.Text = name
    Button.Font = Enum.Font.Gotham
    Button.Parent = parent
    
    local originalColor = Button.BackgroundColor3
    local active = false
    
    Button.MouseEnter:Connect(function()
        if not active then
            Button.BackgroundColor3 = COLORS.ButtonHover
        end
    end)
    
    Button.MouseLeave:Connect(function()
        if not active then
            Button.BackgroundColor3 = originalColor
        end
    end)
    
    Button.MouseButton1Click:Connect(function()
        active = not active
        Button.BackgroundColor3 = active and COLORS.ButtonActive or originalColor
        callback(active)
    end)
    
    return Button
end

--[[
  ========================
  TAB MAIN
  ========================
]]
local MainTab = TabFrames["Main"]

-- Anti Ragdoll (Funzionante)
CreateButton(MainTab, "Anti Ragdoll", UDim2.new(0, 10, 0, 10), function(active)
    if active then
        LocalPlayer.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, false)
    else
        LocalPlayer.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, true)
    end
end)

-- Speed Boost
CreateButton(MainTab, "Speed Boost", UDim2.new(0, 10, 0, 50), function(active)
    if active then
        LocalPlayer.Character.Humanoid.WalkSpeed = 32
    else
        LocalPlayer.Character.Humanoid.WalkSpeed = 16
    end
end)

-- AntiSteal con KillAura
local ANTI_STEAL_POSITION = Vector3.new(0, 5, 0) -- Posizione da personalizzare
CreateButton(MainTab, "AntiSteal", UDim2.new(0, 10, 0, 90), function(active)
    if active then
        local killAuraConn
        killAuraConn = RunService.Heartbeat:Connect(function()
            for _, player in ipairs(Players:GetPlayers()) do
                if player ~= LocalPlayer and player.Character then
                    local hrp = player.Character:FindFirstChild("HumanoidRootPart")
                    if hrp and (hrp.Position - ANTI_STEAL_POSITION).Magnitude < 10 then
                        -- Teletrasporta il giocatore e uccidi
                        hrp.CFrame = LocalPlayer.Character.HumanoidRootPart.CFrame
                        player.Character.Humanoid.Health = 0
                    end
                end
            end
        end)
    end
end)

-- Anti Trap
CreateButton(MainTab, "Anti Trap", UDim2.new(0, 10, 0, 130), function(active)
    if active then
        LocalPlayer.Character.Humanoid:SetAttribute("AntiTrap", true)
    else
        LocalPlayer.Character.Humanoid:SetAttribute("AntiTrap", false)
    end
end)

-- Steal Helper
local StealHelper = Instance.new("TextButton")
StealHelper.Name = "StealHelper"
StealHelper.Size = UDim2.new(0, 100, 0, 30)
StealHelper.BackgroundColor3 = COLORS.Button
StealHelper.TextColor3 = COLORS.Text
StealHelper.Text = "Steal Helper"
StealHelper.Font = Enum.Font.Gotham
StealHelper.Parent = ScreenGui

local dragging, dragInput, dragStart
StealHelper.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

StealHelper.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        StealHelper.Position = UDim2.new(
            0, StealHelper.AbsolutePosition.X + delta.X,
            0, StealHelper.AbsolutePosition.Y + delta.Y
        )
        dragStart = input.Position
    end
end)

CreateButton(StealHelper, "UP", UDim2.new(0, 0, 0, 35), function(active)
    StealHelper.Position = UDim2.new(0, StealHelper.AbsolutePosition.X, 0, 165)
end)

CreateButton(StealHelper, "DOWN", UDim2.new(0, 0, 0, 70), function(active)
    StealHelper.Position = UDim2.new(0, StealHelper.AbsolutePosition.X, 0, -50)
end)

--[[
  ========================
  TAB VISUAL
  ========================
]]
local VisualTab = TabFrames["Visual"]

-- ESP Player con nomi
local ESPEnabled = false
local ESPCache = {}

local function CreateESP(player)
    if ESPCache[player] then return end
    
    local character = player.Character
    if not character then return end
    
    local BillboardGui = Instance.new("BillboardGui")
    BillboardGui.Name = "ESP_"..player.Name
    BillboardGui.AlwaysOnTop = true
    BillboardGui.Size = UDim2.new(0, 100, 0, 40)
    BillboardGui.StudsOffset = Vector3.new(0, 2.5, 0)
    
    local NameLabel = Instance.new("TextLabel")
    NameLabel.Size = UDim2.new(1, 0, 0, 15)
    NameLabel.BackgroundTransparency = 1
    NameLabel.TextColor3 = Color3.new(1, 1, 1)
    NameLabel.Text = player.Name
    NameLabel.Font = Enum.Font.Gotham
    NameLabel.TextSize = 12 -- Dimensione piccola
    NameLabel.Parent = BillboardGui
    
    local Box = Instance.new("Frame")
    Box.Size = UDim2.new(1, 0, 0.5, 0)
    Box.Position = UDim2.new(0, 0, 0.5, 0)
    Box.BackgroundColor3 = Color3.new(1, 0, 1)
    Box.BackgroundTransparency = 0.5
    Box.BorderSizePixel = 0
    Box.Parent = BillboardGui
    
    BillboardGui.Parent = player.Character:WaitForChild("HumanoidRootPart")
    ESPCache[player] = BillboardGui
end

local function UpdateESP()
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            if ESPEnabled then
                CreateESP(player)
            elseif ESPCache[player] then
                ESPCache[player]:Destroy()
                ESPCache[player] = nil
            end
        end
    end
end

Players.PlayerAdded:Connect(UpdateESP)
Players.PlayerRemoving:Connect(function(player)
    if ESPCache[player] then
        ESPCache[player]:Destroy()
        ESPCache[player] = nil
    end
end)

CreateButton(VisualTab, "ESP Player", UDim2.new(0, 10, 0, 10), function(active)
    ESPEnabled = active
    UpdateESP()
end)

--[[
  ========================
  TAB MISC
  ========================
]]
-- (Aggiungi qui altre funzionalità per Misc)

-- Inizializzazione
TabButtons["Main"].BackgroundColor3 = COLORS.TabActive
