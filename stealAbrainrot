-- Servizi di Roblox necessari
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local DataStoreService = game:GetService("DataStoreService")
local TeleportService = game:GetService("TeleportService")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- Variabili per lo stato delle funzionalit√†
local isFloating = false
local isAirJump = false
local isInvisible = false
local isBoosted = false
local isPlayerESP = false
local isNameESP = false
local lockedPlayer = nil

-- Creazione del GUI principale
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "WaterHub"
ScreenGui.Parent = PlayerGui
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 400, 0, 300)
MainFrame.Position = UDim2.new(0.5, -200, 0.5, -150)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.BorderSizePixel = 0
MainFrame.ClipsDescendants = true
MainFrame.Parent = ScreenGui

-- Funzione per rendere il frame trascinabile
local function makeDraggable(frame)
    local dragging = false
    local dragInput, dragStart, startPos
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
        end
    end)
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement and dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    frame.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
end
makeDraggable(MainFrame)

-- Barra del titolo
local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0, 30)
TitleBar.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
TitleBar.Parent = MainFrame

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Size = UDim2.new(0.8, 0, 1, 0)
TitleLabel.Position = UDim2.new(0, 10, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "Water Hub"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.TextSize = 18
TitleLabel.Font = Enum.Font.SourceSansBold
TitleLabel.Parent = TitleBar

local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
MinimizeButton.Position = UDim2.new(0.85, 0, 0, 0)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MinimizeButton.Text = "-"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.Parent = TitleBar
local isMinimized = false
MinimizeButton.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    MainFrame.Size = isMinimized and UDim2.new(0, 400, 0, 30) or UDim2.new(0, 400, 0, 300)
end)

local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(0.925, 0, 0, 0)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Parent = TitleBar
CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Schede
local TabBar = Instance.new("Frame")
TabBar.Size = UDim2.new(1, 0, 0, 40)
TabBar.Position = UDim2.new(0, 0, 0, 30)
TabBar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
TabBar.Parent = MainFrame

local tabs = {"Main", "ESP", "Misc", "_SERVER_"}
local tabFrames = {}
local currentTab = nil

for i, tabName in ipairs(tabs) do
    local TabButton = Instance.new("TextButton")
    TabButton.Size = UDim2.new(0.25, 0, 1, 0)
    TabButton.Position = UDim2.new(0.25 * (i-1), 0, 0, 0)
    TabButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    TabButton.Text = tabName
    TabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    TabButton.Parent = TabBar

    local TabFrame = Instance.new("Frame")
    TabFrame.Size = UDim2.new(1, 0, 1, -70)
    TabFrame.Position = UDim2.new(0, 0, 0, 70)
    TabFrame.BackgroundTransparency = 1
    TabFrame.Visible = false
    TabFrame.Parent = MainFrame
    tabFrames[tabName] = TabFrame

    TabButton.MouseButton1Click:Connect(function()
        if currentTab then
            tabFrames[currentTab].Visible = false
        end
        TabFrame.Visible = true
        currentTab = tabName
    end)
end
tabFrames["Main"].Visible = true
currentTab = "Main"

-- Funzione per creare pulsanti toggle
local function createToggle(parent, name, posY, callback)
    local ToggleFrame = Instance.new("Frame")
    ToggleFrame.Size = UDim2.new(0.9, 0, 0, 30)
    ToggleFrame.Position = UDim2.new(0.05, 0, 0, posY)
    ToggleFrame.BackgroundTransparency = 1
    ToggleFrame.Parent = parent

    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(0.7, 0, 1, 0)
    Label.BackgroundTransparency = 1
    Label.Text = name
    Label.TextColor3 = Color3.fromRGB(255, 255, 255)
    Label.TextSize = 16
    Label.Parent = ToggleFrame

    local ToggleButton = Instance.new("TextButton")
    ToggleButton.Size = UDim2.new(0.2, 0, 0.8, 0)
    ToggleButton.Position = UDim2.new(0.8, 0, 0.1, 0)
    ToggleButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    ToggleButton.Text = "OFF"
    ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    ToggleButton.Parent = ToggleFrame

    local isOn = false
    ToggleButton.MouseButton1Click:Connect(function()
        isOn = not isOn
        ToggleButton.Text = isOn and "ON" or "OFF"
        ToggleButton.BackgroundColor3 = isOn and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(100, 100, 100)
        callback(isOn)
    end)
end

-- Scheda Main
local MainTab = tabFrames["Main"]
local HelperStealButton = Instance.new("TextButton")
HelperStealButton.Size = UDim2.new(0.9, 0, 0, 30)
HelperStealButton.Position = UDim2.new(0.05, 0, 0, 10)
HelperStealButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
HelperStealButton.Text = "Helper Steal"
HelperStealButton.TextColor3 = Color3.fromRGB(255, 255, 255)
HelperStealButton.Parent = MainTab

local HelperStealGui = Instance.new("Frame")
HelperStealGui.Size = UDim2.new(0, 200, 0, 150)
HelperStealGui.Position = UDim2.new(0.5, -100, 0.5, -75)
HelperStealGui.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
HelperStealGui.Visible = false
HelperStealGui.Parent = ScreenGui
makeDraggable(HelperStealGui)

local HSTitle = Instance.new("TextLabel")
HSTitle.Size = UDim2.new(1, 0, 0, 30)
HSTitle.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
HSTitle.Text = "Helper Steal"
HSTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
HSTitle.Parent = HelperStealGui

local GoUpButton = Instance.new("TextButton")
GoUpButton.Size = UDim2.new(0.8, 0, 0, 40)
GoUpButton.Position = UDim2.new(0.1, 0, 0, 40)
GoUpButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
GoUpButton.Text = "Go Up (165)"
GoUpButton.TextColor3 = Color3.fromRGB(255, 255, 255)
GoUpButton.Parent = HelperStealGui
GoUpButton.MouseButton1Click:Connect(function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = char.HumanoidRootPart.CFrame + Vector3.new(0, 165, 0)
    end
end)

local GoDownButton = Instance.new("TextButton")
GoDownButton.Size = UDim2.new(0.8, 0, 0, 40)
GoDownButton.Position = UDim2.new(0.1, 0, 0, 90)
GoDownButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
GoDownButton.Text = "Go Down (50)"
GoDownButton.TextColor3 = Color3.fromRGB(255, 255, 255)
GoDownButton.Parent = HelperStealGui
GoDownButton.MouseButton1Click:Connect(function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = char.HumanoidRootPart.CFrame - Vector3.new(0, 50, 0)
    end
end)

local HSCloseButton = Instance.new("TextButton")
HSCloseButton.Size = UDim2.new(0, 30, 0, 30)
HSCloseButton.Position = UDim2.new(1, -30, 0, 0)
HSCloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
HSCloseButton.Text = "X"
HSCloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
HSCloseButton.Parent = HelperStealGui
HSCloseButton.MouseButton1Click:Connect(function()
    HelperStealGui.Visible = false
end)

HelperStealButton.MouseButton1Click:Connect(function()
    HelperStealGui.Visible = true
end)

createToggle(MainTab, "Float", 50, function(state)
    isFloating = state
    if state then
        RunService:BindToRenderStep("Float", Enum.RenderPriority.Character.Value + 1, function()
            local char = LocalPlayer.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                char.HumanoidRootPart.Velocity = Vector3.new(0, 0, 0)
            end
        end)
    else
        RunService:UnbindFromRenderStep("Float")
    end
end)

createToggle(MainTab, "Air Jump", 90, function(state)
    isAirJump = state
end)

local UserInputService = game:GetService("UserInputService")
UserInputService.JumpRequest:Connect(function()
    if isAirJump and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        LocalPlayer.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

createToggle(MainTab, "Invisible Player", 130, function(state)
    isInvisible = state
    local char = LocalPlayer.Character
    if char then
        for _, part in pairs(char:GetDescendants()) do
            if part:IsA("BasePart") or part:IsA("Decal") then
                part.Transparency = state and 1 or 0
            end
        end
    end
end)

local AutoLockButton = Instance.new("TextButton")
AutoLockButton.Size = UDim2.new(0.9, 0, 0, 30)
AutoLockButton.Position = UDim2.new(0.05, 0, 0, 170)
AutoLockButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
AutoLockButton.Text = "Auto Lock"
AutoLockButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoLockButton.Parent = MainTab

local AutoLockGui = Instance.new("Frame")
AutoLockGui.Size = UDim2.new(0, 200, 0, 150)
AutoLockGui.Position = UDim2.new(0.5, -100, 0.5, -75)
AutoLockGui.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
AutoLockGui.Visible = false
AutoLockGui.Parent = ScreenGui
makeDraggable(AutoLockGui)

local ALTitle = Instance.new("TextLabel")
ALTitle.Size = UDim2.new(1, 0, 0, 30)
ALTitle.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
ALTitle.Text = "Auto Lock"
ALTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
ALTitle.Parent = AutoLockGui

local SetLockButton = Instance.new("TextButton")
SetLockButton.Size = UDim2.new(0.8, 0, 0, 40)
SetLockButton.Position = UDim2.new(0.1, 0, 0, 40)
SetLockButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
SetLockButton.Text = "Set Lock"
SetLockButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SetLockButton.Parent = AutoLockGui
SetLockButton.MouseButton1Click:Connect(function()
    local mouse = LocalPlayer:GetMouse()
    mouse.Button1Down:Connect(function()
        local target = mouse.Target
        if target and target.Parent and Players:GetPlayerFromCharacter(target.Parent) then
            lockedPlayer = Players:GetPlayerFromCharacter(target.Parent)
            SetLockButton.Text = "Locked: " .. lockedPlayer.Name
        end
    end)
end)

local TPLockButton = Instance.new("TextButton")
TPLockButton.Size = UDim2.new(0.8, 0, 0, 40)
TPLockButton.Position = UDim2.new(0.1, 0, 0, 90)
TPLockButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
TPLockButton.Text = "TP Lock"
TPLockButton.TextColor3 = Color3.fromRGB(255, 255, 255)
TPLockButton.Parent = AutoLockGui
TPLockButton.MouseButton1Click:Connect(function()
    if lockedPlayer and lockedPlayer.Character and lockedPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            local targetPos = lockedPlayer.Character.HumanoidRootPart.Position
            local tween = TweenService:Create(char.HumanoidRootPart, TweenInfo.new(1), {CFrame = CFrame.new(targetPos)})
            tween:Play()
            char.Humanoid.WalkSpeed = char.Humanoid.WalkSpeed * 1.2 -- Piccolo boost
            wait(1)
            char.Humanoid.WalkSpeed = char.Humanoid.WalkSpeed / 1.2
        end
    end
end)

local ALCloseButton = Instance.new("TextButton")
ALCloseButton.Size = UDim2.new(0, 30, 0, 30)
ALCloseButton.Position = UDim2.new(1, -30, 0, 0)
ALCloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
ALCloseButton.Text = "X"
ALCloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ALCloseButton.Parent = AutoLockGui
ALCloseButton.MouseButton1Click:Connect(function()
    AutoLockGui.Visible = false
end)

AutoLockButton.MouseButton1Click:Connect(function()
    AutoLockGui.Visible = true
end)

createToggle(MainTab, "Boost", 210, function(state)
    isBoosted = state
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("Humanoid") then
        char.Humanoid.WalkSpeed = state and 24 or 16 -- 50% boost da 16 a 24
    end
end)

-- Scheda ESP
local ESPTab = tabFrames["ESP"]
createToggle(ESPTab, "Player ESP", 10, function(state)
    isPlayerESP = state
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local highlight = player.Character:FindFirstChild("ESPHighlight")
            if state and not highlight then
                highlight = Instance.new("Highlight")
                highlight.Name = "ESPHighlight"
                highlight.FillColor = Color3.fromRGB(255, 0, 0)
                highlight.OutlineColor = Color3.fromRGB(255, 0, 0)
                highlight.Parent = player.Character
            elseif not state and highlight then
                highlight:Destroy()
            end
        end
    end
end)

createToggle(ESPTab, "Name ESP", 50, function(state)
    isNameESP = state
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local billboard = player.Character:FindFirstChild("NameESP")
            if state and not billboard then
                billboard = Instance.new("BillboardGui")
                billboard.Name = "NameESP"
                billboard.Size = UDim2.new(0, 100, 0, 20)
                billboard.StudsOffset = Vector3.new(0, 3, 0)
                billboard.AlwaysOnTop = true
                local label = Instance.new("TextLabel")
                label.Size = UDim2.new(1, 0, 1, 0)
                label.BackgroundTransparency = 1
                label.Text = player.Name
                label.TextColor3 = Color3.fromRGB(255, 0, 0)
                label.TextSize = 14
                label.Parent = billboard
                billboard.Parent = player.Character:FindFirstChild("Head") or player.Character
            elseif not state and billboard then
                billboard:Destroy()
            end
        end
    end
end)

Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(char)
        if isPlayerESP then
            local highlight = Instance.new("Highlight")
            highlight.Name = "ESPHighlight"
            highlight.FillColor = Color3.fromRGB(255, 0, 0)
            highlight.OutlineColor = Color3.fromRGB(255, 0, 0)
            highlight.Parent = char
        end
        if isNameESP then
            local billboard = Instance.new("BillboardGui")
            billboard.Name = "NameESP"
            billboard.Size = UDim2.new(0, 100, 0, 20)
            billboard.StudsOffset = Vector3.new(0, 3, 0)
            billboard.AlwaysOnTop = true
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1, 0, 1, 0)
            label.BackgroundTransparency = 1
            label.Text = player.Name
            label.TextColor3 = Color3.fromRGB(255, 0, 0)
            label.TextSize = 14
            label.Parent = billboard
            billboard.Parent = char:FindFirstChild("Head") or char
        end
    end)
end)

-- Scheda Misc
local MiscTab = tabFrames["Misc"]
local SoonLabel = Instance.new("TextLabel")
SoonLabel.Size = UDim2.new(0.9, 0, 0, 30)
SoonLabel.Position = UDim2.new(0.05, 0, 0, 10)
SoonLabel.BackgroundTransparency = 1
SoonLabel.Text = "soon.."
SoonLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
SoonLabel.TextSize = 16
SoonLabel.Parent = MiscTab

-- Scheda Server
local ServerTab = tabFrames["_SERVER_"]
local LeaveButton = Instance.new("TextButton")
LeaveButton.Size = UDim2.new(0.9, 0, 0, 30)
LeaveButton.Position = UDim2.new(0.05, 0, 0, 10)
LeaveButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
LeaveButton.Text = "Leave Server"
LeaveButton.TextColor3 = Color3.fromRGB(255, 255, 255)
LeaveButton.Parent = ServerTab
LeaveButton.MouseButton1Click:Connect(function()
    game:Shutdown()
end)

local RejoinButton = Instance.new("TextButton")
RejoinButton.Size = UDim2.new(0.9, 0, 0, 30)
RejoinButton.Position = UDim2.new(0.05, 0, 0, 50)
RejoinButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
RejoinButton.Text = "Rejoin Server"
RejoinButton.TextColor3 = Color3.fromRGB(255, 255, 255)
RejoinButton.Parent = ServerTab
RejoinButton.MouseButton1Click:Connect(function()
    TeleportService:Teleport(game.PlaceId, LocalPlayer)
end)

local ServerHopButton = Instance.new("TextButton")
ServerHopButton.Size = UDim2.new(0.9, 0, 0, 30)
ServerHopButton.Position = UDim2.new(0.05, 0, 0, 90)
ServerHopButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
ServerHopButton.Text = "Server Hop"
ServerHopButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ServerHopButton.Parent = ServerTab
ServerHopButton.MouseButton1Click:Connect(function()
    local servers = game:GetService("HttpService"):JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"))
    for _, server in pairs(servers.data) do
        if server.id ~= game.JobId then
            TeleportService:TeleportToPlaceInstance(game.PlaceId, server.id, LocalPlayer)
            break
        end
    end
end)

-- Persistenza per Auto Lock
local LockDataStore = DataStoreService:GetDataStore("AutoLockData")
LocalPlayer.CharacterAdded:Connect(function(char)
    if isInvisible then
        for _, part in pairs(char:GetDescendants()) do
            if part:IsA("BasePart") or part:IsA("Decal") then
                part.Transparency = 1
            end
        end
    end
    if isBoosted then
        char:WaitForChild("Humanoid").WalkSpeed = 24
    end
    local success, data = pcall(function()
        return LockDataStore:GetAsync(LocalPlayer.UserId)
    end)
    if success and data then
        lockedPlayer = Players:GetPlayerByUserId(data)
    end
end)

SetLockButton.MouseButton1Click:Connect(function()
    local mouse = LocalPlayer:GetMouse()
    mouse.Button1Down:Connect(function()
        local target = mouse.Target
        if target and target.Parent and Players:GetPlayerFromCharacter(target.Parent) then
            lockedPlayer = Players:GetPlayerFromCharacter(target.Parent)
            SetLockButton.Text = "Locked: " .. lockedPlayer.Name
            pcall(function()
                LockDataStore:SetAsync(LocalPlayer.UserId, lockedPlayer.UserId)
            end)
        end
    end)
end)
